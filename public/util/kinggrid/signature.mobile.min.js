var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,d,h){c instanceof String&&(c=String(c));for(var e=c.length,l=0;l<e;l++){var q=c[l];if(d.call(h,q,l,c))return{i:l,v:q}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,d,h){c!=Array.prototype&&c!=Object.prototype&&(c[d]=h.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,d,h,e){if(d){h=$jscomp.global;c=c.split(".");for(e=0;e<c.length-1;e++){var l=c[e];l in h||(h[l]={});h=h[l]}c=c[c.length-1];e=h[c];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(h,c,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,h){return $jscomp.findInternal(this,c,h).v}},"es6","es3");
(function(c,d){"function"!==typeof define||!define.amd||"undefined"!=typeof nonUseAmd&&nonUseAmd?d():"undefined"!=typeof HTMLDev&&HTMLDev?define(["./signature"],d):define(["./signature.min"],d)})(window,function(c){function d(a){return Math.sqrt(a.x*a.x+a.y*a.y)}var h=window.kinggrid,e=window.Signature,l=window.jQuery;"use strict";var q=function(a,b){this.preV={x:null,y:null};this.pinchStartLen=null;this.scale=1;this.isDoubleTap=!1;this.rotate=b.rotate||function(){};this.pointStart=b.pointStart||
function(){};this.multipointStart=b.multipointStart||function(){};this.multipointEnd=b.multipointEnd||function(){};this.pinch=b.pinch||function(){};this.swipe=b.swipe||function(){};this.tap=b.tap||function(){};this.doubleTap=b.doubleTap||function(){};this.longTap=b.longTap||function(){};this.singleTap=b.singleTap||function(){};this.pressMove=b.pressMove||function(){};this.x1=this.x2=this.y1=this.y2=this.swipeTimeout=this.longTapTimeout=this.touchTimeout=this.tapTimeout=this.now=this.last=this.delta=
null;this.preTapPosition={x:null,y:null};a.addEventListener("touchstart",this.start.bind(this),!1);a.addEventListener("touchmove",this.move.bind(this),!1);a.addEventListener("touchend",this.end.bind(this),!1);a.addEventListener("touchcancel",this.cancel.bind(this),!1)};q.prototype={start:function(a){if(a.touches){this.now=Date.now();this.x1=a.touches[0].pageX;this.y1=a.touches[0].pageY;this.delta=this.now-(this.last||this.now);this.pointStart(a);null!==this.preTapPosition.x&&(this.isDoubleTap=0<this.delta&&
250>=this.delta&&30>Math.abs(this.preTapPosition.x-this.x1)&&30>Math.abs(this.preTapPosition.y-this.y1));this.preTapPosition.x=this.x1;this.preTapPosition.y=this.y1;this.last=this.now;var b=this.preV;if(1<a.touches.length){var k=a.touches[1].pageY-this.y1;b.x=a.touches[1].pageX-this.x1;b.y=k;this.pinchStartLen=d(b);this.multipointStart(a)}this.longTapTimeout=setTimeout(function(){this.longTap(a)}.bind(this),750)}},move:function(a){if(a.touches){var b=this.preV,k=a.touches.length,c=a.touches[0].pageX,
g=a.touches[0].pageY;this.isDoubleTap=!1;if(1<k){k={x:a.touches[1].pageX-c,y:a.touches[1].pageY-g};if(null!==b.x){0<this.pinchStartLen&&(a.scale=d(k)/this.pinchStartLen,this.pinch(a));var f=d(k)*d(b);0===f?f=0:(f=(k.x*b.x+k.y*b.y)/f,1<f&&(f=1),f=Math.acos(f));0<k.x*b.y-b.x*k.y&&(f*=-1);a.angle=180*f/Math.PI;this.rotate(a)}b.x=k.x;b.y=k.y}else null!==this.x2&&(a.deltaX=c-this.x2,a.deltaY=g-this.y2,this.pressMove(a));this._cancelLongTap();this.x2=c;this.y2=g;a.preventDefault()}},end:function(a){if(a.changedTouches){this._cancelLongTap();
var b=this;2>a.touches.length&&this.multipointEnd(a);this.x2&&30<Math.abs(this.x1-this.x2)||this.y2&&30<Math.abs(this.preV.y-this.y2)?(a.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout(function(){b.swipe(a)},0)):this.tapTimeout=setTimeout(function(){b.isDoubleTap?(b.doubleTap(a),clearTimeout(b.touchTimeout),b.isDoubleTap=!1):b.touchTimeout=setTimeout(function(){b.singleTap(a)},250)},0);this.preV.x=0;this.preV.y=0;this.scale=1;this.x1=this.x2=this.y1=this.y2=
this.pinchStartLen=null}},cancel:function(){clearTimeout(this.touchTimeout);clearInterval(this.tapTimeout);clearInterval(this.longTapTimeout);clearInterval(this.swipeTimeout)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_swipeDirection:function(a,b,k,c){return Math.abs(a-b)>=Math.abs(k-c)?0<a-b?"Left":"Right":0<k-c?"Up":"Down"}};var m=h.Utils;m.extend(e.options.template,{infoBtl:'<div class="kg-dialog kg-dialog-info" id="kg-info"><%var modified = this.modified;%><%var canSign = this.signatureData.signMeta|| this.canSign(); %><div class="kg-content"><div class="kg-tab"><ul class="kg-nav clearfix"><li class=" <% modified?"":"active"%> "><a href="#" kg-target="signatureinfo">\u7b7e\u7ae0\u4fe1\u606f</a></li><%if(this.icon_sign == null || this.icon_sign == true){%><%if(canSign){%><li class="" ><a href="#" kg-target="certinfo">\u8bc1\u4e66\u4fe1\u606f</a></li><%}%><%}%></ul><div class="kg-tab-content"><div class="kg-tab-pane active signatureinfo"><% var SDATA = this.signatureData; %><% var modifiedItems = this.modifiedItems; %><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label">\u68c0\u6d4b\u7ed3\u679c\uff1a</label><span class="kg-value"><%modified?"\u4fdd\u62a4\u6570\u636e\u88ab\u7be1\u6539\uff01":"\u4fdd\u62a4\u6570\u636e\u6b63\u5e38\uff01"%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5e94\u7528\u7a0b\u5e8f\uff1a</label><span class="kg-value"><%SDATA.appname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u6388\u6743\u5355\u4f4d\uff1a</label><span class="kg-value"><%SDATA.orgname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7528\u6237\u540d\u79f0\uff1a</label><span class="kg-value"><%SDATA.username%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5bc6\u94a5\u5e8f\u5217\uff1a</label><span class="kg-value"><%SDATA.keysn%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u540d\u79f0\uff1a</label><span class="kg-value"><%SDATA.seal.signname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u5e8f\u5217\uff1a</label><span class="kg-value"><%SDATA.seal.signsn%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u65e5\u671f\uff1a</label><span class="kg-value"><%SDATA.timestamp.signtime%></span></div></div><%if(this.icon_remove == null || this.icon_remove == true){%><div><button type="button" id="revoke_<%this.signatureid%>" class="kg-button ">\u64a4\u9500\u7b7e\u7ae0</button></div><%}%></div><%if(canSign){%><div class="kg-tab-pane certinfo"><%var noCertInfo = !this.signatureData.signMeta; %><%if(!noCertInfo){%><%var certinfo = this.signatureData.signMeta.certinfo; %><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label">\u7248\u672c\uff1a</label><span class="kg-value">V<%certinfo.version%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5e8f\u53f7\uff1a</label><span class="kg-value"><%certinfo.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u540d\u7b97\u6cd5\uff1a</label><span class="kg-value"><%certinfo.algName%></span></div><div class="clearfix kg-item "><label class="kg-label">\u9881\u53d1\u8005\uff1a</label><span class="kg-value"><%certinfo.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label">\u4f7f\u7528\u8005\uff1a</label><span class="kg-value"><%certinfo.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label">\u6709\u6548\u671f\u4ece\uff1a</label><span class="kg-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notBefore) , "yyyy-MM-dd hh:mm:ss")%></span></div><div class="clearfix kg-item "><label class="kg-label">\u81f3\uff1a</label><span class="kg-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notAfter) , "yyyy-MM-dd hh:mm:ss")%></span></div></div><%}else{%><div class="kg-meta"><div class="clearfix kg-item kg-visble "><label class="kg-label"></label><span class="kg-value">----------------------------------------------------------------------------------------------------------------------</span></div><div class="clearfix kg-item kg-nosign"><label class="kg-label">\u63d0\u793a\u4fe1\u606f\uff1a</label><span class="kg-value">\u5f53\u524d\u6587\u6863\u672a\u505a\u6570\u5b57\u7b7e\u540d</span></div><div class="clearfix kg-item kg-visble"><label class="kg-label"></label><span class="kg-value">--------------------------------------------------------------------</span></div></div><%}%><%if(noCertInfo){%><div><button type="button" id="sign_<%this.signatureid%>" class="kg-button">\u6570\u5b57\u7b7e\u540d</button></div><%}else{%><div><button type="button" id="verifysign_<%this.signatureid%>" class="kg-button">\u7b7e\u540d\u9a8c\u8bc1</button></div><%}%></div><%}%></div></div></div></div>',
handwritedlg:'<div class="kg-dialog kg-dialog-info" id="kg-handwrite"><div class="kg-hw-content"><div class="kg-hw-info kg-hw-model">\u6a21\u5f0f:<select id="hw_model"><option value="0">\u624b\u5199\u7b7e\u540d</option><option value="1">\u6587\u5b57\u7b7e\u6279</option></select></div><div class="kg-hw-info kg-hw-name">\u540d\u79f0:<input type="text" value="\u624b\u5199\u7b7e\u6279" id="nameid" style="width:100px;"/></div><div class="kg-hw-info kg-hw-color">\u989c\u8272:<select id="hw_color"><option value="black">\u9ed1</option><option value="red">\u7ea2</option><option value="blue">\u84dd</option><option value="green">\u7eff</option></select></div><div class="kg-hw-info kg-hw-linewidth kg-hw-handwrite">\u7b14\u5bbd:<select id="hw_width"><% for(var i=1;i<=8;i++) {%><option value="<%i%>"><%i%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontFamily kg-hw-written">\u5b57\u4f53:<select id="hw_fontFamily"><% for(var i=0;i<this.fontFamily.length;i++) {%><option value="<%this.fontFamily[i].ename%>"><%this.fontFamily[i].zname%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontSize kg-hw-written"><select id="hw_fontSize"><% for(var i=16;i<=80;i+=4) {%><option value="<%i%>"<%i==24?"selected":""%>><%i%></option><%}%></select></div></div><div class="kg-hw-canvas"><div id="kg-hw-span" class="kg-hw-written kg-hw-text-span"></div><textarea class="kg-hw-written kg-hw-text-edit" spellcheck="false"></textarea><canvas id="canvasId" width=700px height=300px></canvas></div><div id="div-judge" class="kg-tab-content" align="center"><button type="button" id="clearid" class="kg-button">\u6e05\u9664</button><button type="button" id="okid" class="kg-button">\u7b7e\u540d</button></div></div>',
barcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><label class="kg-label">\u4e8c\u7ef4\u7801\u5185\u5bb9\uff1a</label><textarea id="bcId" align="center"></textarea><br /><div id="output"><br /></div><div id="div-judge" class="kg-tab-content"><button type="button" id="bc_clearid" class="kg-button">\u6e05\u9664</button><button type="button" id="bc_okid" class="kg-button">\u786e\u5b9a</button></div></div>',scanbarcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-scanBC"><div id="contentHolder" style="width:320px;height:320px; background:red;"><video id="html5_qrcode_video" height="320px" width="320px" autoplay></video><canvas id="qr-canvas" width="320px" height="320px" style="display:none;"></canvas> <br/> </div></div>'});
e._create.prototype.onshowSealsDialog=function(a){var b=this;a.find(".arrow").hide();a=a.find("#kg-switcher");b.switcher.animate=!1;new q(a[0],{swipe:function(a){b.switcher["Left"===a.direction?"swipePrev":"swipeNext"]()},tap:function(){b.switcher.swipeNext()}})};e.prototype.onhandleImg=function(a){var b=this,k=function(a){b.verify();b.signatureInfo()},c=function(){if(void 0!==e.options.extra){var b=a.attributes.signatureid.nodeValue;if(b&&(b=e.options.extra[b],null!=b&&void 0!==b&&b.icon_move))return b.icon_move()}}();
c=void 0==c?!0:c;b.canMove(a)&&c?m.addEvent(a,"mousedown touchstart",function(c){c.originalEvent=c;b.runMove(c,a,function(a){a||k()});c.preventDefault();c.stopPropagation()}):e.options.verifyResType?m.addEvent(a,e.options.verifyResType,k):m.addEvent(a,"click",k)};e.prototype.signatureInfo=function(){var a=this;return a.showDialog("infoBtl",{title:!1,target:a,onShow:function(){var b=this,c=b.find(".kg-tab");b.tab=m.tab(c);if(c=b.find("#verifysign_"+a.signatureid)[0])c.onclick=function(){a.verifySignData(function(b){b.result?
e.alert(h.msg("normal_signdata","KG_MSG")):b.errcode?a.error(b):e.alert(h.msg("modify_signdata","KG_MSG"))})};if(c=b.find("#sign_"+a.signatureid)[0])c.onclick=function(){a.signSignature(function(a){a.result&&(e.alert(h.msg("success_signdata","KG_MSG")),b.remove())})};if(null==a.icon_remove||1==a.icon_remove)b.find("#revoke_"+a.signatureid)[0].onclick=function(){a.revokeSignature(function(a){a.result&&b.remove()})}}})};e.prototype.handWriteDlg=function(a,b){var c=a.width,e=a.height;a.width=null;a.height=
null;this.fontFamily=r.fontFamily;m.extend(a,{title:h.msg("HWSignature","KG_TITLE"),target:this});var g=this.showDialog("handwritedlg",a),f=g.find("#canvasId")[0];c&&e?(f.width=c,f.height=e):screen.availWidth>screen.availHeight?(f.width=700<screen.availWidth?670:.95*screen.availWidth,f.height=.9*(screen.availHeight-210)):f.width=.83*(screen.availWidth-190)+190;a.canvas_height=f.height;a.canvas_width=f.width;var d=g.find(".kg-hw-text-span").css({height:f.height,width:f.width}),n=g.find(".kg-hw-text-edit").css({height:f.height,
width:f.width}),l,p=new SignaturePad(f,a);g.find("#hw_width").val(a.lineSize||5);g.find("#hw_color").change(function(){var a=g.find("#hw_color").val();p.setColor(a);d.css({color:a});n.css({color:a})});g.find("#hw_width").change(function(){var a=g.find("#hw_width").val();p.setSize(a)});g.find("#hw_model").change(function(a){"0"==a.target.value?(g.find(".kg-hw-written").css({display:"none"}),g.find(".kg-hw-handwrite").css({display:"block"}),p.setWebHandWrite(l,{fontStyle:"normal",fontSize:d.css("font-size"),
fontFamily:d.css("font-family"),fontColor:d.css("color")}),l=[],d.html(""),n.val("")):"1"==a.target.value&&(g.find(".kg-hw-handwrite").css({display:"none"}),g.find(".kg-hw-written").css({display:"block"}))});n.keyup(function(a){a=m.convertText(this.value);d.html(a);l=m.handleEdittable(d,a)});g.find("#hw_fontFamily").change(function(a){d.css({"font-family":this.value});n.css({"font-family":this.value})});g.find("#hw_fontSize").change(function(a){d.css({"font-size":this.value+"px","line-height":6+1.2*
this.value+"px"});n.css({"font-size":this.value+"px","line-height":6+1.2*this.value+"px"});l=m.handleEdittable(d,d.html())});c=g.find("#clearid");e=g.find("#okid");c&&c.click(function(){l=[];d.html("");n.val("");p.clear()});e&&e.click(function(){g.close();p.setWebHandWrite(l,{fontStyle:"normal",fontSize:d.css("font-size"),fontFamily:d.css("font-family"),fontColor:d.css("color")});p.toDataURL(function(c){if(c=c.replace(/^data:image\/\w+;base64,/,""))c={height:a.image_height||"5.00",width:a.image_width||
"6.70",imageData:c,name:g.find("#nameid").val()},b(c),g.remove()})})};e.prototype.barCodeDlg=function(a,b){var c=this.showDialog("barcodedlg",{title:"\u4e8c\u7ef4\u7801",target:this,onCancel:!1}),d=c.find("#bc_clearid"),e=c.find("#bc_okid"),f=c.find("#bcId");d&&d.click(function(){f.val("")});e&&e.click(function(){c.close();var d=c.find("#output").qrcode(f.val());b({height:a.image_height||"5",width:a.image_width||"5",imageData:d,name:"\u4e8c\u7ef4\u7801"})})};e.prototype.scanBCDlg=function(a,c){var b=
{title:h.msg("scanBCSignature","KG_TITLE"),target:this,onCancel:!1},d=this.showDialog("scanbarcodedlg",b);try{var e=document.getElementById("qr-canvas").getContext("2d"),f=document.getElementById("html5_qrcode_video");b={video:!0,audio:!1};window.navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL||window.oURL;window.navigator.getUserMedia&&window.navigator.getUserMedia(b,
function(a){f.src=window.URL.createObjectURL(a);f.play()},function(a){alert("\u51fa\u9519\u4fe1\u606f: "+a.name)});var m=setInterval(function(){if(e){e.drawImage(f,0,0,640,480);var b=e.getImageData(0,0,640,480);if(b=jsQR.decodeQRFromImage(b.data,b.width,b.height))d.close(),window.clearInterval(m),a.content=b,b={height:a.image_height||"5",width:a.image_width||"5",imageData:l("#output").qrcode(b),name:"\u4e8c\u7ef4\u7801"},c(b)}},2E3)}catch(n){printHtml("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301HTML5 CANVAS")}};
var r=kingPlus();m.extend(r.alertConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1});m.extend(r.loadingConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1});m.extend(r.dialogConfig,{cancelDisplay:!1,quickClose:!0});return e});
// V2.0.0.400    
