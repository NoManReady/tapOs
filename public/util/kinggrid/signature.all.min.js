/*
 artDialog v6.0.5 | https://github.com/aui/artDialog kgDialog*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
!function(){function a(b){b=c[b];return"object"==typeof b?b:(b.exports||(b.exports={},b.exports=b.call(b.exports,a,b.exports,b)||b.exports),b.exports)}function b(a,b){c[a]=b}var c={};b("jquery",function(){return jQuery});b("popup",function(a){function b(){this.destroyed=!1;this.__popup=c("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body");this.__backdrop=this.__mask=c("<div />").css({opacity:.7,background:"#000"});this.node=this.__popup[0];
this.backdrop=this.__backdrop[0];d++}var c=a("jquery"),d=0,k=!("minWidth"in c("html")[0].style),h=!k;return c.extend(b.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(a){if(this.destroyed)return this;var d=this.__popup,e=this.__backdrop;if(this.__activeElement=this.__getActive(),this.open=!0,this.follow=a||this.follow,!this.__ready){if(d.addClass(this.className).attr("role",this.modal?
"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),k||c(window).on("resize",c.proxy(this.reset,this)),this.modal)a={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||b.zIndex},d.addClass(this.className+"-modal"),h||c.extend(a,{position:"absolute",width:c(window).width()+"px",height:c(document).height()+"px"}),e.css(a).attr({tabindex:"0"}).on("focus",c.proxy(this.focus,this)),this.__mask=e.clone(!0).attr("style","").insertAfter(d),
e.addClass(this.className+"-backdrop").insertBefore(d),this.__ready=!0;d.html()||d.html(this.innerHTML)}return d.addClass(this.className+"-show").show(),e.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(a){return!this.destroyed&&this.open&&(void 0!==a&&(this.returnValue=a),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),
this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove");b.current===this&&(b.current=null);this.__popup.remove();this.__backdrop.remove();this.__mask.remove();k||c(window).off("resize",this.reset);this.__dispatchEvent("remove");for(var a in this)delete this[a];return this},reset:function(){var a=this.follow;return a?this.__follow(a):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var a=this.node,d=this.__popup,e=b.current,f=this.zIndex=b.zIndex++;
(e&&e!==this&&e.blur(!1),c.contains(a,this.__getActive()))||(e=d.find("[autofocus]")[0],!this._autofocus&&e?this._autofocus=!0:e=a,this.__focus(e));return d.css("zIndex",f),b.current=this,d.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(a){var b=this.__activeElement;return!1!==a&&this.__focus(b),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(a,b){return this.__getEventListener(a).push(b),
this},removeEventListener:function(a,b){a=this.__getEventListener(a);for(var c=0;c<a.length;c++)b===a[c]&&a.splice(c--,1);return this},__getEventListener:function(a){var b=this.__listener;return b||(b=this.__listener={}),b[a]||(b[a]=[]),b[a]},__dispatchEvent:function(a){var b=this.__getEventListener(a);this["on"+a]&&this["on"+a]();for(a=0;a<b.length;a++)b[a].call(this)},__focus:function(a){try{this.autofocus&&!/^iframe$/i.test(a.nodeName)&&a.focus()}catch(q){}},__getActive:function(){try{var a=document.activeElement,
b=a.contentDocument;return b&&b.activeElement||a}catch(y){}},__center:function(){var a=this.__popup,b=c(window),d=c(document),e=this.fixed,f=e?0:d.scrollLeft();d=e?0:d.scrollTop();e=b.width();var g=b.height();b=a.width();var k=a.height();g=382*(g-k)/1E3+d;a=a[0].style;a.left=Math.max(parseInt((e-b)/2+f),f)+"px";a.top=Math.max(parseInt(g),d)+"px"},__follow:function(a){var b=a.parentNode&&c(a),d=this.__popup;if(this.__followSkin&&d.removeClass(this.__followSkin),b){var e=b.offset();if(0>e.left*e.top)return this.__center()}var f=
this.fixed,g=c(window);e=c(document);var k=g.width(),m=g.height(),h=e.scrollLeft(),F=e.scrollTop();e=d.width();g=d.height();var K=b?b.outerWidth():0,L=b?b.outerHeight():0,C=this.__offset(a);a=C.left;C=C.top;a=f?a-h:a;C=f?C-F:C;h=f?0:h;f=f?0:F;k=h+k-e;m=f+m-g;F={};var v=this.align.split(" "),B=this.className+"-",z={top:"bottom",bottom:"top",left:"right",right:"left"},H={top:"top",bottom:"top",left:"left",right:"left"},u=[{top:C-g,bottom:C+L,left:a-e,right:a+K},{top:C,bottom:C-g+L,left:a,right:a-e+
K}];e={left:a+K/2-e/2,top:C+L/2-g/2};var x={left:[h,k],top:[f,m]};c.each(v,function(a,b){u[a][b]>x[H[b]][1]&&(b=v[a]=z[b]);u[a][b]<x[H[b]][0]&&(v[a]=z[b])});v[1]||(H[v[1]]="left"===H[v[0]]?"top":"left",u[1][v[1]]=e[H[v[1]]]);this.__followSkin=B+=v.join("-")+" "+this.className+"-follow";b&&d.addClass(B);F[H[v[0]]]=parseInt(u[0][v[0]]);F[H[v[1]]]=parseInt(u[1][v[1]]);d.css(F)},__offset:function(a){var b=a.parentNode,d=b?c(a).offset():{left:a.pageX,top:a.pageY};a=b?a:a.target;b=a.ownerDocument;a=b.defaultView||
b.parentWindow;if(a==window)return d;a=a.frameElement;var e=c(b);b=e.scrollLeft();e=e.scrollTop();a=c(a).offset();return{left:d.left+a.left-b,top:d.top+a.top-e}}}),b.zIndex=6666,b.current=null,b});b("dialog-config",{backdropBackground:"#000",backdropOpacity:.7,content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",padding:"",skin:"",quickClose:!1,cssUri:"../css/ui-dialog.css",
innerHTML:'<div i="dialog" class="ui-dialog"><div class="ui-dialog-arrow-a"></div><div class="ui-dialog-arrow-b"></div><table class="ui-dialog-grid"><tr><td i="header" class="ui-dialog-header"><button i="close" class="ui-dialog-close">&#215;</button><div i="title" class="ui-dialog-title"></div></td></tr><tr><td i="body" class="ui-dialog-body"><div i="content" class="ui-dialog-content"></div></td></tr><tr><td i="footer" class="ui-dialog-footer"><div i="statusbar" class="ui-dialog-statusbar"></div><div i="button" class="ui-dialog-button"></div></td></tr></table></div>'});
b("dialog",function(a){var b=a("jquery"),c=a("popup"),d=a("dialog-config"),k=d.cssUri;k&&(a=a[a.toUrl?"toUrl":"resolve"])&&(k=a(k),k='<link rel="stylesheet" href="'+k+'" />',b("base")[0]?b("base").before(k):b("head").append(k));var h=0,m=new Date-0;k=!("minWidth"in b("html")[0].style);var q="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),y=!k&&!q,t=function(a,c,d){var e=a=a||{};"string"!=typeof a&&1!==a.nodeType||(a={content:a,fixed:!q});a=b.extend(!0,
{},t.defaults,a);a.original=e;e=a.id=a.id||m+h;var f=t.get(e);return f?f.focus():(y||(a.fixed=!1),a.quickClose&&(a.modal=!0,a.backdropOpacity=0),b.isArray(a.button)||(a.button=[]),void 0!==d&&(a.cancel=d),a.cancel&&a.button.push({id:"cancel",value:a.cancelValue,callback:a.cancel,display:a.cancelDisplay}),void 0!==c&&(a.ok=c),a.ok&&a.button.push({id:"ok",value:a.okValue,callback:a.ok,autofocus:!0}),t.list[e]=new t.create(a))};k=function(){};k.prototype=c.prototype;k=t.prototype=new k;return t.create=
function(a){var d=this;b.extend(this,new c);var e=(a.original,b(this.node).html(a.innerHTML)),f=b(this.backdrop);return this.options=a,this._popup=e,b.each(a,function(a,b){"function"==typeof d[a]?d[a](b):d[a]=b}),a.zIndex&&(c.zIndex=a.zIndex),e.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",!1===this.cancel?"none":"").attr("title",this.cancelValue).on("click",
function(a){d._trigger("cancel");a.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),a.quickClose&&f.on("onmousedown"in document?"mousedown":"click",function(){return d._trigger("cancel"),!1}),this.addEventListener("show",function(){f.css({opacity:0,background:a.backdropBackground}).animate({opacity:a.backdropOpacity},150)}),this._esc=function(a){var b=a.target,e=b.nodeName,f=/^input|textarea$/i;a=a.keyCode;c.current!==d||f.test(e)&&"button"!==b.type||
27===a&&d._trigger("cancel")},b(document).on("keydown",this._esc),this.addEventListener("remove",function(){b(document).off("keydown",this._esc);delete t.list[this.id]}),h++,t.oncreate(this),this},t.create.prototype=k,b.extend(k,{content:function(a){var c=this._$("content");return"object"==typeof a?(a=b(a),c.empty("").append(a.show()),this.addEventListener("beforeremove",function(){b("body").append(a.hide())})):c.html(a),this.reset()},title:function(a){return this._$("title").text(a),this._$("header")[a?
"show":"hide"](),this},width:function(a){return this._$("content").css("width",a),this.reset()},height:function(a){return this._$("content").css("height",a),this.reset()},button:function(a){a=a||[];var c=this,d="",e=0;return this.callbacks={},"string"==typeof a?(d=a,e++):b.each(a,function(a,f){var g=f.id=f.id||f.value;a="";c.callbacks[g]=f.callback;!1===f.display?a=' style="display:none"':e++;d+='<button type="button" i-id="'+g+'"'+a+(f.disabled?" disabled":"")+(f.autofocus?' autofocus class="ui-dialog-autofocus"':
"")+">"+f.value+"</button>";c._$("button").on("click","[i-id="+g+"]",function(a){b(this).attr("disabled")||c._trigger(g);a.preventDefault()})}),this._$("button").html(d),this._$("footer")[e?"show":"hide"](),this},statusbar:function(a){return this._$("statusbar").html(a)[a?"show":"hide"](),this},_$:function(a){return this._popup.find("[i="+a+"]")},_trigger:function(a){a=this.callbacks[a];return"function"!=typeof a||!1!==a.call(this)?this.close().remove():this}}),t.oncreate=b.noop,t.getCurrent=function(){return c.current},
t.get=function(a){return void 0===a?t.list:t.list[a]},t.list={},t.defaults=d,t});window.dialog=a("dialog")}();var maxTickDepth=100,toString=Object.prototype.toString,nextTick="function"===typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},isArray=Array.isArray||function(a){return"[object Array]"===toString.call(a)};function slice(a,b){var c=a.length,d=Array(c);for(b=b||0;c-- >b;)d[c-b]=a[c];return d}function carry(a,b){try{b.apply(null,slice(arguments,2))}catch(c){a(c)}}
function defer(a,b){var c=slice(arguments,2);nextTick(function(){try{b.apply(null,c)}catch(d){a(d)}})}
function Thenjs(a,b){if(a instanceof Thenjs)return a;if(!(this instanceof Thenjs))return new Thenjs(a,b);this._finally=this._error=this._fail=this._result=this._nextThen=this._chain=this._success=this._each=this._eachSeries=this._parallel=this._series=null;if(!arguments.length)return this;var c=genContinuation(this,b);try{"function"===typeof a?a(c):null==a?c():"function"===typeof a.toThunk?a.toThunk()(c):"function"===typeof a.then?a.then(function(a){c(null,a)},c):c(null,a)}catch(d){c(d)}}
Thenjs.defer=defer;Thenjs.each=function(a,b,c){return thenFactory(function(c){defer(c,each,c,a,b)},null,c)};Thenjs.eachSeries=function(a,b,c){return thenFactory(function(c){defer(c,eachSeries,c,a,b)},null,c)};Thenjs.parallel=function(a,b){return thenFactory(function(b){defer(b,parallel,b,a)},null,b)};Thenjs.series=function(a,b){return thenFactory(function(b){defer(b,series,b,a)},null,b)};Thenjs.nextTick=function(a){var b=slice(arguments,1);nextTick(function(){a.apply(null,b)})};
Thenjs.onerror=function(a){console.error("Thenjs caught error: ",a);throw a;};var proto=Thenjs.prototype;proto.fin=proto.all=proto["finally"]=function(a){return thenFactory(function(b,c){c._finally=wrapTaskHandler(b,a)},this)};proto.then=function(a,b){return thenFactory(function(c,d){d._success=wrapTaskHandler(c,a);d._error=b&&wrapTaskHandler(c,b)},this)};
proto.fail=proto["catch"]=function(a){return thenFactory(function(b,c){c._fail=wrapTaskHandler(b,a);c._success=function(){b.apply(null,[null].concat(slice(arguments)))}},this)};proto.each=function(a,b){return thenFactory(function(c,d){d._each=function(d,f){each(c,a||d,b||f)}},this)};proto.eachSeries=function(a,b){return thenFactory(function(c,d){d._eachSeries=function(d,f){eachSeries(c,a||d,b||f)}},this)};
proto.parallel=function(a){return thenFactory(function(b,c){c._parallel=function(c){parallel(b,a||c)}},this)};proto.series=function(a){return thenFactory(function(b,c){c._series=function(c){series(b,a||c)}},this)};proto.toThunk=function(){var a=this;return function(b){a._result?(b.apply(null,a._result),a._result=!1):!1!==a._result&&(a._finally=b)}};
function continuation(a){var b=this,c=arguments;if(!1!==b._result){!b._result&&b._chain&&b.debug.apply(b,["\nChain "+b._chain+": "].concat(slice(c)));b._result=!1;try{continuationExec(b,c,a)}catch(d){nextTick(function(){continuationError(b,d,a)})}}}function continuationExec(a,b,c){if(a._finally)return a._finally.apply(null,b);if(null!=c)throw c;if(c=a._success||a._each||a._eachSeries||a._parallel||a._series)return c.apply(null,slice(b,1));a._result=b}
function continuationError(a,b,c){var d=a,e=a._error||a._fail;a._nextThen&&null==c&&(e=null,d=a._nextThen);for(;!e&&d;)e=d._fail,d=d._nextThen;if(e)return e(b);if(Thenjs.onerror)return Thenjs.onerror(b);d._result=[b]}function genContinuation(a,b){function c(){return continuation.apply(a,arguments)}c._isCont=!0;b&&(proto.debug="function"===typeof b?b:defaultDebug,a._chain=1);return c}
function thenFactory(a,b,c){var d=new Thenjs;c=genContinuation(d,c);a(c,b);if(!b)return d;b._nextThen=d;b._chain&&(d._chain=b._chain+1);b._result&&nextTick(function(){continuation.apply(b,b._result)});return d}function wrapTaskHandler(a,b){return b._isCont?b:function(){b.apply(null,[a].concat(slice(arguments)))}}function parallelNext(a,b,c,d){function e(e,g){if(!c.finished){if(null!=e)return c.finished=!0,a(e);b[d]=g;return 0>--c.i&&a(null,b)}}e._isCont=!0;return e}
function each(a,b,c){var d,e=[],f={};if(!isArray(b))return a(errorify(b,"each"));f.i=d=b.length-1;if(0>d)return a(null,e);for(var g=0;g<=d;g++)c(parallelNext(a,e,f,g),b[g],g,b)}function parallel(a,b){var c,d=[],e={};if(!isArray(b))return a(errorify(b,"parallel"));e.i=c=b.length-1;if(0>c)return a(null,d);for(var f=0;f<=c;f++)b[f](parallelNext(a,d,e,f),f,b)}
function eachSeries(a,b,c){function d(m,q){if(null!=m)return a(m);f[e]=q;if(++e>h)return a(null,f);g=0<--k?carry:(k=maxTickDepth,defer);g(a,c,d,b[e],e,b)}var e=0,f=[],g,k=maxTickDepth;d._isCont=!0;if(!isArray(b))return a(errorify(b,"eachSeries"));var h=b.length-1;if(0>h)return a(null,f);c(d,b[0],0,b)}
function series(a,b){function c(h,m){if(null!=h)return a(h);e[d]=m;if(++d>k)return a(null,e);f=0<--g?carry:(g=maxTickDepth,defer);f(a,b[d],c,d,b)}var d=0,e=[],f,g=maxTickDepth;c._isCont=!0;if(!isArray(b))return a(errorify(b,"series"));var k=b.length-1;if(0>k)return a(null,e);b[0](c,0,b)}function defaultDebug(){console.log.apply(console,arguments)}function errorify(a,b){return Error("The argument "+(a&&a.toString())+' in "'+b+'" is not Array!')}Thenjs.NAME="Thenjs";Thenjs.VERSION="1.3.4";
var instance,root=window,KG=function(){function a(a,b){var c=t.length,d=a.constructor;d=r.is("Function",d)&&d.prototype||ObjProto;var e="constructor";for(r.has(a,e)&&!_.contains(b,e)&&b.push(e);c--;)e=t[c],e in a&&a[e]!==d[e]&&!_.contains(b,e)&&b.push(e)}function b(a){a=JSON.stringify(a);return e?a.replace(/\\u([0-9a-fA-F]{2,4})/g,function(a,b){return String.fromCharCode(parseInt(b,16))}):a}function c(){var a=navigator.userAgent.toLowerCase();return"micromessenger"==a.match(/MicroMessenger/i)?!1:
"qq"==a.match(/QQ/i)?!1:"weibo"==a.match(/WeiBo/i)?!1:null!=a.match(/Android/i)?null==a.match(/browser/i):null!=a.match(/iPhone/i)?null==a.match(/safari/i):null==a.match(/macintosh/i)&&null==a.match(/windows/i)}function d(a){for(var c=[],d=0;d<a.length;d++){var e={};e.type=U[Object.prototype.toString.call(a[d]).slice(8,-1)];e.value=a[d];c.push(e)}return b(c)}var e=!1;root.JSON&&(e='{"x":"\u4e2d"}'!==root.JSON.stringify({x:"\u4e2d"}));var f=!!window.ActiveXObject||"ActiveXObject"in window,g=function(a,
b){a=this.words=a||[];this.sigBytes=void 0!=b?b:4*a.length};g.prototype={clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-b%4*8;a.length=Math.ceil(b/4)},toString:function(a){return(a||k).stringify(this)}};var k={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,
2),16)<<24-d%8*4;return new g.init(c,b/2)}},h={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(a.charCodeAt(d)&255)<<24-d%4*8;return new g(c,b)}},m={stringify:function(a){try{return decodeURIComponent(escape(h.stringify(a)))}catch(Q){throw Error("Malformed UTF-8 data");}},parse:function(a){return h.parse(unescape(encodeURIComponent(a)))}},
q=function(a){this.map=a};q.map={};q.of=function(a){a=a||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var b=q.map[a];b||(b=new q(a));return b};q.prototype={decodeByte:function(a){var b=a.length,c=this.map,d=c.charAt(64);d&&(d=a.indexOf(d),-1!=d&&(b=d));d=[];for(var e=0,f=0;f<b;f++)if(f%4){var T=c.indexOf(a.charAt(f-1))<<f%4*2,n=c.indexOf(a.charAt(f))>>>6-f%4*2;d[e>>>2]|=(T|n)<<24-e%4*8;e++}return new g(d,e)},decode:function(a){return m.stringify(this.decodeByte(a))},encode:function(a){if(a)return this.encodeByte(m.parse(a))},
encodeByte:function(a){var b=a.words,c=a.sigBytes,d=this.map;a.clamp();a=[];for(var e=0;e<c;e+=3)for(var f=(b[e>>>2]>>>24-e%4*8&255)<<16|(b[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|b[e+2>>>2]>>>24-(e+2)%4*8&255,n=0;4>n&&e+.75*n<c;n++)a.push(d.charAt(f>>>6*(3-n)&63));if(b=d.charAt(64))for(;a.length%4;)a.push(b);return a.join("")}};var y=!{toString:null}.propertyIsEnumerable("toString"),t="valueOf isPrototypeOf toString propertyIsEnumerable hasOwnProperty toLocaleString".split(" "),w=function(a,b){var c=a.length,
d=[];for(b=b||0;c-- >b;)d[c-b]=a[c];return d},J=function(){},r={Utf8:m,Base64:q,slice:w,boolean:function(a,b,c){return!(a.hasOwnProperty(b)?!a[b]:!c)},rand:function(a){return Math.ceil((9301*(new Date).getTime()+49297)%233280/233280*a)},addEvent:function(a){var b=c();return a?function(a,b,c){b=b.split(" ");for(var d=0;d<b.length;d++)a.attachEvent("on"+b[d],function(b){b.target=a;b.preventDefault=J;b.stopPropagation=J;c(b)})}:function(a,c,d){void 0===a.eventList&&(a.eventList={});for(var e=c.split(" "),
f=0;f<e.length;f++){for(var Q in a.eventList)if(Q===e[f])return;b?a.addEventListener(e[f],d):document.addEventListener.apply(a,[e[f]].concat(r.slice(arguments,2)));a.eventList[e[f]]=!0}}}(root.document.attachEvent),extend:function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;e<d;e++)for(var f=arguments[e],Q=a(f),n=Q.length,T=0;T<n;T++){var g=Q[T];b&&void 0!==c[g]||(c[g]=f[g])}return c}}(function(b){if(!r.is("Object",b))return[];var c=[],d;for(d in b)c.push(d);
y&&a(b,c);return c}),filter:function(a,b){var c={},d=b;if(r.is("String",b)){var e=r.slice(arguments,1);d=function(a){for(var b=0;b<e.length;b++)if(e[b]===a)return!1;return!0}}for(var f in a)(e=d.call(a,f))&&(c[f]=a[f]);return c},convertText:function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].replace(/(\S)/ig,"<span>$1</span>").replace(/\n|\r/ig,"<span><br></span>").replace(/\s/ig,"<span>&nbsp;</span>");return b},handleEdittable:function(a,b){var c=[],d=0,e=0;$.each(a.find("span"),function(b,n){b=
$(n).text()||$(n).html();var Q={};"<br>"==b&&(d=0,e=f?e+$(n).height()/2:e+$(n).height(),b="");0==e&&(e=$(n).height());d>=a.width()-$(n).width()&&(d=0,e+=$(n).height());Q.txt=b;Q.left=d;Q.top=e;c.push(Q);""!=b&&(d+=$(n).width())});return c},val:function(a,b){if(r.is("Function",a)){var c=3>arguments.length?[]:[].slice.call(arguments).slice(2);return a.apply(b,c)}return a},$:function(a){var b=document.getElementById(a);if(!b){var c=document.getElementsByName(a);c&&0<c.length&&(b=c[0])}b||(c=document.getElementsByTagName(a))&&
0<c.length&&(b=c[0]);return b},keys:function(b){if(!r.is("Object",b))return[];if(nativeKeys)return nativeKeys(b);var c=[],d;for(d in b)r.has(b,d)&&c.push(d);y&&a(b,c);return c},contains:function(a,b,c){var d=a&&a.length;"number"==typeof d&&0<=d&&d<=MAX_ARRAY_INDEX||(a=_.values(a));return 0<=_.indexOf(a,b,"number"==typeof c&&c)},values:function(a){for(var b=_.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},has:function(a,b){return null!=a&&Object.prototype.hasOwnProperty.call(a,b)},
inherit:function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.uber=b.prototype},is:function(a,b){var c=Object.prototype.toString.call(b).slice(8,-1);return void 0!==b&&null!==b&&c===a},colorRgb:function(a){a=a.toLowerCase();var b=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(a&&b.test(a)){if(4===a.length){var c="#";for(b=1;4>b;b+=1)c+=a.slice(b,b+1).concat(a.slice(b,b+1));a=c}c=[];for(b=1;7>b;b+=2)c.push(parseInt("0x"+a.slice(b,b+2)));return"RGB("+c.join(",")+
")"}return a},colorHex:function(a){if(/^(rgb|RGB)/.test(a)){for(var b=a.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),c="#",d=0;d<b.length;d++){var e=Number(b[d]).toString(16);"0"===e&&(e+=e);c+=e}7!==c.length&&(c=a);return c.toUpperCase()}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(a)&&(b=a.replace(/#/,"").split(""),6!==b.length&&3===b.length))for(a="#",d=0;d<b.length;d+=1)a+=b[d]+b[d];return a.toUpperCase()},dateConvert:function(a,b){var c=["\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".split(""),
"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".split("")];a=a.match(/^(\d{2}|\d{4})(\u5e74)(\d{1,2})(\u6708)(\d{1,2})(\u65e5)$/);var d="";if(null!=a){for(var e=1;e<a.length;e+=2){var f=a[e];if(2==f.length)f="1"==f.charAt(0)?"0"==f.charAt(1)?"\u5341":"\u5341"+c[b-1][f.charAt(1)]:"0"==f.charAt(1)?c[b-1][f.charAt(0)]+"\u5341":c[b-1][f.charAt(0)]+"\u5341"+c[b-1][f.charAt(1)];else{for(var n="",g=0;g<f.length;g++)n+=c[b-1][f.charAt(g)];f=n}d+=f+a[e+1]}return d}},formatDate:function(a,b){var c=
"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getMonth()],d={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));/(MMM)/.test(b)&&(b=b.replace(RegExp.$1,"$"));for(var e in d)(new RegExp("("+e+")")).test(b)&&(a=d[e],2==RegExp.$1.length&&(a=("00"+d[e]).substr((""+d[e]).length)),b=b.replace(RegExp.$1,
a));b=b.replace("$",c);/[*]/gi.test(b)&&(c=b.replace(/[*]/gi,""),b=this.dateConvert(c,b.length-c.length));return b},template:function(a,b){for(var c=/<%([^%>]+)?%>/g,d=/(^( )?(var|if|for|else|switch|case|break|{|}))(.*)?/g,e="var r=[];\n",f=0,n=function(a,b){b?e+=a.match(d)?a+"\n":"r.push("+a+");\n":e+=""!=a?'r.push("'+a.replace(/"/g,'\\"')+'");\n':"";return n},g;g=c.exec(a);)n(a.slice(f,g.index))(g[1],!0),f=g.index+g[0].length;n(a.substr(f,a.length-f));e+='return r.join("");';return(new Function(e.replace(/[\r\t\n]/g,
""))).apply(b,w(arguments,2))},first:function(a,b){return a.substring(0,1)[b?"toLowerCase":"toUpperCase"]()+a.substring(1)},html2Escape:function(a){return a.replace(/[<>&"]/g,function(a){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[a]})}},G=function(a){this.name=a};G.prototype={on:function(a,b){this.__getEventListener(a).push(b);return this},off:function(a,b){a=this.__getEventListener(a);for(var c=0;c<a.length;c++)b===a[c]&&a.splice(c--,1);return this},clear:function(a){0<this.__getEventListener(a).length&&
(this.__listener[a]=[]);return this},trigger:function(a){var b,c=this.__getEventListener(a),d=Array.prototype.slice.call(arguments);this["on"+a]&&(b=this["on"+a].apply(this,d.slice(1)));for(var e=0;e<c.length;e++)c[e].apply(this,d.slice(1));return b},__getEventListener:function(a){var b=this.__listener;b||(b=this.__listener={});b[a]||(b[a]=[]);return b[a]}};var O=function(a,b){var c=0,d="",e;for(e in a){var f=a[e];if(void 0!=f){var n=function(a){0<c&&(d+=b);d+=e+"="+a;c++};if(r.is("Array",f))for(var g=
0;g<f.length;g++)n(f[g]);else n(f)}}M.trigger("formatData",d);return d},F=function(a,b){var c="";b=b||"";if(r.is("Array",a))for(var d=0;d<a.length;d++)0<d&&(c+=b),c+=O(a[d],b);else c=O(a,b);return c},K={result:!1,errcode:"interErr"},L={result:!1,errcode:"responseErr"},C={result:!1,errcode:"connectionErr"},v={result:!1,errcode:"parseErr"},B={result:!1,errcode:"timeoutErr"},z=function(a,b){M.trigger.apply(M,["response",b].concat(this));w(arguments,1);a&&a(b)},H=function(a,b){this.url=a;this.data=b;
M.trigger("beforeJSONP",a,b)},u=H.prototype;u.parseData=function(){var a="",b=this.data;if(r.is("String",b))a=b;else if(r.is("Object",b))for(var c in b)b[c]&&(a+="&"+c+"="+encodeURIComponent(b[c]));else if(r.is("Array",b))for(var d=0;d<b.length;d++){var e=b[d];for(c in e)e[c]&&(a+="&"+c+"="+encodeURIComponent(e[c]))}a+="&hookback="+this.name;a+="&_="+(new Date).getTime();a=a.substr(1);M.trigger("parseData",a);return a};u.getJSON=function(a){var b=this,c=b.url,d=b.data,e=this.name="jsonp_"+(new Date).getTime()+
"_"+r.rand(1E5);c=c+(-1===c.indexOf("?")?"?":"&")+this.parseData(d);var f=document.createElement("script");f.type="text/javascript";f.src=c;f.id=e;f.charset="utf-8";var n=function(){setTimeout(function(){clearTimeout(g);f.parentNode.removeChild(f);try{delete window[e]}catch(A){}},1)};window[e]=function(c){b._execed=!0;z.call(b,a,c)};f.onload=function(){n();b._execed||z.call(b,a,v)};f.onerror=function(){n();void 0!==Signature.options.isResponseErr&&Signature.options.isResponseErr||z.call(b,a,L)};var g=
setTimeout(function(){n();z.call(b,a,B)},D.options.timeout);(c=document.getElementsByTagName("head"))&&c[0]&&c[0].appendChild(f)};var x=function(a,b){this.url=a;this.data=b;this.xdr=new XDomainRequest};x.prototype.getJSON=function(a){var b=this.xdr;b.onload=function(){try{var c=JSON.parse(b.responseText)}catch(Z){z.call(b,a,v);return}z.call(b,a,c)};b.onerror=function(){z.call(b,a,C)};b.timeout=D.options.timeout;b.ontimeout=function(){z.call(b,a,B)};b.open("POST",this.url);b.send(F(this.data,"\r\n")+
"\r\na=1")};var l=function(a,b){if(window.XMLHttpRequest)var c=new XMLHttpRequest;else if(window.ActiveXObject)for(var d=0;d<activexName.length;d++)try{c=new ActiveXObject(activexName[d]);break}catch(aa){}this.xhr=c;this.url=a;this.data=b};l.prototype.getJSON=function(a){var b=this.xhr,c=!1;b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status||304==b.status)try{var d=JSON.parse(b.responseText);z.call(b,a,d)}catch(ba){z.call(b,a,v)}else c&&z.call(b,a,L)};b.open("POST",this.url,!0);b.onerror=
function(){z.call(b,a,C)};b.timeout=D.options.timeout;b.ontimeout=function(){c=!0;z.call(b,a,B)};b.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var d=F(this.data,"\r\n");b.send(d)};var P="withCredentials"in XMLHttpRequest.prototype?!1:"undefined"!=typeof XDomainRequest?!0:!1,R=function(a,b,c){M.trigger.apply(M,["beforeAjax"].concat(w(arguments)));return c?new H(a,b):P?new x(a,b):new l(a,b)},U={Boolean:"BOOL",String:"BSTR",Number:"LONG"},D=function(){};D.errCode={1E4:"\u7cfb\u7edf\u9519\u8bef",
20001:"\u5bc6\u94a5\u76d8\u4fe1\u606f\u9519\u8bef",20003:"\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u5bc6\u7801",20004:"\u8bf7\u8f93\u5165\u5bc6\u7801!",11100:"\u7b7e\u7ae0\u670d\u52a1\u5668\u9519\u8bef",111001:"\u8be5\u7528\u6237\u6ca1\u6709\u516c\u7ae0",111002:"\u8be5\u7528\u6237\u6ca1\u6709\u79c1\u7ae0",111003:"\u8be5\u7528\u6237\u6ca1\u6709\u6cd5\u4eba\u7ae0",111004:"\u8be5\u7528\u6237\u6ca1\u6709\u6cd5\u4eba\u7b7e\u540d\u5370\u7ae0",111005:"\u8be5\u7528\u6237\u6ca1\u6709\u624b\u5199\u7b7e\u540d\u5370\u7ae0",
11101:"\u5f53\u524d\u7528\u6237\u6ca1\u6709\u7b7e\u7ae0",11102:"\u5370\u7ae0\u9519\u8bef",11103:"\u8bc1\u4e66\u8fc7\u671f",11104:"\u5370\u7ae0\u8fc7\u671f",11105:"\u83b7\u53d6\u7b7e\u7ae0\u4fe1\u606f\u5931\u8d25!",11106:"\u83b7\u53d6\u8bc1\u4e66\u4fe1\u606f\u5931\u8d25!",11107:"\u672a\u641c\u7d22\u5230\u60a8\u8981\u7684\u7b7e\u7ae0!",11108:"\u672a\u8bbe\u7f6e\u7b7e\u7ae0\u5bc6\u7801!",11109:"\u64cd\u4f5c\u5931\u8d25\uff0c\u7b7e\u7ae0\u52a9\u624b\u672a\u542f\u7528\u6216\u672a\u6388\u6743",11110:"\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u62d4\u6389\u5f53\u524d\u94a5\u5319\u76d8\u518d\u8fdb\u884c\u64cd\u4f5c",
11111:"\u5141\u8bb8\u79fb\u52a8\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u539f\u7b7e\u7ae0\u5bc6\u94a5\u5141\u8bb8\u79fb\u52a8\uff01",11112:"\u5141\u8bb8\u79fb\u52a8\u5931\u8d25\uff0c\u8be5\u7b7e\u7ae0\u6570\u636e\u6ca1\u6709\u5141\u8bb8\u79fb\u52a8\u8bf7\u6c42\u6743\u9650\uff01",11113:"\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u624b\u5199\u7b7e\u540d\u3002",none:"\u5ba2\u6237\u7aef\u672a\u77e5\u5f02\u5e38!",signErr:"\u7b7e\u540d\u5931\u8d25",serverErr:"\u8c03\u7528\u4ea7\u54c1\u7ec4\u4ef6\u5f02\u5e38",
parseErr:"\u6570\u636e\u683c\u5f0f\u5f02\u5e38",responseErr:"\u4ea7\u54c1\u7ec4\u4ef6\u54cd\u5e94\u5f02\u5e38",connectionErr:"\u4ea7\u54c1\u7ec4\u4ef6\u8fde\u63a5\u5f02\u5e38",timeoutErr:"\u8bf7\u6c42\u54cd\u5e94\u8d85\u65f6",interErr:"\u83b7\u53d6\u63a5\u53e3\u5f02\u5e38","-7":"\u7b7e\u540d\u7ec4\u4ef6\u9519\u8bef"};r.extend(D.errCode,{then:{"-1":"\u8bf7\u5b89\u88c5\u5ba2\u6237\u7aef","-2":"\u8bf7\u63d2\u5165\u5f53\u524d\u7b7e\u7ae0\u6240\u5c5e\u7684\u5bc6\u94a5\u76d8","-3":"\u672a\u5b89\u88c5\u624b\u673a\u76fe\u7ec4\u4ef6",
"-12":"\u83b7\u53d6\u8bc1\u4e66\u5931\u8d25","-13":"\u7b7e\u540d\u65f6\uff0c\u52a0\u8f7d\u8bc1\u4e66\u5931\u8d25","-15":"\u7b7e\u540d\u6570\u636e\u4e0d\u80fd\u4e3a\u7a7a","-16":"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a","-17":"\u89e3\u6790\u8bc1\u4e66\u5931\u8d25","-18":"\u672a\u5b89\u88c5\u624b\u673a\u76fe\u7ec4\u4ef6","-19":"\u624b\u673a\u76fe\u767b\u5f55\u5931\u8d25",1:"\u6ca1\u6709\u68c0\u6d4b\u5230\u5bc6\u94a5\u76d8",2:"\u5bc6\u94a5\u76d8\u6ca1\u6709\u6b63\u786e\u521d\u59cb\u5316",3:"\u5bc6\u94a5\u76d8\u9a71\u52a8\u672a\u5b89\u88c5",
4:"\u53ea\u80fd\u63d2\u5165\u4e00\u4e2a\u5bc6\u94a5\u76d8",7:"\u5bc6\u7801\u9519\u8bef\u6216\u5bc6\u94a5\u76d8\u88ab\u9501\u5b9a",8:"\u975e\u6cd5\u6388\u6743",9:"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25",10:"\u624b\u673a\u76fe\u767b\u5f55\u5931\u8d25",11:"\u5f53\u524d\u5bc6\u94a5\u76d8\u6ca1\u6709\u5370\u7ae0",12:"\u83b7\u53d6\u5370\u7ae0\u4fe1\u606f\u5931\u8d25",35:"\u94a5\u5319\u76d8\u672a\u751f\u6548\uff0c\u4e0d\u80fd\u7b7e\u7ae0\uff01",36:"\u94a5\u5319\u76d8\u5df2\u8fc7\u671f\uff0c\u4e0d\u80fd\u7b7e\u7ae0\uff01",
37:"\u6388\u6743\u4fe1\u606f\u7ed3\u6784\u975e\u6cd5\uff01",38:"\u7b7e\u7ae0\u8bc1\u4e66\u5df2\u7ecf\u8fc7\u671f\u6216\u8fd8\u672a\u751f\u6548\uff01",39:"\u7b7e\u7ae0\u8bc1\u4e66\u4e0d\u53d7\u9881\u53d1\u673a\u6784\u4fe1\u4efb\uff01",40:"\u7b7e\u7ae0\u8bc1\u4e66\u5df2\u88ab\u540a\u9500\uff01",41:"\u7b7e\u7ae0\u8bc1\u4e66\u6839\u8bc1\u4e66\u672a\u5b89\u88c5\u6216\u65e0\u6548\u7684\u6839\u8bc1\u4e66\uff01",42:"\u540a\u9500\u5217\u8868\u6587\u4ef6\u4e0d\u5b58\u5728",43:"\u672a\u68c0\u6d4b\u5230\u8bc1\u4e66",
44:"\u6839\u8bc1\u4e66\u6587\u4ef6\u4e0d\u5b58\u5728",45:"\u6839\u8bc1\u4e66\u548c\u8be5\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\u4e0d\u914d\u5957",46:"\u540a\u9500\u5217\u8868\u548c\u8be5\u8bc1\u4e66\u7684\u540a\u9500\u5217\u8868\u4e0d\u914d\u5957","-101":"\u83b7\u53d6\u5bc6\u94a5\u76d8\u6709\u6548\u671f\u5f02\u5e38","-103":"\u5bc6\u94a5\u76d8\u672a\u751f\u6548","-104":"\u671f\u9650\u8bb8\u53ef\u5df2\u8fc7\u671f","-999":"\u91d1\u683c\u7ec4\u4ef6\u672a\u77e5\u9519\u8bef","30001@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u7b7e\u540d\u503c\u5931\u8d25\uff01",
"30002@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5236\u7ae0\u4eba\u8bc1\u4e66\u6709\u6548\u671f\u5931\u8d25\uff01","30003@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u7684\u6709\u6548\u671f\u5931\u8d25\uff01","30004@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u6709\u6548\u6027\u5931\u8d25\uff01","30005@gm":"\u9a8c\u8bc1\u7535\u5b50\u5370\u7ae0\u5931\u8d25\uff1a\u9a8c\u8bc1\u7535\u5b50\u7b7e\u7ae0\u6570\u636e\u5931\u8d25\uff01",
"-7@KGCrySignMessage":"\u7b7e\u540d\u7ec4\u4ef6\u9519\u8bef","8@KGVerifySign":"\u9a8c\u8bc1\u5931\u6548","1@KGVerifySign":"\u672a\u5b89\u88c5\u7b7e\u540d\u7ec4\u4ef6","2@KGCrySignMessage":"\u83b7\u53d6\u8bc1\u4e66\u5931\u8d25","3@KGCrySignMessage":"\u7b7e\u540d\u65f6\uff0c\u52a0\u8f7d\u8bc1\u4e66\u5931\u8d25","5@KGCrySignMessage":"\u7b7e\u540d\u6570\u636e\u4e0d\u80fd\u4e3a\u7a7a","6@KGCrySignMessage":"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a","7@KGCrySignMessage":"\u89e3\u6790\u8bc1\u4e66\u5931\u8d25"},
KGRunFingerPrints:{"-1":"\u8bbe\u5907\u7c7b\u578b\u8bbe\u7f6e\u9519\u8bef","-2":"\u6ca1\u6709\u5b89\u88c5\u6307\u7eb9\u7ec4\u4ef6","-3":"\u6307\u7eb9\u91c7\u96c6\u5931\u8d25"},KGRunHandWritten:{"-1":"\u8bbe\u5907\u7c7b\u578b\u8bbe\u7f6e\u9519\u8bef","-2":"\u6ca1\u6709\u5b89\u88c5\u624b\u5199\u7ec4\u4ef6","-3":"\u6388\u6743\u7801\u4e0d\u6b63\u786e","-4":"\u7b7e\u540d\u53d6\u6d88","-5":"\u65e0\u670d\u52a1\u53ef\u7528","-6":"\u7b7e\u540d\u8bbe\u5907\u9519\u8bef","-7":"\u672a\u77e5\u9519\u8bef"},KGGetTSWithDigest:{1:"\u83b7\u53d6\u65f6\u95f4\u6233\u5f02\u5e38",
2:"\u83b7\u53d6\u65f6\u95f4\u6233\u5931\u8d25",3:"\u54cd\u5e94\u6570\u636e\u4e3a\u7a7a"},KGGetTSURLInfo:{1:"\u65f6\u95f4\u6233\u672a\u542f\u7528"},KGValidate_GM:{"-1":"\u6ca1\u6709\u5b89\u88c5\u7b7e\u540d\u7ec4\u4ef6","-2":"\u6ca1\u6709\u516c\u5171\u6a21\u5757\u7ec4\u4ef6","-3":"KCL280 \u9a8c\u8bc1\u5931\u8d25\uff0c\u672a\u77e5\u539f\u56e0\u7684\u9a8c\u8bc1\u5931\u8d25",1:"KCL272_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5df2\u8fc7\u671f\u6216\u672a\u751f\u6548\uff01",
2:"KCL274 \u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u6839\u8bc1\u4e66\u9a8c\u8bc1\u672a\u901a\u8fc7!",3:" KCL270_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5df2\u88ab\u540a\u9500\uff01",4:" KCL276 \u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u6839\u8bc1\u4e66\u5b89\u88c5\u672a\u6210\u529f!",5:" KCL266_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u540a\u9500\u5217\u8868\uff01",
6:"KCL260_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u7b7e\u7ae0\u4eba\u8bc1\u4e66\uff01",7:"KCL262_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u6839\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u7b7e\u7ae0\u4eba\u6839\u8bc1\u4e66\uff01",8:"KCL264_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u6839\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u4e0e\u8be5\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\u4e0d\u5339\u914d\uff01",9:"KCL268_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u4e0e\u8be5\u8bc1\u4e66\u540a\u9500\u5217\u8868\u4e0d\u5339\u914d\uff01",
10:"KCL273_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u5df2\u8fc7\u671f\u6216\u672a\u751f\u6548",11:"KCL275 \u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u6839\u8bc1\u4e66\u9a8c\u8bc1\u672a\u901a\u8fc7!",12:"KCL271_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u5df2\u88ab\u540a\u9500\uff01",13:"KCL277_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u6839\u8bc1\u4e66\u5b89\u88c5\u672a\u6210\u529f!",
14:"KCL267_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u5236\u7ae0\u4eba\u8bc1\u4e66\u540a\u9500\u5217\u8868\uff01",15:"KCL281_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u5236\u7ae0\u4eba\u8bc1\u4e66\uff01",16:"KCL263_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u6839\u8bc1\u4e66\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u5236\u7ae0\u4eba\u6839\u8bc1\u4e66\uff01",17:"KCL265_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u6839\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u4e0e\u8be5\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\u4e0d\u5339\u914d\uff01",
18:"KCL269_\u9a8c\u8bc1\u5236\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u5236\u7ae0\u4eba\u8bc1\u4e66\u4e0e\u8be5\u8bc1\u4e66\u540a\u9500\u5217\u8868\u4e0d\u5339\u914d\uff01",19:"KCL261_\u9a8c\u8bc1\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5931\u8d25\uff0c\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u4e0d\u5728\u5370\u7ae0\u7684\u7b7e\u7ae0\u4eba\u8bc1\u4e66\u5217\u8868\u4e2d\uff01",20:"KCL278_\u9a8c\u8bc1\u5370\u7ae0\u5236\u7ae0\u65f6\u95f4\u5931\u8d25\uff0c\u5370\u7ae0\u672a\u751f\u6548\uff01",21:"KCL279 \u9a8c\u8bc1\u5370\u7ae0\u5236\u7ae0\u65f6\u95f4\u5931\u8d25\uff0c\u5370\u7ae0\u5df2\u7ecf\u8fc7\u671f\uff01"},
KGValidateCertificate:{"-1":"\u6ca1\u6709\u5b89\u88c5\u7b7e\u540d\u7ec4\u4ef6","-2":"\u672a\u77e5\u9519\u8bef",1:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u7b7e\u7ae0\u8bc1\u4e66\u5df2\u7ecf\u8fc7\u671f\u6216\u8fd8\u672a\u751f\u6548\uff01",2:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u7b7e\u7ae0\u8bc1\u4e66\u4e0d\u53d7\u9881\u53d1\u673a\u6784\u4fe1\u4efb\uff01",3:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u7b7e\u7ae0\u8bc1\u4e66\u5df2\u88ab\u540a\u9500\uff01",4:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u7b7e\u7ae0\u8bc1\u4e66\u6839\u8bc1\u4e66\u672a\u5b89\u88c5\u6216\u65e0\u6548\u7684\u6839\u8bc1\u4e66\uff01",
5:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u540a\u9500\u5217\u8868\u6587\u4ef6\u4e0d\u5b58\u5728\uff01",6:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u672a\u68c0\u6d4b\u5230\u8bc1\u4e66\uff01",7:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u6839\u8bc1\u4e66\u6587\u4ef6\u4e0d\u5b58\u5728\uff01",8:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u6839\u8bc1\u4e66\u548c\u8be5\u8bc1\u4e66\u7684\u6839\u8bc1\u4e66\u4e0d\u914d\u5957\uff01",9:"\u9a8c\u8bc1\u5931\u8d25\uff0c\u540a\u9500\u5217\u8868\u548c\u8be5\u8bc1\u4e66\u7684\u540a\u9500\u5217\u8868\u4e0d\u914d\u5957\uff01"},
KG_MSG:{in_pwd_msg:"\u8bf7\u8f93\u5165\u5bc6\u7801\uff01",timestamp_time:"(\u65f6\u95f4\u6765\u6e90\u4e8e\u65f6\u95f4\u6233\u670d\u52a1\u5668)",server_time:"(\u65f6\u95f4\u6765\u6e90\u4e8e\u7b7e\u7ae0\u670d\u52a1\u5668)",local_time:"(\u65f6\u95f4\u6765\u6e90\u4e8e\u672c\u5730)",modify_signdata:"\u7b7e\u540d\u6570\u636e\u88ab\u7be1\u6539",normal_signdata:"\u7b7e\u540d\u6570\u636e\u9a8c\u8bc1\u6b63\u5e38",success_signdata:"\u6570\u5b57\u7b7e\u540d\u6210\u529f\uff01",invalid_signdata:"\u7b7e\u7ae0\u65e0\u6548\uff0c\u4e0d\u80fd\u6267\u884c\u6570\u5b57\u7b7e\u540d\uff01",
cannot_move:"\u8fd9\u4e2a\u5370\u7ae0\u4e0d\u662f\u4f60\u5f53\u524d\u63d2\u5165\u7684key\u7684\u5370\u7ae0\uff0c\u4e0d\u80fd\u79fb\u52a8\uff01"},KG_TITLE:{SignatureMoveNot:"\u7981\u6b62\u79fb\u52a8",SignatureMoveDo:"\u5141\u8bb8\u79fb\u52a8",SignSignature:"\u6570\u5b57\u7b7e\u540d",SignVerify:"\u7b7e\u540d\u9a8c\u8bc1",SignatureVerify:"\u7b7e\u7ae0\u9a8c\u8bc1",RevokeSignature:"\u64a4\u9500\u7b7e\u7ae0",KinggridSignature:"\u7535\u5b50\u7b7e\u7ae0",DateSet:"\u65e5\u671f\u8bbe\u7f6e",HWSignature:"\u624b\u5199\u7b7e\u6279",
scanBCSignature:"\u626b\u7801\u7b7e\u7ae0",moveSignature:"\u79fb\u52a8\u7b7e\u7ae0",ProtectedDataSet:"\u4fdd\u62a4\u9879\u8bbe\u7f6e"},KGVerifyGBSealAction:{"-1":"\u670d\u52a1\u5668\u901a\u8baf\u5931\u8d25",1:"\u5370\u7ae0\u7ed3\u6784\u4f53\u4e3a\u7a7a",2:"\u5370\u7ae0\u72b6\u6001\u65e0\u6548",3:"\u89e3\u6790\u5f02\u5e38",4:"\u5370\u7ae0\u5df2\u5220\u9664",5:"\u5370\u7ae0\u672a\u5236\u4f5c",6:"\u5370\u7ae0\u5df2\u51bb\u7ed3"}});D.msg=function(a,b){return D.errCode[a]||(b?D.errCode[b][a]:D.errCode[a])||
a};D.options={_version:"1.0",timeout:2E4};D.Utils=r;D.Listener=G;var S=function(a,b){M.trigger("ajaxRequest",arguments);return D.ajax?function(c){(new W(a,b)).getJSON(function(a){c(null,a)})}:function(c){R(a,b,!1).getJSON(function(a){c(null,a)})}},n=function(a,b,c,d){M.trigger("beforeProg",arguments);var e={value:'{"GetInterface":{"progid":"'+b+'","interface":"'+c+'"},"usercode":"'+d+'"}'};return function(b){R(a+"/GetInterface",e,!1).getJSON(function(a){M.trigger("resonseProg",a);"none"==a.type?b(null,
L):"0"===a.value?b(null,K):b(null,a)})}},X=function(a,b,c,e){M.trigger("beforeMethod",arguments);var f=Array.prototype.slice.call(arguments).slice(4);0==f.length?f='{"MethodCall":{"caller":"'+b+'","function":"'+e+'"},"usercode":"'+c+'"}':(f='"params":'+d(f),f='{"MethodCall":{"caller":"'+b+'","function":"'+e+'",'+f+'},"usercode":"'+c+'"}');var n={value:f};return function(b){R(a+"/MethodCall",n,!1).getJSON(function(a){M.trigger("responseMethod",a);"none"!=a.type&&b(null,a.value?a.value:a)})}},Y=function(a,
b,c){M.trigger("beforeAttr",arguments);var e=Array.prototype.slice.call(arguments).slice(3);0==e.length?e='{"PropertyCall":{"caller":"'+b+'","property":"'+c+'"}}':(e='"params":'+d(e),e='{"MethodCall":{"caller":"'+b+'","property":"'+c+'",'+e+"}}");var f={value:e};return function(b){R(a,f,!0).getJSON(function(a){M.trigger("responseMethod",a);"none"!=a.type&&b(null,a.value)})}},W=function(a,b){this.url=a;this.data=b;M.trigger("beforeAjaxJ",a,b)};W.prototype.getJSON=function(a){var b=this;$.ajax({url:this.url,
contentType:"text/plain;charset=utf-8",type:"POST",data:F(this.data,"\r\n"),success:function(c){z.call(b,a,c)},error:function(c,d,e){z.call(b,a,C)}})};Thenjs.onerror=function(a){if(r.is("String",a))alert("[error]"+a);else throw a;};var V=function(a){this.serverUrl=a;this.thenjs=Thenjs(function(a){a(null)})};u=V.prototype;u.init=function(a,b,c){this.progid=a;this.interid=b;this.clientCode=c;return this};u.fail=function(a){var b=this;b.thenjs=b.thenjs.fail(function(c,d){var e=a.call(b,c,d);c(b.respData(void 0==
e?d:e))});return b};u.fin=function(a){var b=this;b.thenjs=b.thenjs.fin(function(c,d,e){a.call(b,c,d,e)});return b};u.then=function(a){var b=this;b.thenjs=b.thenjs.then(function(c,d){a.call(b,function(a,d){b.respData(d);c(a,d)},d)});return b};u.series=function(a){this.thenjs=this.thenjs.series(a);return this};u.calArgs=function(a){for(var b=this._data,c=[],d=0;d<a.length;d++){var e=a[d];r.is("Function",e)&&(e=e.call(this,b));r.is("Array",e)?c=c.concat(e):c.push(e)}return c};u.msg=function(a,b,c,d){b=
b||this._method;c=c||this.progid;d=D.errCode.then;M.trigger("msgArg",a,b,c);return D.errCode[a]||d[a+"@"+b+"."+c]||d[a+"@"+b]||d[a]||a};u.ret=function(a){var b=this;this.then(function(c,d){var e=a.call(b,d);c(null,b.respData(void 0==e?d:e))});return this};u.respData=function(a){a&&(this._data=a);return this._data};u.attr=function(a){var b=this,c=w(arguments);b.series([function(a){var d=b.calArgs(c);b._method=d[0];Y.apply(null,[b.serverUrl,b.proid].concat(d))(a)}]).then(function(a,c){a(null,b.respData(c[0]))});
return this};u.attrSeries=function(){var a=this,b=[];a.initProid();for(var c=0;c<arguments.length;c++)b.push(function(){var b=a.calArgs(arguments);return function(c){a._method=b[0];Y.apply(null,[a.serverUrl,a.proid].concat(b))(c)}}.apply(null,arguments[c]));a.series(b).then(function(b,c){a.respData(c);b(null,c)});return this};u.initProid=function(){var a=this;this.series([n(a.serverUrl,a.progid,a.interid,a.clientCode)]).then(function(b,c){c=c[0];M.trigger("initProid",c);c.value?(a.proid=c.value,b(null,
c)):b(c.errcode)});return this};u.invokeSeries=function(){var a=this,b=[];a.initProid();for(var c=0;c<arguments.length;c++)b.push(function(){var b=a.calArgs(arguments);return function(c){a._method=b[0];X.apply(null,[a.serverUrl,a.proid,a.clientCode].concat(b))(c)}}.apply(null,arguments[c]));a.series(b).then(function(b,c){a.respData(c);b(null,c)});return this};u.invoke=function(a){var b=this;b.initProid();var c=w(arguments);b.series([function(a){var d=b.calArgs(c);b._method=d[0];X.apply(null,[b.serverUrl,
b.proid,b.clientCode].concat(d))(a)}]).then(function(a,c){b.respData(c[0]);a(null,c[0])});return this};u.request=function(a,b){var c=this;c.series([S(c.serverUrl+a,b)]).then(function(a,b){b=b[0];c.respData(b);a(null,b)});return this};var M=new G("kgthen");D.addRequestListener=function(a,b){M.on(a,b)};D.surry=function(a,b,c,d){return(new V(a||"http://127.0.0.1:9581")).init(b,c,d)};D.KgThen=V;return D};function KGInstance(){null==instance&&(instance=new KG);return instance}root.kinggrid=KGInstance();
var Utils=kinggrid.Utils,config=kinggrid.options,isIE8=!1;root.JSON&&(isIE8='{"x":"\u4e2d"}'!==root.JSON.stringify({x:"\u4e2d"}));var dialog=root.dialog;
dialog&&dialog.create&&(dialog.create.prototype.button=function(a){a=a||[];var b=this,c="",d=0;this.callbacks={};"string"===typeof a?(c=a,d++):$.each(a,function(a,f){var e=f.id=f.id||f.value;"cancel"==e&&(f.value="\u53d6\u6d88");a="";b.callbacks[e]=f.callback;!1===f.display?a=' style="display:none"':d++;c+='<button type="button" i-id="'+e+'"'+a+(f.disabled?" disabled":"")+(f.autofocus?isIE8?' class="ui-dialog-autofocus"':' autofocus class="ui-dialog-autofocus"':"")+">"+f.value+"</button>";b._$("button").on("click",
"[i-id="+e+"]",function(a){$(this).attr("disabled")||b._trigger(e);a.preventDefault()})});this._$("button").html(c);this._$("footer")[d?"show":"hide"]();return this});var dialogConfig={okValue:"\u786e\u5b9a",cancelValue:"\u5173\u95ed",modal:!0,fixed:!0,backdropOpacity:.2,skin:"kg-ui-dialog"},toBase64Img=function(a){var b=a.imgdata;0==b.indexOf(a.signsn)&&(b=a.imgdata.substring(65));return Utils.Base64.of().encodeByte(Utils.Base64.of(a.signsn).decodeByte(b))},dialogList={},createDialog;
createDialog=function(a,b){b.id=a;return"undefined"!=typeof root.iframeDialog&&root.iframeDialog?root.top.dialog(b):root.dialog(b)};var kingDialog=function(a,b){var c=this;if(!(c instanceof kingDialog))return new kingDialog(a,b);var d=Utils.extend({},plus.dialogConfig,b),e=d.onOk;e&&(delete d.onOk,d.ok=function(){return e.call(c)});var f=d.onCancel;f&&(delete d.onCancel,d.cancel=function(){return f.call(c)});c.init(a,d);c.options=b;c.id=a},dialogProto=kingDialog.prototype;
dialogProto.init=function(a,b){this[0]=createDialog(a,b);return this};dialogProto.on=function(a,b){this[0]["on"+a]=b};dialogProto.show=function(a){this.options.iconClose&&this[0]._$("close").hide();this.options.onShow&&this.options.onShow.call(this);this[0].show();return this};dialogProto.remove=function(){this[0].remove();delete this[0]};dialogProto.close=function(){this[0].close();return this};dialogProto.content=function(a){this[0].content(a);return this};dialogProto.find=function(a){return this[0]._popup.find(a)};
Thenjs.onerror=function(a){plus.hideLoading();if(Utils.is("String",a))"client"==Signature.options.sealType&&Signature.options.isResponseErr&&"connectionErr"==a?console.warn(kinggrid.msg(a,"then")):Signature.options.errorCall?Signature.options.errorCall.call(null,{result:!1,errcode:a}):plus.alert(kinggrid.msg(a,"then"),function(){Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()});else throw a;
};var Switcher=function(a,b){var c=this;c.target=$(a);b&&$.each(b,function(a,b){if("function"===typeof c[a])c[a](b);else c[a]=b});c.init()};
Utils.extend(Switcher.prototype,{running:!1,index:0,animate:!0,init:function(){var a=this.target,b=this.wrapper=a.find(".kg-wrapper"),c=this.guide=a.find(".kg-guide");a=b.children(".kg-slide");var d=parseInt(a.css("height")),e=a.outerWidth(!0);b.css({height:d,width:a.length*e});this.count=a.length;b=parseFloat(this.index,10)||0;a.each(function(a){this.setAttribute("index",a);c.append('<span index="'+a+'"></span>')});this._active(b)},_active:function(a){var b=this.index;this.wrapper.children().eq(b).removeClass("active");
this.guide.children().eq(b).removeClass("active");this.wrapper.children().eq(a).addClass("active");this.guide.children().eq(a).addClass("active");this.index=a},to:function(a){var b=this;if(!b.running){var c=a%this.count;c!=b.index&&(b.running=!0,a=b.wrapper.children().eq(c),a=-c*a.outerWidth(!0),this.animate?this.wrapper.animate({left:a},100,function(){b._active(c);b.running=!1}):(this.wrapper.css({left:a}),b._active(c),b.running=!1))}},swipePrev:function(){var a=this.index-1;0>a&&(a=this.wrapper.children().length-
1);this.to(a)},swipeNext:function(){var a=this.index+1,b=this.wrapper.children().length;a+1>b&&(a=0);this.to(a)}});Utils.Switcher=Switcher;var Tab=function(a){this.target=a;var b=this.nav=this.target.find(".kg-nav");this.content=this.target.find(".kg-tab-content");a=b.children();b=b.children(".active");0==b.length&&(b=a.eq(0));this.active(b);this.init()};
Tab.prototype={active:function(a){this.activeLi&&(this.activeContent.removeClass("active"),this.activeLi.removeClass("active"));a.addClass("active");var b=a.children("a").attr("kg-target");b=this.target.find("."+b);b.addClass("active");this.activeLi=a;this.activeContent=b},init:function(){var a=this;this.target.find(".kg-nav li").click(function(b){b.preventDefault();b=$(this);b.hasClass("active")||a.active(b)})}};Utils.tab=function(a){return new Tab(a)};
var plus={dialogConfig:dialogConfig,alertConfig:{},loadingConfig:{}},showCacheDialog=function(a,b,c){var d=dialogList[a];if(!d){var e=c.okCall;e&&delete c.okCall;c=Utils.extend({onOk:function(){var a=!0;e&&(a=0==e.call(this)?!1:!0);a&&this.close().remove();return!1},cancel:!1},c);d=dialogList[a]=plus.showDialog(a,c)}d.on("remove",function(){delete dialogList[a]});d.content(b);return d};
plus.alert=function(a,b,c){b=Utils.extend({title:"\u63d0\u793a",onShow:c,okCall:b},plus.alertConfig);return showCacheDialog("alert",'<div class="kg-dialog kg-alert" ><i class="kg-icon kg-icon-attention-circled"></i>'+a+"</div>",b)};
plus.showLoading=function(a){a=Utils.extend({onOk:!1},plus.loadingConfig);return showCacheDialog("loading",'<div class="kg-loading"><img title="\u52a0\u8f7d\u4e2d..." src="data:image/gif;base64,R0lGODlhIAAgALMAAP///7Ozs/v7+9bW1uHh4fLy8rq6uoGBgTQ0NAEBARsbG8TExJeXl/39/VRUVAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBQAAACwAAAAAIAAgAAAE5xDISSlLrOrNp0pKNRCdFhxVolJLEJQUoSgOpSYT4RowNSsvyW1icA16k8MMMRkCBjskBTFDAZyuAEkqCfxIQ2hgQRFvAQEEIjNxVDW6XNE4YagRjuBCwe60smQUDnd4Rz1ZAQZnFAGDd0hihh12CEE9kjAEVlycXIg7BAsMB6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YEvpJivxNaGmLHT0VnOgGYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHQjYKhKP1oZmADdEAAAh+QQFBQAAACwAAAAAGAAXAAAEchDISasKNeuJFKoHs4mUYlJIkmjIV54Soypsa0wmLSnqoTEtBw52mG0AjhYpBxioEqRNy8V0qFzNw+GGwlJki4lBqx1IBgjMkRIghwjrzcDti2/Gh7D9qN774wQGAYOEfwCChIV/gYmDho+QkZKTR3p7EQAh+QQFBQAAACwBAAAAHQAOAAAEchDISWdANesNHHJZwE2DUSEo5SjKKB2HOKGYFLD1CB/DnEoIlkti2PlyuKGEATMBaAACSyGbEDYD4zN1YIEmh0SCQQgYehNmTNNaKsQJXmBuuEYPi9ECAU/UFnNzeUp9VBQEBoFOLmFxWHNoQw6RWEocEQAh+QQFBQAAACwHAAAAGQARAAAEaRDICdZZNOvNDsvfBhBDdpwZgohBgE3nQaki0AYEjEqOGmqDlkEnAzBUjhrA0CoBYhLVSkm4SaAAWkahCFAWTU0A4RxzFWJnzXFWJJWb9pTihRu5dvghl+/7NQmBggo/fYKHCX8AiAmEEQAh+QQFBQAAACwOAAAAEgAYAAAEZXCwAaq9ODAMDOUAI17McYDhWA3mCYpb1RooXBktmsbt944BU6zCQCBQiwPB4jAihiCK86irTB20qvWp7Xq/FYV4TNWNz4oqWoEIgL0HX/eQSLi69boCikTkE2VVDAp5d1p0CW4RACH5BAUFAAAALA4AAAASAB4AAASAkBgCqr3YBIMXvkEIMsxXhcFFpiZqBaTXisBClibgAnd+ijYGq2I4HAamwXBgNHJ8BEbzgPNNjz7LwpnFDLvgLGJMdnw/5DRCrHaE3xbKm6FQwOt1xDnpwCvcJgcJMgEIeCYOCQlrF4YmBIoJVV2CCXZvCooHbwGRcAiKcmFUJhEAIfkEBQUAAAAsDwABABEAHwAABHsQyAkGoRivELInnOFlBjeM1BCiFBdcbMUtKQdTN0CUJru5NJQrYMh5VIFTTKJcOj2HqJQRhEqvqGuU+uw6AwgEwxkOO55lxIihoDjKY8pBoThPxmpAYi+hKzoeewkTdHkZghMIdCOIhIuHfBMOjxiNLR4KCW1ODAlxSxEAIfkEBQUAAAAsCAAOABgAEgAABGwQyEkrCDgbYvvMoOF5ILaNaIoGKroch9hacD3MFMHUBzMHiBtgwJMBFolDB4GoGGBCACKRcAAUWAmzOWJQExysQsJgWj0KqvKalTiYPhp1LBFTtp10Is6mT5gdVFx1bRN8FTsVCAqDOB9+KhEAIfkEBQUAAAAsAgASAB0ADgAABHgQyEmrBePS4bQdQZBdR5IcHmWEgUFQgWKaKbWwwSIhc4LonsXhBSCsQoOSScGQDJiWwOHQnAxWBIYJNXEoFCiEWDI9jCzESey7GwMM5doEwW4jJoypQQ743u1WcTV0CgFzbhJ5XClfHYd/EwZnHoYVDgiOfHKQNREAIfkEBQUAAAAsAAAPABkAEQAABGeQqUQruDjrW3vaYCZ5X2ie6EkcKaooTAsi7ytnTq046BBsNcTvItz4AotMwKZBIC6H6CVAJaCcT0CUBTgaTg5nTCu9GKiDEMPJg5YBBOpwlnVzLwtqyKnZagZWahoMB2M3GgsHSRsRACH5BAUFAAAALAEACAARABgAAARcMKR0gL34npkUyyCAcAmyhBijkGi2UW02VHFt33iu7yiDIDaD4/erEYGDlu/nuBAOJ9Dvc2EcDgFAYIuaXS3bbOh6MIC5IAP5Eh5fk2exC4tpgwZyiyFgvhEMBBEAIfkEBQUAAAAsAAACAA4AHQAABHMQyAnYoViSlFDGXBJ808Ep5KRwV8qEg+pRCOeoioKMwJK0Ekcu54h9AoghKgXIMZgAApQZcCCu2Ax2O6NUud2pmJcyHA4L0uDM/ljYDCnGfGakJQE5YH0wUBYBAUYfBIFkHwaBgxkDgX5lgXpHAXcpBIsRADs="></div>',a)};
plus.hideLoading=function(){var a=dialogList.loading;a&&a.close().remove()};plus.hideDialog=function(a){(a=root.dialog.list[a])&&a.close().remove()};plus.showDialog=function(a,b){a=kingDialog(a,b);a.show();return a};
var template=plus.template={sealTpl_nopassword:'<div class="kg-dialog kg-dialog-runSignature" id="sealTpl-dialog"><div class=" kg-switcher" id="kg-switcher" ><a class="arrow-left arrow" href="#"><i class="kg-icon kg-icon-angle-left" /></a><a class="arrow-right arrow" href="#"><i class="kg-icon kg-icon-angle-right"/></a><div class="kg-pagin"><d\tiv class="kg-guide"></div>\t</div><div class="kg-container" ><div class="kg-wrapper"><% var seals = this.seals; %><% for(var i=0;i<seals.length;i++) {%><div class="kg-slide" title="<%seals[i].signname%>"><div class="kg-image"><div class="title"><%seals[i].signname%></div><a class="kg-img" href="#" ><img src="data:image/<%seals[i].imgext.substring(1)%>;base64,<%arguments[arguments.length-1](seals[i])%>"></a></div><div class="kg-shade" style="z-index:100;"><img width="100%" height="100%"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII="></div></div><%}%></div></div></div><div class="kg-form"><div class="kg-sm kg-sm-2"></div><div class="form-item clearfix i-addDate"><div class="kg-sm kg-sm-8"><% if(this.signDateIsCheck){ %><input type="checkbox" name="addDate" id="kg-addDate" checked="checked">&nbsp;<label for="kg-addDate">\u9644\u52a0\u65f6\u95f4</label>&nbsp;&nbsp;&nbsp;&nbsp;<%}else{%><input type="checkbox" name="addDate" id="kg-addDate">&nbsp;<label for="kg-addDate">\u9644\u52a0\u65f6\u95f4</label>&nbsp;&nbsp;&nbsp;&nbsp;<%}%><input type="button" style="width:50px" name="dateSet" id="kg-dateSet" value="\u8bbe\u7f6e"/><% if(this.showProtectedBtn){%>&nbsp;<input type="button" style="width:50px" name="proDataSet" id="kg-protectedDataSet" value="\u4fdd\u62a4\u9879"/><%}%></div> </div> </div></div></div>',sealTpl:'<div class="kg-dialog kg-dialog-runSignature" id="sealTpl-dialog"><div class=" kg-switcher" id="kg-switcher" ><a class="arrow-left arrow" href="#"><i class="kg-icon kg-icon-angle-left" /></a><a class="arrow-right arrow" href="#"><i class="kg-icon kg-icon-angle-right"/></a><div class="kg-pagin"><d\tiv class="kg-guide"></div>\t</div><div class="kg-container" ><div class="kg-wrapper"><% var seals = this.seals; %><% for(var i=0;i<seals.length;i++) {%><div class="kg-slide" title="<%seals[i].signname%>"><div class="kg-image"><div class="title"><%seals[i].signname%></div><a class="kg-img" href="#" ><img src="data:image/<%seals[i].imgext.substring(1)%>;base64,<%arguments[arguments.length-1](seals[i])%>"></a></div><div class="kg-shade" style="z-index:100;"><img width="100%" height="100%"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII="></div></div><%}%></div></div></div><div class="kg-form"><div class="form-item clearfix i-password"><div class="kg-sm kg-sm-2"></div><label class="kg-sm kg-sm-2 kg-label">\u5bc6\u7801\uff1a</label><div class="kg-sm kg-sm-6"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div><div class="kg-sm kg-sm-2"></div> </div><div class="kg-sm kg-sm-2"></div><div class="form-item clearfix i-addDate"><div class="kg-sm kg-sm-8"><% if(this.signDateIsCheck){ %><input type="checkbox" name="addDate" id="kg-addDate" checked="checked">&nbsp;<label style="display:inline;" for="kg-addDate">\u9644\u52a0\u65f6\u95f4</label>&nbsp;<%}else{%><input type="checkbox" name="addDate" id="kg-addDate">&nbsp;<label style="display:inline;" for="kg-addDate">\u9644\u52a0\u65f6\u95f4</label>&nbsp;<%}%><input type="button" style="width:40px;" name="dateSet" id="kg-dateSet" value="\u8bbe\u7f6e"/></div> </div> </div><div class="kg-sm kg-sm-2"></div><div class="form-item clearfix i-password kg-pwd"><div class="kg-sm kg-sm-9"><input type="checkbox" name="remenberPwd" id="kg-remenberPwd">&nbsp;<label style="display:inline;" for="kg-remenberPwd">\u8bb0\u4f4f\u5bc6\u7801</label><% if(this.showProtectedBtn){%>&nbsp;<input type="button" style="width:50px" name="proDataSet" id="kg-protectedDataSet" value="\u4fdd\u62a4\u9879"/><%}%></div> </div> </div></div></div>',
passwordTpl:'<div id="kg-verifyPass" class="kg-dialog kg-dialog-password"><div class="kg-form"><div class="form-item clearfix i-password"><label class="kg-sm kg-sm-3 kg-label">\u5bc6\u7801\uff1a</label><div class="kg-sm kg-sm-8"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div> </div><div class="kg-sm kg-sm-3"></div><div class="kg-sm kg-sm-8"><input type="checkbox" name="remenberPwd" id="kg-remenberPwd">&nbsp;<label for="kg-remenberPwd">\u8bb0\u4f4f\u5bc6\u7801</label></div> </div></div></div>'},
font=plus.fontTemplate={fontFormat:"yyyy-M-d;yyyy.M.d;yyyy/M/d;yyyy\u5e74M\u6708d\u65e5;yy/M/d;yy.M.d;yyyy-MM-dd;yyyy/MM/dd;yyyy.MM.dd;yyyy\u5e74M\u6708d\u65e5*;yyyy\u5e74M\u6708d\u65e5**;MM/dd;MM.dd;M/d;M.d;d-MMM-yyyy;d-MMM-yy;yyyy-M-d hh:mm:ss".split(";"),fontFamily:"@Arial Unicode MS;@Fixedsys;@Malgun Gothic;@Malgun Gothic Semilight;@Meiryo;@Meiryo UI;@Microsoft JhengHei;@Microsoft JhengHei Light;@Microsoft JhengHei UI;@Microsoft JhengHei UI Light;@Microsoft YaHei UI;@Microsoft YaHei UI Light;@MingLiU_HKSCS-ExtB;@MingLiU-ExtB;@MS Gothic;@MS PGothic;@MS UI Gothic;@PMingLiU-ExtB;@SimSun-ExtB;@System;@Terminal;@Yu Gothic;@Yu Gothic Light;@Yu Gothic Medium;@Yu Gothic UI;@Yu Gothic UI Light;@Yu Gothic UI Semibold;@Yu Gothic UI Semilight;@\u7b49\u7ebf;@\u7b49\u7ebf Light;@\u65b9\u6b63\u5170\u4ead\u8d85\u7ec6\u9ed1\u7b80\u4f53;@\u65b9\u6b63\u8212\u4f53;@\u65b9\u6b63\u59da\u4f53;@\u4eff\u5b8b;@\u9ed1\u4f53;@\u534e\u6587\u5f69\u4e91;@\u534e\u6587\u4eff\u5b8b;@\u534e\u6587\u884c\u6977;@\u534e\u6587\u7425\u73c0;@\u534e\u6587\u6977\u4f53;@\u534e\u6587\u96b6\u4e66;@\u534e\u6587\u5b8b\u4f53;@\u534e\u6587\u7ec6\u9ed1;@\u534e\u6587\u65b0\u9b4f;@\u534e\u6587\u4e2d\u5b8b;@\u6977\u4f53;@\u96b6\u4e66;@\u5b8b\u4f53;@\u5fae\u8f6f\u96c5\u9ed1;@\u5fae\u8f6f\u96c5\u9ed1 Light;@\u65b0\u5b8b\u4f53;@\u5e7c\u5706;ADMUI3Lg;ADMUI3Sm;Agency FB;Algerian;Arial;Arial Black;Arial Narrow;Arial Rounded MT Bold;Arial Unicode MS;Axure Handwriting;Baskerville Old Face;Bauhaus 93;Bell MT;Berlin Sans FB;Berlin Sans FB Demi;Bernard MT Condensed;Blackadder ITC;Bodoni MT;Bodoni MT Black;Bodoni MT Condensed;Bodoni MT Poster Compressed;Book Antiqua;Bookman Old Style;Bookshelf Symbol 7;Bradley Hand ITC;Britannic Bold;Broadway;Brush Script MT;Calibri;Calibri Light;Californian FB;Calisto MT;Cambria;Cambria Math;Candara;Castellar;Centaur;Century;Century Gothic;Century Schoolbook;Chiller;Colonna MT;Comic Sans MS;Consolas;Constantia;Cooper Black;Copperplate Gothic Bold;Copperplate Gothic Light;Corbel;Courier;Courier New;Curlz MT;Default;Ebrima;Edwardian Script ITC;Elephant;Engravers MT;Eras Bold ITC;Eras Demi ITC;Eras Light ITC;Eras Medium ITC;Euro Sign;Felix Titling;Fixedsys;Footlight MT Light;Forte;Franklin Gothic Book;Franklin Gothic Demi;Franklin Gothic Demi Cond;Franklin Gothic Heavy;Franklin Gothic Medium;Franklin Gothic Medium Cond;Freestyle Script;French Script MT;Gabriola;Gadugi;Garamond;Georgia;Gigi;Gill Sans MT;Gill Sans MT Condensed;Gill Sans MT Ext Condensed Bold;Gill Sans Ultra Bold;Gill Sans Ultra Bold Condensed;Gloucester MT Extra Condensed;Goudy Old Style;Goudy Stout;Haettenschweiler;Harlow Solid Italic;Harrington;High Tower Text;Impact;Imprint MT Shadow;Informal Roman;Javanese Text;Jokerman;Juice ITC;Kristen ITC;Kunstler Script;Leelawadee UI;Leelawadee UI Semilight;Lucida Bright;Lucida Calligraphy;Lucida Console;Lucida Fax;Lucida Handwriting;Lucida Sans;Lucida Sans Typewriter;Lucida Sans Unicode;Magneto;Maiandra GD;Malgun Gothic;Malgun Gothic Semilight;Marlett;Matura MT Script Capitals;Meiryo;Meiryo UI;Microsoft Himalaya;Microsoft JhengHei;Microsoft JhengHei Light;Microsoft JhengHei UI;Microsoft JhengHei UI Light;Microsoft New Tai Lue;Microsoft PhagsPa;Microsoft Sans Serif;Microsoft Tai Le;Microsoft YaHei UI;Microsoft YaHei UI Light;Microsoft Yi Baiti;MingLiU_HKSCS-ExtB;MingLiU-ExtB;Mistral;Modern;Modern No. 20;Mongolian Baiti;Monotype Corsiva;MS Gothic;MS Outlook;MS PGothic;MS Reference Sans Serif;MS Reference Specialty;MS Sans Serif;MS Serif;MS UI Gothic;MT Extra;MV Boli;Myanmar Text;Niagara Engraved;Niagara Solid;Nirmala UI;Nirmala UI Semilight;OCR A Extended;Old English Text MT;Onyx;Palace Script MT;Palatino Linotype;Papyrus;Parchment;Perpetua;Perpetua Titling MT;Playbill;PMingLiU-ExtB;Poor Richard;Pristina;Rage Italic;Ravie;Rockwell;Rockwell Condensed;Rockwell Extra Bold;Roman;Script;Script MT Bold;Segoe MDL2 Assets;Segoe Print;Segoe Script;Segoe UI;Segoe UI Black;Segoe UI Emoji;Segoe UI Historic;Segoe UI Light;Segoe UI Semibold;Segoe UI Semilight;Segoe UI Symbol;Showcard Gothic;SimSun-ExtB;Sitka Banner;Sitka Display;Sitka Heading;Sitka Small;Sitka Subheading;Sitka Text;Small Fonts;Snap ITC;Stencil;Sylfaen;Symbol;System;Tahoma;TeamViewer11;Tempus Sans ITC;Terminal;Times New Roman;Trebuchet MS;Tw Cen MT;Tw Cen MT Condensed;Tw Cen MT Condensed Extra Bold;Verdana;Viner Hand ITC;Vivaldi;Vladimir Script;Webdings;Wide Latin;Wingdings;Wingdings 2;Wingdings 3;Yu Gothic;Yu Gothic Light;Yu Gothic Medium;Yu Gothic UI;Yu Gothic UI Light;Yu Gothic UI Semibold;Yu Gothic UI Semilight;ZWAdobeF;\u7b49\u7ebf;\u7b49\u7ebf Light;\u65b9\u6b63\u5170\u4ead\u8d85\u7ec6\u9ed1\u7b80\u4f53;\u65b9\u6b63\u8212\u4f53;\u65b9\u6b63\u59da\u4f53;\u4eff\u5b8b;\u9ed1\u4f53;\u534e\u6587\u5f69\u4e91;\u534e\u6587\u4eff\u5b8b;\u534e\u6587\u884c\u6977;\u534e\u6587\u7425\u73c0;\u534e\u6587\u6977\u4f53;\u534e\u6587\u96b6\u4e66;\u534e\u6587\u5b8b\u4f53;\u534e\u6587\u7ec6\u9ed1;\u534e\u6587\u65b0\u9b4f;\u534e\u6587\u4e2d\u5b8b;\u6977\u4f53;\u96b6\u4e66;\u5b8b\u4f53;\u5fae\u8f6f\u96c5\u9ed1;\u5fae\u8f6f\u96c5\u9ed1 Light;\u65b0\u5b8b\u4f53;\u5e7c\u5706".split(";"),
fontSize:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72],fontColor:"#000000 #800000 #008000 #808000 #000080 #800080 #008080 #808080 #C0C0C0 #FFFFFF #FF0000 #00FF00 #FFFF00 #0000FF #FF00FF #00FFFF".split(" "),fontPosition:[["center","middle","inside","",""],["center","bottom","inside","",""],["right","middle","inside","",""],["right","bottom","inside","",""],["right","top","outside","left",""],["center","top","outside","","below"],["left","middle","outside","right",""],["right","top","outside","",
"below"],["left","bottom","outside","right",""],["left","top","outside","right","below"]],position:"\u5c45\u4e2d \u5c45\u4e2d\u4e0b(\u7ae0\u5185) \u5c45\u53f3\u4e2d(\u7ae0\u5185) \u5c45\u53f3\u4e0b(\u7ae0\u5185) \u5c45\u5de6\u4e0a(\u7ae0\u5916) \u5c45\u4e2d\u4e0b(\u7ae0\u5916) \u5c45\u53f3\u4e2d(\u7ae0\u5916) \u5c45\u53f3\u4e0b(\u7ae0\u4e0b) \u5c45\u53f3\u4e0b(\u7ae0\u53f3) \u5c45\u53f3\u4e0b(\u7ae0\u53f3\u4e0b)".split(" ")},fontFamily=plus.fontFamily=[{ename:"sans-serif",zname:"sans-serif"},{ename:"SimSun",
zname:"\u5b8b\u4f53"},{ename:"SimHei",zname:"\u9ed1\u4f53"},{ename:"Microsoft Yahei",zname:"\u5fae\u8f6f\u96c5\u9ed1"},{ename:"Microsoft JhengHei",zname:"\u5fae\u8f6f\u6b63\u9ed1\u4f53"},{ename:"KaiTi",zname:"\u6977\u4f53"},{ename:"NSimSun",zname:"\u65b0\u5b8b\u4f53"},{ename:"FangSong",zname:"\u4eff\u5b8b"},{ename:"PingFang SC",zname:"\u82f9\u65b9"}],dafaultDate=plus.dafaultDate="2017/01/01 12:00:00",defaultFont=plus.defaultFont={fontFormat:plus.fontTemplate.fontFormat[0],fontFamily:"\u5b8b\u4f53",
fontSize:12,fontColor:"#000000",position:plus.fontTemplate.position[0]};
plus.kgFont=function(a){var b={};b.fontFormat=a.fontFormat?a.fontFormat:plus.defaultFont.fontFormat;b.fontFamily=a.fontFamily?a.fontFamily:plus.defaultFont.fontFamily;b.fontSize=a.fontSize?a.fontSize:plus.defaultFont.fontSize;b.fontColor=a.fontColor?a.fontColor:plus.defaultFont.fontColor;null!=a.position?(a=jQuery.inArray(a.position,plus.fontTemplate.position),b.fontPosition=plus.fontTemplate.fontPosition[a]):a.fontPositionIndex?b.fontPosition=plus.fontTemplate.fontPosition[a.fontPositionIndex]:(a=
jQuery.inArray(plus.defaultFont.position,plus.fontTemplate.position),b.fontPosition=plus.fontTemplate.fontPosition[a]);return b};var formatArgs=function(a){var b=[a],c=Utils.slice(arguments,1),d;if(0<c.length){var e=c[0];1<c.length&&(d=c.slice(1))}b.push(e);return b.concat(d)};plus.showTplDialog=function(a,b,c){var d=Utils.slice(arguments,2),e=Utils.extend({content:function(){return Utils.template.apply(null,[template[a]].concat(d))}},b);return plus.showDialog(a,e)};
plus.showTemplateDialog=function(a){var b=formatArgs.apply(null,Utils.slice(arguments));return plus.showTplDialog.apply(plus,b)};plus.create=function(a){Utils.extend(this,plus);this.king=a};var noop=function(){plus.hideLoading();return!0};proto=plus.create.prototype;var kingPlus=function(a){return 0==arguments.length?plus:new plus.create(a)};kingPlus.changeSkin=function(a){Utils.extend(kingDialog.prototype,a)};root.kingPlus=kingPlus;
var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;b&&c.mixIn(b);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},
clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||k).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);this.sigBytes+=a;return this},clamp:function(){var b=
this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8;b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);a.words=this.words.slice(0);return a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},k=g.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,
c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},h=g.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(a.charCodeAt(d)&255)<<24-d%4*8;return new f.init(c,b)}},m=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(h.stringify(a)))}catch(w){throw Error("Malformed UTF-8 data");
}},parse:function(a){return h.parse(unescape(encodeURIComponent(a)))}},q=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=m.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,k=e/(4*g);k=b?a.ceil(k):a.max((k|0)-this._minBufferSize,0);b=k*g;e=a.min(4*b,e);if(b){for(var m=0;m<b;m+=g)this._doProcessBlock(d,m);m=d.splice(0,b);c.sigBytes-=
e}return new f.init(m,e)},clone:function(){var a=e.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});d.Hasher=q.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){q.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return(new a.init(c)).finalize(b)}},_createHmacHelper:function(a){return function(b,
c){return(new y.HMAC.init(a,c)).finalize(b)}}});var y=c.algo={};return c}(Math);
(function(){var a=CryptoJS,b=a.lib,c=b.WordArray,d=b.Hasher,e=[];b=a.algo.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],f=c[1],g=c[2],y=c[3],t=c[4],w=0;80>w;w++){if(16>w)e[w]=a[b+w]|0;else{var J=e[w-3]^e[w-8]^e[w-14]^e[w-16];e[w]=J<<1|J>>>31}J=(d<<5|d>>>27)+t+e[w];J=20>w?J+((f&g|~f&y)+1518500249):40>w?J+((f^g^y)+1859775393):60>w?J+((f&g|f&y|g&y)-1894007588):J+((f^g^
y)-899497514);t=y;y=g;g=f<<30|f>>>2;f=d;d=J}c[0]=c[0]+d|0;c[1]=c[1]+f|0;c[2]=c[2]+g|0;c[3]=c[3]+y|0;c[4]=c[4]+t|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;b[d>>>5]|=128<<24-d%32;b[(d+64>>>9<<4)+14]=Math.floor(c/4294967296);b[(d+64>>>9<<4)+15]=c;a.sigBytes=4*b.length;this._process();return this._hash},clone:function(){var a=d.clone.call(this);a._hash=this._hash.clone();return a}});a.SHA1=d._createHelper(b);a.HmacSHA1=d._createHmacHelper(b)})(this);
var $=window.jQuery;kingPlus=window.kingPlus;isIE8=!1;root.JSON&&(isIE8='{"x":"\u4e2d"}'!==root.JSON.stringify({x:"\u4e2d"}));var canCanvas=!0;try{root.document.createElement("canvas").getContext("2d")}catch(a){canCanvas=!1}function stringify(a){a=JSON.stringify(a);return isIE8?a.replace(/\\u([0-9a-fA-F]{2,4})/g,function(a,c){return String.fromCharCode(parseInt(c,16))}):a}var now=function(){return(new Date).getTime()};function rnd(a){return(9301*a+49297)%233280/233280}
function rand(){var a=""+Math.ceil(99999*rnd((new Date).getTime())),b=5-a.length;if(0<b)for(var c=0;c<b;c++)a="0"+a;return a}Utils=kinggrid.Utils;
var $window=$(window),$document=$(document),html=document.documentElement,isIE6=!("minWidth"in html.style),isLosecapture=!isIE6&&"onlosecapture"in html,isSetCapture="setCapture"in html,isTouch,EventTypes,getEvent=function(a){isTouch&&(a=a.originalEvent?a.originalEvent.touches.item(0):a.touches.item(0));return a},Drag=function(a){this.start=$.proxy(this.start,this);this.over=$.proxy(this.over,this);this.end=$.proxy(this.end,this);this.onstart=this.onover=this.onend=$.noop;EventTypes||(isTouch="mousedown"!=
a.type,EventTypes={start:isTouch?"touchstart":"mousedown",over:isTouch?"touchmove":"mousemove",end:isTouch?"touchend":"mouseup"})};
Drag.prototype={start:function(a){a=this.startFix(a);globalLisenter.trigger("dragStart",this,a);$document.on(EventTypes.over,this.over).on(EventTypes.end,this.end);this.onstart(a);return!1},over:function(a){a=this.overFix(a);globalLisenter.trigger("dragOver",this,a);this.onover(a);return!1},end:function(a){a=this.endFix(a);globalLisenter.trigger("dragEnd",this,a);$document.off(EventTypes.over,this.over).off(EventTypes.end,this.end);this.onend(a);return!1},startFix:function(a){a=getEvent(a);this.target=
$(a.target);this.selectstart=function(){return!1};$document.on("selectstart",this.selectstart).on("dblclick",this.end);if(isLosecapture)this.target.on("losecapture",this.end);else $window.on("blur",this.end);isSetCapture&&this.target[0].setCapture();return a},overFix:function(a){return a=getEvent(a)},endFix:function(a){a=getEvent(a);$document.off("selectstart",this.selectstart).off("dblclick",this.end);isLosecapture?this.target.off("losecapture",this.end):$window.off("blur",this.end);isSetCapture&&
this.target[0].releaseCapture();return a}};
Drag.create=function(a,b,c,d){var e=$(a),f=new Drag(b),g=EventTypes.start,k=function(){},h=a.className.replace(/^\s|\s.*/g,"")+"-drag-start",m=e[0].style,q,y,t,w,J=$document.scrollLeft(),r=$document.scrollTop(),G=0==d.left?0:d.left+e.width()-J,O=d.right-J,F=d.top-r,K=0==d.bottom?0:d.bottom-e.height()-r,L=0,C=0,v=parseInt(m.left),B=parseInt(m.top),z=v,H=B,u=v,x=B;c&&(z=parseInt(m.marginLeft),H=parseInt(m.marginTop),u=z,x=H);var l={onstart:k,onover:k,onend:k,off:function(){e.off(g,f.start)}},P={scale:function(){var a=
1,b=e.parents(".kg-translate");null!=b&&(b=b.css("transform"),null!=b&&(b=b.split("(")[1].split(")")[0].split(","),a=b[0],b=b[3],a=Math.max(Math.sqrt(a*a),Math.sqrt(b*b))));return a}};f.onstart=function(b){var c="fixed"===e.css("position"),d=$document.scrollLeft(),f=$document.scrollTop(),n=e.width(),g=e.height();n*=P.scale();g*=P.scale();y=q=0;t=c?$window.width()-n+q:$document.width()-n;w=c?$window.height()-g+y:$document.height()-g;g=e.offset();n=this.startLeft=c?g.left-d:g.left;c=this.startTop=c?
g.top-f:g.top;this.clientX=b.clientX;this.clientY=b.clientY;g=e.parent();g.is("body")||(L=g[0].getBoundingClientRect().left+d,C=g[0].getBoundingClientRect().top+f);d=b.clientX-e.offset().left+d-e.width();f=b.clientY-e.offset().top+f;0!=G?G+=d:G;0!=O?O+=d:O;0!=F?F+=f:F;0!=K?K+=f:K;e.addClass(h);l.onstart.call(a,b,n,c)};f.onover=function(b){var d=b.clientX,f=b.clientY;0!=G&&b.clientX<=G&&(d=G);0!=O&&b.clientX>=O&&(d=O);0!=F&&b.clientY<=F&&(f=F);0!=K&&b.clientY>=K&&(f=K);d=d-this.clientX+this.startLeft;
f=f-this.clientY+this.startTop;var g=e[0].style;d=Math.max(q,Math.min(t,d));f=Math.max(y,Math.min(w,f));c?(d=g.marginLeft=(d-L-v)/P.scale()+"px",f=g.marginTop=(f-C-B)/P.scale()+"px"):(d=g.left=(d-L)/P.scale()+"px",f=g.top=(f-C)/P.scale()+"px");u=parseInt(d);x=parseInt(f);l.onover.call(a,b,d,f)};f.onend=function(b){var d=e.position(),f=d.left;d=d.top;e.removeClass(h);var g=e[0].style,n=!0;6>Math.abs(u-z)&&6>Math.abs(x-H)&&(n=!1);c?l.onend.call(a,b,n,g.marginLeft,g.marginTop):l.onend.call(a,b,n,f,d)};
f.off=function(){e.off(g,f.start)};if(b)f.start(b);else e.on(g,f.start);return l};var Listener=kinggrid.Listener,Service=function(){};$.extend(Service.prototype,Listener.prototype);var SealService=function(){};SealService.className=SealService.name||"SealService";Utils.inherit(SealService,Service);$.extend(SealService.prototype,{loadSeal:function(){throw Error("must impl");},saveLog:function(){},verifyPwd:function(){throw Error("must impl");}});var CertService=function(){};
CertService.className=CertService.name||"CertService";Utils.inherit(CertService,Service);$.extend(CertService.prototype,{sign:function(){throw Error("must impl");},verifySign:function(){throw Error("must impl");}});var KgObject=function(){};$.extend(KgObject.prototype,{getAttr:function(a){return this[a]},setAttr:function(a){var b=this;$.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})},removeAttr:function(a){delete this[a]}});
var Signature=function(a,b){var c=this;c.signatureid=a;c.setSignatureData(b);c.on("load",function(){Signature.list[a]=this});c.on("remove",function(a){a=c._getLogInfo(Utils.extend(a||{},{LOGTYPE:"00",LOGSORT:"14",LOGMEMO:"\u64a4\u9500\u7b7e\u7ae0\u6210\u529f"}));c.sealService.saveLog(a);delete Signature.list[c.signatureid]});c.on("update",function(a){"signMeta"===c._item&&(a=c._getLogInfo(Utils.extend(a||{},{LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"\u6570\u5b57\u7b7e\u540d\u6210\u529f"})),c.sealService.saveLog(a))});
c.on("fireremove",function(){Signature.removeList.push(c.signatureid)});c.on("fireupdate",function(){for(var a=!1,b=0;b<Signature.updateList.length;b++)if(Signature.updateList[b]===c){a=!0;break}a||Signature.updateList.push(c)});for(var d in Signature)Signature.hasOwnProperty(d)&&0==d.indexOf("on")&&(this[d]=Signature[d]);return this},blankImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII=",blackImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVR42mNoaGgAAAMEAYF1LgG8AAAAAElFTkSuQmCC",
createImg=function(a,b,c){if(canCanvas){var d=root.document.createElement("canvas");d.height=c;d.width=b;var e=d.getContext("2d"),f=new Image;f.src=a;f.onload=function(){e.drawImage(f,0,0,b,c)}}else d=root.document.createElement("img"),d.style.width=b+"px",d.style.height=c+"px",d.setAttribute("src",a);return d};Utils.inherit(Signature,KgObject);$.extend(Signature.prototype,Listener.prototype);
$.extend(Signature.prototype,{hashAlg:"sha1",encryptAlg:"RSA",_init:function(){},_getLogInfo:function(a){var b=decodeURIComponent(window.location.href),c=this.signatureData;return Utils.extend(a||{},{KEYSN:c.gbOvalue&&""!=c.gbOvalue?c.gbOvalue:c.keysn,SIGNSN:c.seal.signsn,DOCUMENTID:c.documentid,DOCUMENTNAME:c.documentname,APPVERSION:version.name,APPTYPE:"HTML",APPCODE:this.appcode,EXTPARAM2:b})},error:function(a,b,c,d){c=a;Utils.is("Object",a)&&(c=a.errcode&&"511"!=a.errcode?a.errcode:a.errmsg);
c||(c="-999");b=Utils.is("String",b)?b:"then";plus.hideLoading();Signature.options.errorCall?Signature.options.errorCall.call(null,a,b):plus.alert(kinggrid.msg(c,b),function(){d&&d._beginDlgOkCall&&1==d._beginDlgOkCall||Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()})},load:function(a){this.trigger("beforeLoad");this.setAttr(a);this.certService=new Signature.factory.cert[Signature.options.certType](a,
this.signatureData);var b=this.signatureData;if(void 0!==a.extra&&null!==a.extra&&void 0!==a.extra[this.signatureid]){if(void 0!==a.extra[this.signatureid].scaleImage&&null!==a.extra[this.signatureid].scaleImage&&(b.seal.height*=a.extra[this.signatureid].scaleImage,b.seal.width*=a.extra[this.signatureid].scaleImage),void 0!=a.extra[this.signatureid].position){var c=$.extend({},b.position),d="",e;for(e in c)d=e;this.removeItem(b.position);this.updatePos(a.extra[this.signatureid].position,{marginLeft:null==
a.extra[this.signatureid].offsetX?c[d].marginLeft:a.extra[this.signatureid].offsetX,marginTop:null==a.extra[this.signatureid].offsetY?c[d].marginTop:a.extra[this.signatureid].offsetY})}}else void 0!==a.scaleImage&&null!==a.scaleImage&&(b.seal.height*=a.scaleImage,b.seal.width*=a.scaleImage);this.sealService=new Signature.factory.seal[Signature.options.sealType](a,b);this._init();this.trigger("load");return this},toBase64Img:function(a){var b=a.imgdata,c=b.indexOf(a.signsn);if(-1==c)return b;b=a.imgdata.substring(c+
65);return Utils.Base64.of().encodeByte(Utils.Base64.of(a.signsn).decodeByte(b))},clearImg:function(){if(this.imgEles)for(var a in this.imgEles)this.trigger("removeAt",this.imgEles[a][0]),this.imgEles[a].remove();this.imgEles={}},repaint:function(){this.clearImg();this.verify()},getUpdateType:function(){return this._item},updatePos:function(a,b){var c=this.signatureData.position[a];this._item="position";this.signatureData.position[a]=Utils.extend({},c,b)},updateItem:function(a,b){this._item=a;this.signatureData[a]=
b},removeItem:function(a){for(var b in a)delete a[b]},fireUpdate:function(a){var b=this,c=function(c){a&&a(c);b[c?"update":"restore"]();delete b._item};Signature.asyn.update?Signature.asyn.update.call(b,c):(this.trigger("fireupdate"),c(!0));return this},restore:function(){this.setSignatureData(this.oriSignatureData);this.repaint()},update:function(){this.setSignatureData(this.signatureData);this.repaint();this.trigger("update");return this},remove:function(){this.clearImg();this.trigger("remove");
for(var a in this)delete this[a];return this},fireRemove:function(a){var b=this,c=function(c){a&&a(c);c&&b.remove()};Signature.asyn.remove?Signature.asyn.remove.call(b,c):(this.trigger("fireremove"),c(!0));return this},hide:function(){if(this.imgEles)for(var a in this.imgEles)this.imgEles[a].hide()},createImg:function(){var a=this.signatureData,b=$(document.createElement("img")),c=blankImg;this.broken||(c="data:image/"+a.seal.imgext+";base64,"+this.toBase64Img(a.seal));b.css({width:Math.ceil(9600*
parseFloat(a.seal.width)/254),height:Math.ceil(9600*parseFloat(a.seal.height)/254)}).attr({src:c});return b},show:function(){var a=this.signatureData.position,b=this.imgEles=this.imgEles||{},c;for(c in a){var d="kg-img-div-"+this.signatureid+"-"+c,e=b[d];e||(e=b[d]=this.showAt(c,a[c]));this._handleImg(e)}this.trigger("show")},showAt:function(a,b){this.trigger("beforeShowAt",a,b);var c=Utils.$(a),d=$(c);this.extra&&this.extra[this.signatureid]&&(c=this.extra[this.signatureid].scopePosition)&&(d=c instanceof
Object?c.find("#"+a):$(Utils.$(c)).find("#"+a));if(0==d.length)if(Signature.options.defaultPos)a=Signature.options.defaultPos,d=$(Utils.$(a));else throw Error("no find position:"+a+" signatureid="+this.signatureid);var e=this.createImg();e.addClass("kg-img").attr("id","kg-img-"+this.signatureid);c=$(document.createElement("div")).addClass("kg-img-div").addClass("kg-img-div-"+a).attr({id:"kg-img-div-"+this.signatureid+"-"+a,elemid:a,signatureid:this.signatureid});c.append(e);c.css({width:e.width(),
height:e.height()});var f=0,g=0,k=this.signatureData.dateTime;null!=k&&k.isCheck&&k.fontDate&&(this.addDateToImg(k.fontDate,this.signatureData.timestamp.time,c),null!=this.imageAndDate&&this.imageAndDate&&"outside"==k.fontDate.fontPosition[2]&&("right"==k.fontDate.fontPosition[3]?f+=c.width():"left"==k.fontDate.fontPosition[3]&&(f+=c.width()),"below"==k.fontDate.fontPosition[4]&&(g+=c.height())));c.css({width:e.width()+f,height:e.height()+g});e=c;f="kg-default";if(k=d.attr("display"))d.addClass("display-"+
k),f="kg-"+k,g=d,e=document.getElementById("kg-img-container-"+a),e||(e=document.createElement("div"),e.setAttribute("id","kg-img-container-"+a)),e=$(e).addClass(f+"-container"),e.append(c),c.attr("kg-display",!0);else if(g=d.offsetParent(),"html"==g[0].tagName.toLowerCase()||"relative"==g[0].style.position)g=$("body");c.addClass(f);g.append(e);if(k){if("landscape"===k){d=e.children();f=e.parent().width();var h=0;d.each(function(){h+=parseInt($(this).width())+1});e.width(h>f?h:f)}}else this.calSealPos(d,
c,e,b);this.trigger("showAt",c[0],a,b);return c},calSealPos:function(a,b,c,d){var e=a.offsetParent();c=c||b;if("html"==e[0].tagName.toLowerCase()||"relative"==e[0].style.position)e=$("body");a=a.offset();var f=e.offset();e.is("body")&&(f={top:0,left:0});c.css({top:a.top-f.top,left:a.left-f.left});d?(e=d.marginLeft,d=d.marginTop):(e=b.css("marginLeft"),d=b.css("marginTop"));b.css({marginLeft:e||0,marginTop:d||0})},addDateToImg:function(a,b,c){b=kinggrid.Utils.formatDate(new Date(b),a.fontFormat);var d=
$(document.createElement("div")).addClass("kg-date"),e=0,f=0;"outside"==a.fontPosition[2]&&("right"==a.fontPosition[3]?e+=c.width():"left"==a.fontPosition[3]&&(e-=c.width()),"below"==a.fontPosition[4]&&(f+=c.height()));d.css({width:c.width(),height:c.height(),top:f,left:e});e=$(document.createElement("div")).addClass("kg-date-tmb").css({width:c.width()});f=$(document.createElement("div")).addClass("kg-date-lcr").css({"text-align":a.fontPosition[0],"font-family":a.fontFamily,"font-size":a.fontSize+
"px",color:a.fontColor});"bottom"==a.fontPosition[1]?e.css({bottom:0}):"middle"==a.fontPosition[1]&&f.css({"line-height":c.height()+"px"});f.html(b);e.html(f);d.html(e);c.append(d)},canSign:function(){return!this.modified&&!Signature.options.readonly&&Signature.options.signable&&!this.signatureData.signMeta},canMove:function(a){(a=!Signature.options.readonly&&this.signatureData.moveable&&Signature.options.moveable&&!$(a).attr("kg-display"))&&Signature.options.moveable_self&&(a=this.signatureData.keysn==
Signature.options.keysn);return a},canDelete:function(){return!Signature.options.readonly},_handleImg:function(a){a.show();if(0==a.children(".kg-shade").length){var b=$(document.createElement("div")).addClass("kg-shade");b.append(createImg(blankImg,a.width(),a.height()));a.append(b)}this._invalid(a);this.trigger("handleImg",a[0])},setSignatureData:function(a){Utils.is("String",a)?this.signatureData=JSON.parse(Utils.Base64.of().decode(a)):this.signatureData=a;this.oriSignatureData=JSON.parse(JSON.stringify(this.signatureData))},
getSignatureid:function(){return this.signatureid},getSignatureData:function(){var a=JSON.stringify(this.signatureData);return Utils.Base64.of().encode(a)},getBase64Image:function(a,b,c,d){c="kg-img-div-"+a+"-"+c;c=document.getElementById(c);null!=c&&(isIE8?d(this,"",a,b):html2canvas(c).then(function(c){c=c.toDataURL("image/png").split(",");d(this,c,a,b)}))},_invalid:function(a){var b=a.children(".kg-invalid");if(0==b.length){b=$(document.createElement("div")).addClass("kg-hide").addClass("kg-invalid");
a.append(b);var c=a.height()/3;b.css({top:c,height:c});c/=3;for(var d=a.width(),e=0;3>e;e++){var f=$(document.createElement("div")).height(c);0==e%2&&(f.addClass("kg-invalid-item"),f.append(createImg(blackImg,d,c)));b.append(f)}}if(this.modified){c="";for(d=0;d<this.modifiedItems.length;d++)e=this.modifiedItems[d],c+=e.desc+"["+e.field+"]\u7531{"+e.orivalue+"}\u66f4\u6539\u4e3a{"+e.newvalue+"};";a.attr("modified",c).addClass("error");b.removeClass("kg-hide")}else a.removeAttr("modified").removeClass("error"),
b.addClass("kg-hide")},_verify:function(a,b){this.trigger("before_verify");a=this.verifyProtectedData(a);if(!b||b&&b.batchVerify||null==this.oriSignatureData.timestamp.timestampInfo)return this.show(),this.trigger("_verify"),!a;var c=this;this.getVerifyTimeStamp(this.oriSignatureData.timestamp.timestampInfo,function(a){c.timeVerify=a;c.show();c.trigger("_verify");b&&b.sucCall&&b.sucCall.call(c)})},verify:function(a,b){this.trigger("beforeVerify");a=this._verify(a,b);this.trigger("verify");return a},
getVerifyProtectedItems:function(a,b){for(var c in a)if(void 0!=a[c]&&null!=a[c]){var d=a[c];if(d.field==b)return d}return null},getVerifyProtectedData:function(){for(var a=this.validatedData,b=this.signatureData.protectedData,c={},d=0;d<b.length;d++)if(void 0!=b[d]&&null!=b[d]){var e=b[d],f=e.field,g=a&&(a[f]||this.getVerifyProtectedItems(a,f)&&this.getVerifyProtectedItems(a,f).value);if(null==g){var k=Utils.$(f);if(k){if(g=k.getAttribute("kg-value")||k.value,void 0===g||null===g)g=k.innerHTML||
k.innerText}else g=void 0!=e.name&&null!=e.name?document.getElementById(e.name).value:""}e=Utils.val(g,this);e=this._formatValue(e);c[f]=e}return c},getSignTimeStamp:function(a){for(var b={},c=0;c<a.length;c++)b[a[c].field]=a[c].value;return Utils.Base64.of().encode(stringify(b))},getValidatedTimeStamp:function(){var a=this.getVerifyProtectedData();a=stringify(a);return Utils.Base64.of().encode(a)},getVerifyTimeStamp:function(a,b){var c=this.getValidatedTimeStamp(),d=a.CertData,e=kinggrid.surry(Signature.options.clientUrl,
"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);e.invoke("SetParamByName","TSCERTDATA",Utils.Base64.of().encode(d)).ret(function(){e.invoke("KGVerifyTSWithReq",a.TimeStampResponse,a.TimeStampResult,"",c,a.TimeStr,"").ret(function(a){b.call(this,a.result)})})},getH5SignData:function(){var a=this.hashAlg,b=this.encryptAlg,c=CryptoJS.SHA1(this.getSignData()).toString();return[{hashAlg:a,encryptAlg:b,signdata:c}]},verifyProtectedData:function(a){a&&(this.validatedData=
a);a={};$.extend(!0,a,this.signatureData.protectedData);Signature.verifyData&&(this.validatedData=Signature.verifyData(a));a=[];for(var b=this.getVerifyProtectedData(),c=this.signatureData.protectedData,d=0;d<c.length;d++)if(void 0!=c[d]&&null!=c[d]){var e=c[d],f=b[c[d].field];f!==e.value&&a.push({field:e.field,desc:e.desc,orivalue:e.value,newvalue:f})}this.modified=0<a.length;this.modifiedItems=a;return this.modified},verifySignData:function(a){var b=this;plus.showLoading();var c=this.certService;
if(this.signatureData.signMeta.html2sign){c instanceof ServerCert||(c=new ServerCert(Signature.options),c.sData=b.signatureData);var d=b.getVerifyProtectedData();for(var e=this.signatureData.protectedData,f=[],g=0;g<e.length;g++){var k=e[g],h={},m;for(m in k)k.hasOwnProperty(m)&&(h[m]=k[m]);h.value=d[k.field];f.push(h)}d=stringify(f)}else d=this.getValidatedSignData();c.verifySign($.extend({seal:this.signatureData.seal,signeddata:this.signatureData.signMeta.signeddata,crtdata:this.signatureData.signMeta.certinfo.crtdata,
keysn:this.signatureData.keysn,signsn:this.signatureData.seal.signsn,signdata:d},{successCall:function(c){plus.hideLoading();if(!c.errcode){b.signModified=!c.result;var d=b.verify(null,{sucCall:function(){a&&a(c)}})}null!=d&&a&&a(c)}}))},_renderValue:function(a){return a.replace(/\r\n/ig,"<br>")},_formatValue:function(a,b){a&&(a=a.replace(/\r\n/ig,"\n"),a=a.replace(/\n/ig,"\r\n"));return a},getItemVal:function(a){var b;if(b=Utils.is("String",a)?Utils.$(a):a)return a=b.tagName.toLowerCase(),"input"===
a||"textarea"===a||"select"===a?b.getAttribute("kg-value")||b.value:b.getAttribute("kg-value")||(isIE8?b.innerText:b.textContent);throw Error("No find protectedItem:"+a+" signatureid="+this.signatureid);},getProtectedData:function(a){var b=this,c=[],d=function(a){var c=Utils.$(a);if(c){var d={field:a};d.desc=c.getAttribute("kg-desc")||a;d.value=b.getItemVal(c);return d}throw Error("No find protectedItem:"+a+" signatureid="+this.signatureid);},e=function(a){if(Utils.is("String",a))a=d(a);else if(!Utils.is("Object",
a)||!a.field)throw Error("Unsupported protectedItems:"+a.toString);Utils.is("Function",a.value)&&(a.value=a.value.call(b,a.field,a.desc));a.value=b._formatValue(a.value);return a};if(a)if(Utils.is("Array",a))for(var f=0,g=a.length;f<g;f++)c.push(e(a[f]));else c.push(e(a));return c},__findSignedData:function(a){if(Utils.is("String",a))return a.split(";")[0];if(Utils.is("Array",a))return a[0];throw Error("error signeddata: "+a);},getValidatedSignData:function(){var a=this.getVerifyProtectedData();a=
stringify(a);a=Utils.Base64.of().encode(a);return CryptoJS.SHA1(a).toString()},getSignData:function(a){a=(a||this.signatureData).protectedData;for(var b={},c=0;c<a.length;c++)b[a[c].field]=a[c].value;return Utils.Base64.of().encode(stringify(b))},showSignSignatureDialog:function(a){var b={target:Utils.is("Array",a.target)?a.target:[a.target],title:kinggrid.msg("SignSignature","KG_TITLE"),onCancel:function(){Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()},onShow:function(){var a=
this;setTimeout(function(){a.find("#kg-password").focus()},40);a.find("#kg-password").keydown(function(b){13==b.keyCode&&a.options.onOk.call(a)})},onOk:function(){var b=this.find("#kg-password");if(!b.val())return plus.alert(kinggrid.msg("in_pwd_msg","KG_MSG"),function(){b.focus()}),!1;a._onOk.call(this,b.val());return!1}};return this.showDialog("signSignatureBtl",b)},changeMoveAble:function(a,b){this.signatureData.moveable=a;this.fireUpdate();b&&b()},signSignature:function(a){var b=this,c={target:b,
_onOk:function(c){var d=this,f=b.getH5SignData();b.runSign(f,c,function(c){c.result?b.fireUpdate(function(a){a&&d.remove()}):b.error(c,null,null,{_beginDlgOkCall:!0});a&&a(c)})}};if(b.signatureData.phoneshield)"client"==Signature.options.sealType&&b.sealService.getPhoneShieldLic({phoneshield:Signature.options.phoneshield},function(a){"1"==a.phoneshield||"3"==a.phoneshield?(kinggrid.options.timeout=1E3*(a.validatetime+10),c._onOk("")):"2"==a.phoneshield?b.error({errcode:"11110"},"then"):b.error({errcode:"11109"},
"then")});else return b.showSignSignatureDialog(c)},showRevokeSignatureDialog:function(a){var b={target:Utils.is("Array",a.target)?a.target:[a.target],title:kinggrid.msg("RevokeSignature","KG_TITLE"),quickClose:void 0==Signature.options.quickClose?!0:Signature.options.quickClose,onCancel:function(){Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()},onShow:function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call();var a=this;setTimeout(function(){a.find("#kg-password").focus()},
40);a.find("#kg-password").keydown(function(b){13==b.keyCode&&a.options.onOk.call(a)})},onOk:function(){var b=this.find("#kg-password");if(!b.val())return plus.alert(kinggrid.msg("in_pwd_msg","KG_MSG"),function(){b.focus()}),!1;a._onOk.call(this,b.val());return!1}};return this.showDialog("revokeSignatureBtl",b)},revokeSignature:function(a){var b=this,c={target:b,_onOk:function(c,e){var d=this;plus.showLoading();b.sealService.verifyPwd({pwd:c,keysn:b.signatureData.keysn,successCall:function(c){plus.hideLoading();
c.result&&(void 0!=c.delkeysn?c.delkeysn==b.signatureData.keysn:1)?void 0!==Signature.options.delCallBack&&Signature.options.delCallBack?Signature.options.delCallBack(b.signatureid,b.signatureData)&&b.fireRemove(function(a){a&&(d.remove?d.remove():b.remove())}):b.fireRemove(function(a){a&&(d.remove?d.remove():b.remove())}):b.error(c,null,null,{_beginDlgOkCall:!0});a&&a(c)},phoneshield:e})}};if(b.signatureData.phoneshield&&"client"==Signature.options.sealType)b.sealService.getPhoneShieldLic({phoneshield:"1"},
function(a){"1"==a.phoneshield||"3"==a.phoneshield?(kinggrid.options.timeout=1E3*(a.validatetime+10),c._onOk("","1")):"2"==a.phoneshield?b.error({errcode:"11110"},"then"):b.error({errcode:"11109"},"then")});else if(Signature.options.showNoPW&&"server"==Signature.options.sealType)c._onOk(Signature.options.password);else return b.showRevokeSignatureDialog(c)},showDialog:function(a,b){var c=Utils.is("Array",b.target)?b.target:[b.target],d={title:kinggrid.msg("KinggridSignature","KG_TITLE"),onShow:function(){var a=
this;setTimeout(function(){a.find("#kg-password").focus()},40);a.find("#kg-password").keydown(function(b){13==b.keyCode&&a.options.onOk.call(a)})},onCancel:b.errCall||function(){plus.hideLoading();return!0},content:function(){var b=[Signature.options.template[a]].concat(c);return Utils.template.apply(null,b)}};b=Utils.extend(d,b);var e=plus.showDialog(a,b);if("showSealsBtl"===a){var f=e.find("#sealTpl-dialog"),g=!1,k=0,h=0,m=0,q=0;f.prevObject[0].onmousedown=function(a){g=!0;a=a||event;null!=a&&(k=
a.clientX,h=a.clientY,m=parseInt(f.prevObject[0].style.top),q=parseInt(f.prevObject[0].style.left))};f.prevObject[0].onmousemove=function(a){if(g&&(a=a||event,null!=a)){var b=q+a.clientX-k;a=m+a.clientY-h;0<b&&0<a&&(f.prevObject[0].style.left=b+"px",f.prevObject[0].style.top=a+"px")}};f.prevObject[0].onmouseup=function(a){g&&(g=!1,q=m=h=k=0)}}"signatureInfoBtl"!=a&&"signInfoBtl"!=a||e.find(".ui-dialog-close").click(function(){e.close();Signature.options.dlgCancelCall&&Signature.options.dlgCancelCall.call()});
return e},runMove:function(a,b,c){var d=this;globalLisenter.trigger("startMove",d,a,b);var e=function(a){var b=a.moveableRange;if(!b){for(d in a.position){var c=d;break}(a=$("#"+c).attr("kg-mita"))&&(b=a)}if(b){var d=$("#"+b);if(0<d.length)return b=d.offset().left,a=d.offset().left+d.outerWidth(),c=d.offset().top,d=d.offset().top+d.outerHeight(),{left:b,right:a,top:c,bottom:d}}return{left:0,right:0,top:0,bottom:0}};return"client"==Signature.options.sealType&&Signature.options.moveable_self&&d.keysn!=
d.signatureData.keysn?(Signature.alert(kinggrid.msg("cannot_move","KG_MSG")),!1):function(a,b,c){var f=e(d.signatureData);b=Drag.create(b,a,!0,f);b.onend=function(a,b,e,f){c&&c(b,e,f);globalLisenter.trigger("endMove",d,a,e,f);b&&(a=$(this),d.updatePos(a.attr("elemid"),{marginLeft:e,marginTop:f}),d.fireUpdate())};a.preventDefault();return b}(a,b,c)},runSign:function(a,b,c){var d=this,e=d.signatureData;plus.showLoading();d.certService.sign({seal:this.signatureData.seal,keysn:this.signatureData.keysn,
signsn:this.signatureData.seal.signsn,password:b,phoneshield:this.signatureData.phoneshield,signMeta:a,successCall:function(b){plus.hideLoading();b.result&&(b.signeddata?(b.certinfo.algName=b.certinfo.algName.toUpperCase(),d.updateItem("signMeta",{hashAlg:a[0].hashAlg,encryptAlg:a[0].encryptAlg,signdata:a[0].signdata,signeddata:d.__findSignedData(b.signeddata),certinfo:b.certinfo})):(b.result=!1,b.errcode="signErr"),e.certType=Signature.options.certType);c&&c(b)}})}});plus=kingPlus();
Signature.options=$.extend({savelogFlg:!0,b64Url:"/iWebSignature_base64",imageUrl:"/iWebSignature_image"},kinggrid.options,{dialogConfig:{okValue:"\u786e  \u5b9a",cancelValue:"\u53d6  \u6d88",fixed:!0,backdropOpacity:.2,modal:!0},template:{}},window.KGCONFIG);Signature.addProvider=function(a,b,c){Signature.factory[a][b]=c};var aisleKing;
Signature.init=function(a,b){this.Seals={};Utils.extend(Signature.options,a);var c=Signature.options;b=b?b:a.okCall;c.serverUrl&&(c.b64Url="_signature_b64",c.imageUrl="_signature_image",0<c.serverUrl.indexOf("?")?c.serverUrl+="&action=rest":c.serverUrl+="?action=rest");"client"==c.sealType?(c.clientUrl=c.https,aisleKing=Signature.aisleKing=kinggrid.surry(c.clientUrl?c.clientUrl:"http://127.0.0.1:9581","IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode)):
aisleKing=Signature.aisleKing=kinggrid.surry(c.serverUrl||c.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);(a=c.clientConfig)&&"client"===c.sealType?Signature.AXI("SetParamByName",a,b):b&&b.call();globalLisenter.trigger("init")};Signature.factory={cert:{},seal:{}};Signature.SealService=SealService;Signature.CertService=CertService;Signature.asyn={};
Signature._create=function(a){var b=this;b.setAttr(a);b.certService=new Signature.factory.cert[b.certType](a);b.sealService=new Signature.factory.seal[b.sealType](a);b.on("createSignature",function(a,d,e){a=[];var c=b._getLogInfo({LOGTYPE:"00",LOGSORT:"13",LOGMEMO:"\u76d6\u7ae0\u6210\u529f",LOGSORTSUBCLASS:"1301"});a.push(Utils.extend(d||{},c));e&&a.push(b._getLogInfo({LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"\u6570\u5b57\u7b7e\u540d\u6210\u529f"}));b.sealService.saveLog(a)});return this};
var signature=function(){};signature.prototype=Signature.prototype;var prototype=new signature;Signature._create.prototype=prototype;
$.extend(prototype,{keyData:null,sealExpired:function(a,b,c,d,e){var f=this,g=!0;if(void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid)return f.certExpired(b,c,d);if(void 0!==a.endata&&null!==a.endata){var k=a.endata;e=parseInt(c.substr(0,4));a=parseInt(c.substr(5,2));g=parseInt(c.substr(8,2));var h=parseInt(k.substr(0,4)),m=parseInt(k.substr(5,2));k=parseInt(k.substr(8,2));e>h?(f.errorCallback({errcode:"11104"},b.errorCall),g=!1):e==h?a>m?(f.errorCallback({errcode:"11104"},
b.errorCall),g=!1):a==m?g>k?(f.errorCallback({errcode:"11104"},b.errorCall),g=!1):g=!0:g=!0:g=!0}else return a=Signature.options.serverUrl+"_key_sealIsExpired",e=(parseInt(e)+1).toString(),$.ajax({url:a,type:"POST",data:{keysn:f.keyData.keysn,year:(new Date).getFullYear(),month:(new Date).getMonth(),date:(new Date).getDate(),index:e},async:!1,success:function(a){if(a.error)return f.errorCallback({errcode:"11105"},b.errorCall),!1;if(0==a.result)return f.certExpired(b,c,d);f.errorCallback({errcode:"11104"},
b.errorCall);return!1},error:function(a){f.errorCallback({errcode:"11105"},b.errorCall)}}),!1;return g?f.certExpired(b,c,d):g},certExpired:function(a,b,c){var d=this,e=!1;if(void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid)return!0;kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("KGGetCerInfo","").ret(function(f){var g=parseInt(b.substr(0,4)),k=parseInt(b.substr(5,
2)),h=parseInt(b.substr(8,2));if(f.result){f=f.certinfo.notAfter;var m=parseInt(f.substr(0,4)),q=parseInt(f.substr(4,1));q=0==q?parseInt(f.substr(5,1)):parseInt(f.substr(4,2));var y=parseInt(f.substr(6,1));y=0==y?parseInt(f.substr(7,1)):parseInt(f.substr(6,2));g>m?d.errorCallback({errcode:"11103"},a.errorCall):g==m?k>q?d.errorCallback({errcode:"11103"},a.errorCall):k==q?h>y?d.errorCallback({errcode:"11103"},a.errorCall):e=!0:e=!0:e=!0}else d.errorCallback({errcode:"11106"},a.errorCall);void 0!==c&&
null!==c&&c(e)});return e},errorCallback:function(a,b,c,d){b?(plus.hideLoading(),b.call(null,a,c)):this.error(a,c,null,d)},runHW:function(a,b){var c=this;plus.showLoading();"undefined"!=typeof a.imageData&&null!=a.imageData&&(void 0!==a.beginCall&&a.beginCall&&a.beginCall.call(c),c.sealService.loadSeal({data:a.imageData,successCall:function(d){plus.hideLoading();if(d.result&&d.seals){for(var e in d.seals){d.seals=[{width:a.width,height:a.height,imgext:d.seals[e].imgext,signname:a.name,signsn:d.seals[e].signsn,
username:d.seals[e].username,imgdata:a.imageData,headinfoex:d.seals[e].headinfoex}];break}c.keyData=d;c.showSeals(b)}else c.errorCallback(d,a.errorCall)},errorCall:function(b){c.errorCallback(b,a.errorCall)}}))},run:function(a){var b=this;b.keyData?b.showSeals(a):(plus.showLoading(),void 0!==a.beginCall&&a.beginCall&&a.beginCall.call(b),b.sealService.loadSeal({successCall:function(c){plus.hideLoading();c.result?c.seals&&c.seals.length?(b.keyData=c,void 0!==Signature.options.imgtag&&0!==Signature.options.imgtag&&
void 0===c.ServerTime?void 0!==b.serverUrl&&null!==b.serverUrl?(c={usercode:b.usercode,keysn:b.keyData.keysn,signname:b.signname,authcode:Signature.authcode},kinggrid.surry(b.serverUrl).request("_key_load",c).ret(function(c){c.result?(b.curDate=c.ServerTime,b.keyData=c,b.showSeals(a)):b.errorCallback(c,a.errorCall)})):(b.curDate=(new Date).toLocaleString(),b.showSeals(a)):(b.curDate=c.ServerTime,b.showSeals(a))):b.errorCallback({errcode:"11100"+Signature.options.imgtag},a.errorCall):b.errorCallback(c,
a.errorCall)},errorCall:function(c){b.errorCallback(c,a.errorCall)}}));return this},getSealsByKeysn:function(a,b,c){var d=this;d.sealService.loadSeal({successCall:function(a){if(a.result){var c=[];if(void 0!==b&&null!=b){for(var e=0;e<a.seals.length;++e)c[e]=d.toBase64Img(a.seals[e]);b(c)}}},errorCall:function(a){d.errorCallback(a,c.errorCall)}})},loadSeals:function(a,b){var c=this;c.sealService.loadSeal({successCall:function(b){void 0!==a&&null!==a&&null!==b&&void 0!==b.seals&&null!==b.seals&&a(b)},
errorCall:function(a){c.errorCallback(a,b&&b.errorCall?b.errorCall:null)}})},runSS:function(a,b){var c=this;null!==b&&(c.keyData=b,null==b.seals||0==b.seals.length?c.errorCallback({errcode:"11107"},a.errorCall):void 0!==Signature.options.imgtag&&0!==Signature.options.imgtag&&void 0===b.ServerTime?void 0!==c.serverUrl&&null!==c.serverUrl?(b={usercode:c.usercode,keysn:c.keyData.keysn,signname:c.signname,authcode:Signature.authcode},kinggrid.surry(c.serverUrl).request("_key_load",b).ret(function(b){b.result?
(c.curDate=b.ServerTime,c.keyData=b,c.showSeals(a)):c.errorCallback(b,a.errorCall)})):(c.curDate=(new Date).toLocaleString(),c.showSeals(a)):(c.curDate=b.ServerTime,c.showSeals(a)))},formatPos:function(a,b,c){var d={};if(a){var e=function(a){var e=a.elemid||a[0].id;e||(e="body");d[e]=void 0!=b&&void 0!=c?{marginLeft:b,marginTop:c}:Utils.filter(a,e)};if(Utils.is("Array",a))for(var f=0;f<a.length;f++)e(a[f]);else Utils.is("String",a)?d[a]=void 0!=b&&void 0!=c?{marginLeft:b,marginTop:c}:{}:e(a)}else d.body=
{};return d},exec:function(a,b,c,d,e,f){var g=this;delete g.signatureData;var k=null!=a.protectedItemsType&&"1"==a.protectedItemsType?a.protectedItems:g.getProtectedData(a.protectedItems);k={timestamp:{time:void 0==a.signtime?(new Date).getTime():(new Date(Date.parse(a.signtime.replace(/-/g,"/")))).getTime(),signtime:void 0==a.showtime?a.signtime:a.showtime,timestampInfo:a.timestampInfo},appname:navigator.userAgent,documentid:void 0==a.documentid?g.documentid:a.documentid,documentname:void 0==a.documentname?
g.documentname:a.documentname,moveable:Utils.boolean(a,"moveable",Signature.options.moveable),keysn:g.keyData.keysn,orgname:g.keyData.orgname,usercode:g.keyData.usercode,username:g.keyData.username||c.username,phoneshield:Signature.options.phoneshield?!0:!1,gbOvalue:g.keyData.gbOvalue,seal:c,moveableRange:a.moveableRange,protectedData:k,sealType:a.sealType||g.sealType,extparam:a.extparam,ver:Signature.version,dateTime:a.datetime};g.signatureData=k;g.certService.sData=g.signatureData;g.sealService.sData=
g.signatureData;plus.showLoading();var h=a.autoCert||g.autoCert||Signature.options.phoneshield&&"1"!=Signature.options.fjrsIsphone,m=function(a){var b=g.signatureData;if(a&&a.position){if(a.offsetX&&a.offsetY)a.changeOffsetXY&&a.changeOffsetXY(a),b.position=g.formatPos(a.position,a.offsetX,a.offsetY);else if(a.changeOffsetXY){var d={width:Math.ceil(9600*parseFloat(c.width)/254),height:Math.ceil(9600*parseFloat(c.height)/254)};d=a.changeOffsetXY(d);b.position=g.formatPos(a.position,d.offsetX,d.offsetY)}else b.position=
g.formatPos(a.position);d=a.signatureid||g.genId();a&&a.scopePosition&&(void 0==Signature.options.extra&&(Signature.options.extra={}),Signature.options.extra[d]={scopePosition:a.scopePosition});b.timeid=(new Date).getTime();var e=(new Signature(d,b)).load(Signature.options);a.okCall&&(b={name:c.signname,height:c.height,width:c.width,imgdata:g.toBase64Img(c)},a.isBatchSignature?a.okCall.call(e,function(a){},a.documentid):a.okCall.call(e,function(b){g.trigger("createSignature",e,a.logMeta,h);b&&e.show()},
b));plus.hideLoading()}else throw Error("no set position");};if(h){g.getSignData(k);k=g.getH5SignData();if(a.signMeta)k[Utils.is("Array",a.signMeta)?"concat":"push"](a.signMeta);a.beforeSignCall&&a.beforeSignCall.call(g,k);e?"client"==Signature.options.sealType?g.runSign(k,d,function(k){k.result&&(m(a),f&&1<f.batchSignature.length&&(a.documentid=f.batchSignature[f.batchSignature.length-1].documentid,a.documentname=f.batchSignature[f.batchSignature.length-1].documentname,a.position=f.batchSignature[f.batchSignature.length-
1].position,a.protectedItems=f.batchSignature[f.batchSignature.length-1].protectedItems,--f.batchSignature.length,g.exec(a,b,c,d,e,f)));b(k)}):g.runSign(k,d,function(c){c.result&&m(a);b(c)}):g.runSign(k,d,function(c){c.result&&m(a);b(c)})}else e?m(a):g.sealService.verifyPwd({pwd:d,keysn:k.keysn,successCall:function(c){c.result?m(a):Signature.options.pwd_clear_flag&&g.onDeleteRPW?g.onDeleteRPW():null;b(c)},phoneshield:Signature.options.phoneshield})},runPwd:function(a){var b=this;b.showPwdDialog({cancelCall:a.cancelCall,
_onOk:function(c){Signature.options.showNoPW=!0;Signature.options.password=c;var d=this.find("#kg-remenberPwd").is(":checked");b.trigger("execSuccess",this,c,d);b.run($.extend(a,{beginCancalCall:function(){Signature.options.showNoPW=!1;Signature.options.password=""}}))}})},showPwdDialog:function(a){var b=this,c=a._onOk;b.showDialog("passwordTpl",{onCancel:a.cancelCall,onShow:function(){var a=this;b.trigger("showSealsDialog_PW",a);setTimeout(function(){a.find("#kg-password").focus()},40);a.find("#kg-password").keydown(function(b){13==
b.keyCode&&a.options.onOk.call(a)})},onOk:function(){var a=this.find("#kg-password"),b=a.val();b?(c.call(this,b),this.remove()):plus.alert(kinggrid.msg("in_pwd_msg","KG_MSG"),function(){a.focus()});return!1},content:function(){return Utils.template.apply(null,[plus.template.passwordTpl])}})},getPassCheck:function(a,b,c){if(a&&1==a)return a;if(void 0===c||!0===c||"auto"===c)try{return b.find("#kg-remenberPwd").is(":checked")}catch(d){}return!1},showSeals:function(a){var b=this,c={errorCall:a.errorCall,
cancelCall:a.cancelCall,beginCancalCall:a.beginCancalCall,protectedItems:a.protectedItems,protectedItemsType:a.protectedItemsType,protectedItemsCheckedAll:void 0==a.protectedItemsCheckedAll?!0:a.protectedItemsCheckedAll,_onOk:function(c,d,e,f,q,y){var g=this,k=new plus.kgFont(null==g.fontSel?null==b.signdate?{}:b.signdate:g.fontSel),m=g.isCheck;!1!==Signature.options.showSealsDlg&&b.autoDlg||!Signature.options.signdate||!Signature.options.signdate.ischeck||(m=Signature.options.signdate.ischeck);a.protectedItems=
null==g.proItems?0==a.protectedItemsCheckedAll?[]:a.protectedItems:g.proItems;a.datetime={isCheck:m,fontDate:k};void 0!=f&&null!=f?(a.signtime=f,void 0!=q&&null!=q?(a.showtime=(f+" ("+q.TimeExt+")").replace(/-/g,"/"),a.showtime+=kinggrid.msg("timestamp_time","KG_MSG"),a.timestampInfo=q):(a.showtime=(new Date(Date.parse(f.replace(/-/g,"/")))).toLocaleString(),a.showtime+=kinggrid.msg("server_time","KG_MSG"))):(a.signtime=void 0,a.showtime=(new Date).toLocaleString(),a.showtime+=kinggrid.msg("local_time",
"KG_MSG"));y=b.getPassCheck(y,g,Signature.options.showSealsDlg);void 0===Signature.options.valid||null===Signature.options.valid||!1===Signature.options.valid?a.batchSignature?b.sealService.verifyPwd({pwd:d,usercode:void 0==a.usercode?"":a.usercode,keysn:b.keyData.keysn,successCall:function(e){if(e.result){for(e=0;e<a.batchSignature.length&&(a.batchSignature[e].signtime=a.signtime,a.batchSignature[e].showtime=a.showtime,null!=a.position&&(a.batchSignature[e].position=a.position),a.batchSignature[e].autoCert=
a.autoCert,a.batchSignature[e].okCall=a.okCall,a.batchSignature[e].cancelCall=a.cancelCall,a.batchSignature[e].beginCall=a.beginCall,a.batchSignature[e].endCall=a.endCall,null!=a.protectedItems&&(a.batchSignature[e].protectedItems=a.protectedItems),a.batchSignature[e].protectedItemsType=a.protectedItemsType,a.batchSignature[e].datetime=a.datetime,a.batchSignature[e].offsetX=a.offsetX,a.batchSignature[e].offsetY=a.offsetY,a.batchSignature[e].changeOffsetXY=a.changeOffsetXY,a.batchSignature[e].isBatchSignature=
!0,b.exec(a.batchSignature[e],function(c){c.result?void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW?void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b):(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&b.trigger("execSuccess",g,d,y):b.errorCallback(c,a.errorCall)},c,d,!0,a),void 0!==a.batchSignature[e].endCall&&a.batchSignature[e].endCall&&a.batchSignature[e].endCall.call(b),"client"!=Signature.options.sealType||!a.autoCert);++e);
void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b);(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&g.remove()}else Signature.options.pwd_clear_flag&&b.onDeleteRPW?b.onDeleteRPW():null,b.errorCallback(e,a.errorCall)},phoneshield:Signature.options.phoneshield}):(b.exec(a,function(c){c.result?(void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==a.beginCancalCall&&a.beginCancalCall&&
a.beginCancalCall.call(b):(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&b.trigger("execSuccess",g,d,y),g.remove()):b.errorCallback(c,a.errorCall,null,{_beginDlgOkCall:!0})},c,d),void 0!==a.endCall&&a.endCall&&a.endCall.call(b)):void 0!==b.curDate&&null!==b.curDate&&b.sealExpired(c,a,b.curDate,function(e){e?a.batchSignature?b.sealService.verifyPwd({pwd:d,keysn:b.keyData.keysn,successCall:function(e){if(e.result){for(e=0;e<a.batchSignature.length&&(a.batchSignature[e].signtime=
a.signtime,a.batchSignature[e].showtime=a.showtime,null!=a.position&&(a.batchSignature[e].position=a.position),a.batchSignature[e].autoCert=a.autoCert,a.batchSignature[e].okCall=a.okCall,a.batchSignature[e].cancelCall=a.cancelCall,a.batchSignature[e].beginCall=a.beginCall,a.batchSignature[e].endCall=a.endCall,null!=a.protectedItems&&(a.batchSignature[e].protectedItems=a.protectedItems),a.batchSignature[e].protectedItemsType=a.protectedItemsType,a.batchSignature[e].datetime=a.datetime,a.batchSignature[e].offsetX=
a.offsetX,a.batchSignature[e].offsetY=a.offsetY,a.batchSignature[e].changeOffsetXY=a.changeOffsetXY,a.batchSignature[e].isBatchSignature=!0,b.exec(a.batchSignature[e],function(c){c.result?void 0!==Signature.options.showNoPW||!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b):(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&b.trigger("execSuccess",g,d,y):b.errorCallback(c,
a.errorCall)},c,d,!0),void 0!==a.batchSignature[e].endCall&&a.batchSignature[e].endCall&&a.batchSignature[e].endCall.call(b),"client"!=Signature.options.sealType||!a.autoCert);++e);void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b);(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&g.remove()}else b.errorCallback(e,a.errorCall)},phoneshield:Signature.options.phoneshield}):(b.exec(a,function(c){c.result?(void 0!==Signature.options.showNoPW||
!0===Signature.options.showNoPW||Signature.options.phoneshield?void 0!==a.beginCancalCall&&a.beginCancalCall&&a.beginCancalCall.call(b):(void 0===Signature.options.showSealsDlg||!0===Signature.options.showSealsDlg||b.autoDlg)&&b.trigger("execSuccess",g,d,y),g.remove()):b.errorCallback(c,a.errorCall,null,{_beginDlgOkCall:!0})},c,d),void 0!==a.endCall&&a.endCall&&a.endCall.call(b)):b.errorCallback({errcode:"11103"},a.errorCall)},e)}};if(void 0!==Signature.options.showSealsDlg){var d=!0;if("auto"==Signature.options.showSealsDlg){var e=
b.keyData;e.seals&&1==e.seals.length&&(d=!1)}b.autoDlg=d;if(!1!==Signature.options.showSealsDlg&&d)this.showSealsDialog(c);else if(void 0===Signature.options.password&&void 0!==b.password&&(Signature.options.password=b.password),void 0===Signature.options.password)b.errorCallback({errcode:"11108"},a.errorCall);else if(void 0!=Signature.options.timestamp&&1==Signature.options.timestamp)if("client"==Signature.options.sealType){var f=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1",
"4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);f.invoke("KGGetTSURLInfo").ret(function(d){d.result?f.invoke("KGGetTSWithDigest",d.TimeStampUrl,d.TimeStampUserName,d.TimeStampPassword,b.getSignTimeStamp(b.getProtectedData(a.protectedItems)),"").ret(function(d){d.result?c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0,d.TimeStr,d):(b.errorCallback(d,a.errorCall,"KGGetTSWithDigest"),c._onOk.call(b,e.seals[0],pwdVal,0))}):(b.errorCallback(d,a.errorCall,"KGGetTSURLInfo"),
c._onOk.call(b,e.seals[0],pwdVal,0))})}else $.ajax({url:Signature.options.serverUrl+"_key_getTimeStamp",type:"POST",data:{keysn:b.keyData.keysn},async:!1,success:function(a){a.result?c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0,a.timestamp):c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0)},error:function(a){c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0)}});else c._onOk.call(b,b.keyData.seals[0],Signature.options.password,0)}else this.showSealsDialog(c)},
showSealsDialog:function(a){var b=this,c=b.keyData;null!=b.signdate&&(c.signDateIsCheck=b.signdate.ischeck);var d=null!=a.protectedItemsType&&"1"==a.protectedItemsType?a.protectedItems:b.getProtectedData(a.protectedItems);c.showProtectedBtn=d&&0<d.length&&Signature.options.showProtectedBtn;for(var e=a.protectedItemsCheckedAll,f=[],g=0;d&&g<d.length;g++)f[g]=d[g],f[g].isChecked=e;c.newProItems=f;var k=[c],h=a._onOk,m=a.beginCancalCall;d={onCancel:a.cancelCall,onShow:function(){var d=this,e=d.find(".kg-switcher");
if(e.length){var f=new Utils.Switcher(e[0],b.switcher||{});e.find(".arrow-right").click(function(a){a.preventDefault();f.swipeNext()});e.find(".arrow-left").click(function(a){a.preventDefault();f.swipePrev()});e.find(".kg-guide span").click(function(a){a.preventDefault();f.to(+this.getAttribute("index"))});b.switcher=f}d.find("#kg-dateSet").click(function(a){b.showFontDialog(d)});setTimeout(function(){d.find("#kg-password").focus()},40);b.trigger("showSealsDialog",d);Signature.options.showNoPW&&Signature.options.phoneshield||
b.trigger("showSealsDialog_PW",d);d.find("#kg-password").keydown(function(a){13==a.keyCode&&d.options.onOk.call(d)});d.find("#kg-protectedDataSet").click(function(e){b.showProtectedDataDialog(d,a,c)})},onOk:function(){var d=this,e=d.find("#kg-password"),f=e.val()||Signature.options.password;if(!Signature.options.phoneshield&&!f)return plus.alert(kinggrid.msg("in_pwd_msg","KG_MSG"),function(){setTimeout(function(){e.focus()},100)}),!1;var g=d.find(".kg-wrapper .active");d.isCheck=d.find("#kg-addDate").is(":checked");
var m=d.find("#kg-remenberPwd").is(":checked"),k=b.keyData.seals[g.attr("index")].SealTag||b.keyData.seals[g.attr("index")].sealtag;if("client"==Signature.options.sealType&&k&&"GM"==k){var G=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);k=b.keyData.seals[g.attr("index")].SealCert||b.keyData.seals[g.attr("index")].signercert;var O=b.keyData.seals[g.attr("index")].ValidStart||b.keyData.seals[g.attr("index")].validstart,
F=b.keyData.seals[g.attr("index")].ValidEnd||b.keyData.seals[g.attr("index")].validend,K=b.keyData.seals[g.attr("index")].CertList||b.keyData.seals[g.attr("index")].certlist;G.invoke("KGValidate_GM","",k,O,F,K,"").ret(function(e){if(e.result)if(void 0!=Signature.options.timestamp&&1==Signature.options.timestamp){var k=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);k.invoke("KGGetTSURLInfo").ret(function(e){e.result?
k.invoke("KGGetTSWithDigest",e.TimeStampUrl,e.TimeStampUserName,e.TimeStampPassword,b.getSignTimeStamp(b.getProtectedData(a.protectedItems)),"").ret(function(e){e.result?h.call(d,c.seals[g.attr("index")],f,g.attr("index"),e.TimeStr,e,m?!0:!1):(b.errorCallback(e,a.errorCall,"KGGetTSWithDigest"),h.call(d,c.seals[g.attr("index")],f,g.attr("index"),void 0,void 0,m?!0:!1))}):(b.errorCallback(e,a.errorCall,"KGGetTSWithDigest"),h.call(d,c.seals[g.attr("index")],f,g.attr("index"),void 0,void 0,m?!0:!1))})}else h.call(d,
c.seals[g.attr("index")],f,g.attr("index"),void 0,void 0,m?!0:!1);else return b.errorCallback(e,a.errorCall,"KGValidate_GM"),!1})}else if("client"==Signature.options.sealType&&b.keyData.seals[g.attr("index")].sealtag&&"GB"==b.keyData.seals[g.attr("index")].sealtag){G=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);var L=b.keyData.seals[g.attr("index")];G.invoke("KGVerifyGBSealAction",L.sesealinfo,L.signsn).ret(function(c){if(c.result)b.keyData.gbOvalue=
c.ovalue,h.call(d,L,f,g.attr("index"),void 0,void 0,m?!0:!1);else return b.errorCallback(c,a.errorCall,"KGVerifyGBSealAction"),!1})}else return g=d.find(".kg-wrapper .active"),d.isCheck=d.find("#kg-addDate").is(":checked"),void 0!=Signature.options.timestamp&&1==Signature.options.timestamp?"client"==Signature.options.sealType?(G=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),G.invoke("KGGetTSURLInfo").ret(function(e){e.result?
G.invoke("KGGetTSWithDigest",e.TimeStampUrl,e.TimeStampUserName,e.TimeStampPassword,b.getSignTimeStamp(b.getProtectedData(a.protectedItems)),"").ret(function(e){e.result?h.call(d,c.seals[g.attr("index")],f,g.attr("index"),e.TimeStr,e):(b.errorCallback(e,a.errorCall,"KGGetTSWithDigest"),h.call(d,c.seals[g.attr("index")],f,g.attr("index")))}):(b.errorCallback(e,a.errorCall,"KGGetTSURLInfo"),h.call(d,c.seals[g.attr("index")],f,g.attr("index")))})):$.ajax({url:Signature.options.serverUrl+"_key_getTimeStamp",
type:"POST",data:{keysn:b.keyData.keysn},async:!1,success:function(a){a.result?h.call(d,c.seals[g.attr("index")],f,g.attr("index"),a.timestamp):h.call(d,c.seals[g.attr("index")],f,g.attr("index"))},error:function(a){h.call(d,c.seals[g.attr("index")],f,g.attr("index"))}}):h.call(d,c.seals[g.attr("index")],f,g.attr("index")),!1},content:function(){k.push(b.toBase64Img);var a=[Signature.options.template.showSealsBtl].concat(k);if(Signature.options.showNoPW||Signature.options.phoneshield)a=[Signature.options.template.showSealsBtl_nopassword].concat(k);
return Utils.template.apply(null,a)}};void 0!==m&&m&&(d=Utils.extend({onCancel:function(){void 0!==m&&m&&m.call(b);this.close()}},d));Signature.options.showNoPW||Signature.options.phoneshield?b.showDialog("showSealsBtl_nopassword",d):b.showDialog("showSealsBtl",d);Signature.options.showSignExpirePrompt&&null!=c.currenttime&&void 0!=c.currenttime&&null!=c.overdate&&void 0!=c.overdate&&(d=new Date(c.currenttime),e=Math.floor(((new Date(c.overdate)).getTime()-d.getTime())/864E5),e<=c.hintdays&&0<=e&&
(localStorage.getItem("lastAlertDate")&&null!=localStorage.getItem("lastAlertDate")&&""!=localStorage.getItem("lastAlertDate")?(f=localStorage.getItem("lastAlertDate"),f=new Date(f),0<d.getTime()-f.getTime()&&b.showExpirtDialog("\u5f53\u524d\u7528\u6237\u8fd8\u6709"+e+"\u5929\u8fc7\u671f\uff0c\u8bf7\u53ca\u65f6\u66f4\u65b0\uff01",c.currenttime)):b.showExpirtDialog("\u5f53\u524d\u7528\u6237\u8fd8\u6709"+e+"\u5929\u8fc7\u671f\uff0c\u8bf7\u53ca\u65f6\u66f4\u65b0\uff01",c.currenttime)))},showProtectedDataDialog:function(a,
b,c){var d=[{newProData:c.newProItems,proItemsCheckedAll:b.protectedItemsCheckedAll}],e={title:kinggrid.msg("ProtectedDataSet","KG_TITLE"),content:function(){d.push(Utils.html2Escape);var a=[Signature.options.template.protectedDataSetBtl].concat(d);return Utils.template.apply(null,a)},onOk:function(){for(var d=0;d<c.newProItems.length;d++)f.find("input[name='kg-proItem']").each(function(a,b){if(f.find("input[name='kg-proItem']")[a].checked&&$(this).val()==c.newProItems[d].field)return c.newProItems[d].isChecked=
!0,!1;c.newProItems[d].isChecked=!1});var e=[];if(null!=b.protectedItemsType&&"1"==b.protectedItemsType)for(var h=0;h<c.newProItems.length;h++)c.newProItems[h].isChecked&&e.push(c.newProItems[h]);else for(h=0;h<c.newProItems.length;h++)c.newProItems[h].isChecked&&e.push(c.newProItems[h].field);a.proItems=e}},f=plus.showDialog("protectedDataSetBtl",e);f.find("#kg-proData-items").on("click",function(a){"LABEL"==a.target.tagName&&f.find("#kg-selectedProData").text($(a.target).text().split("]")[1]);if("checkbox"==
a.target.type)if($(a.target).is(":checked")){a=!0;for(var c=f.find("input[name='kg-proItem']"),d=0;d<c.length;d++)if(!c[d].checked){a=!1;break}a&&(f.find("input[name='selectAll']")[0].checked=!0,b.protectedItemsCheckedAll=!0)}else f.find("input[name='selectAll']")[0].checked=!1,b.protectedItemsCheckedAll=!1});f.find("#kg-selectBox").on("click",function(a){if($(a.target).is(":checked")){b.protectedItemsCheckedAll=!0;a=f.find("input[name='kg-proItem']");for(var d=0;d<a.length;d++)a[d].checked=!0,c.newProItems[d].isChecked=
!0}else for(b.protectedItemsCheckedAll=!1,a=f.find("input[name='kg-proItem']"),d=0;d<a.length;d++)a[d].checked=!1,c.newProItems[d].isChecked=!1});return f},showFontDialog:function(a){var b=this,c=plus.dafaultDate,d=null==b.signdate?{}:b.signdate,e=plus.defaultFont;b=this;b=null==d.fontFormat?e.fontFormat:d.fontFormat;var f=null==d.fontFamily?e.fontFamily:d.fontFamily,g=null==d.fontSize?e.fontSize:d.fontSize,k=e.fontColor;null!=d.fontColor&&/^#([0-9a-fA-f]{6})$/.test(d.fontColor)&&(k=d.fontColor.toUpperCase());
d=null==d.position?e.position:d.position;null!=a.fontSel&&(b=a.fontSel.fontFormat,f=a.fontSel.fontFamily,g=a.fontSel.fontSize,k=a.fontSel.fontColor,d=plus.fontTemplate.position[a.fontSel.fontPositionIndex]);var h=this.getArrayPush(Signature.options.fontTemplate.fontFormat,b),m=[{fontFormat:this.getFormatDate(h,c),fontFamily:this.getArrayPush(Signature.options.fontTemplate.fontFamily,f),fontSize:this.getArrayPush(Signature.options.fontTemplate.fontSize,g),fontColor:this.getArrayPush(Signature.options.fontTemplate.fontColor,
k),fontPosition:Signature.options.fontTemplate.position,dFontFormat:kinggrid.Utils.formatDate(new Date(c),b),dFontFamily:f,dFontSize:g,dFontColor:k,dFontPosition:d}];c={title:kinggrid.msg("DateSet","KG_TITLE"),content:function(){var a=[Signature.options.template.dateSetBtl].concat(m);return Utils.template.apply(null,a)},onOk:function(){var b=this.find("#kg-fontFormat").get(0).selectedIndex;a.fontSel={fontFormat:h[b],fontFamily:this.find("#kg-fontFamily").val(),fontSize:this.find("#kg-fontSize").val(),
fontColor:kinggrid.Utils.colorHex(this.find("#kg-select-color").css("backgroundColor")),fontPositionIndex:this.find("#kg-fontPosition").get(0).selectedIndex}}};var q=plus.showDialog("dateSetBtl",c);q.find("#kg-select-color").on("click",function(){"block"==q.find(".kg-color-div").css("display")?(q.find(".kg-color-div").css("display","none"),q.find("#kg-color-ul").css("display","none")):(q.find(".kg-color-div").css("display","block"),q.find("#kg-color-ul").css("display","block"))});q.find("#kg-color-ul li a").click(function(){q.find("#kg-select-color").css("backgroundColor",
$(this).css("backgroundColor"));q.find(".kg-color-div").css("display","none");q.find("#kg-color-ul").css("display","none")});q.find(".kg-color-div").on("mouseover",function(a){this.contains(a.fromElement||a.relatedTarget)||$(this).show()});q.find(".kg-color-div").on("mouseout",function(a){this.contains(a.toElement||a.relatedTarget)||$(this).hide()});return q},getArrayPush:function(a,b){-1==jQuery.inArray(b,a)&&a.push(b);return a},getFormatDate:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=kinggrid.Utils.formatDate(new Date(b),
a[d]);return c},genId:function(){return now()+rand()},getSeal:function(a){return this.keyData.seals[a]},saveSignature:function(a,b,c,d){var e=this;void 0!=a&&void 0!=b&&void 0!=c&&(a=void 0!=Signature.options.cache_path&&null!=Signature.options.cache_path?{documentId:a,signatureId:b,signaturedata:c,cachepath:Signature.options.cache_path}:{documentId:a,signatureId:b,signaturedata:c,cachepath:""},kinggrid.surry(Signature.options.serverUrl).request("_signature_saveHtmlSignature",a).ret(function(a){void 0!==
d&&null!==d&&d.call(e,a)}))},removeSignature:function(a,b,c){var d=this;void 0!=a&&void 0!=b&&(a={documentId:a,signatureId:b},kinggrid.surry(Signature.options.serverUrl).request("_signature_reomveHtmlSignature",a).ret(function(a){void 0!==c&&null!==c&&c.call(d,a)}))},getSaveSignatures:function(a,b,c){void 0!=a&&kinggrid.surry(Signature.options.serverUrl).request("_signature_getHtmlSignature",{documentId:a}).ret(function(a){a.result?b(a.sign):c&&c(a.result)})},showExpirtDialog:function(a,b){plus.showDialog("showExpirtDialog",
{content:'<div class="kg-dialog kg-dialog-runSignature" id="sealExpirt-dialog"><div class="kg-dialog-content">'+a+'</div><div ><input type="checkbox" name="noMorePrompts" id="kg-noMorePrompts">&nbsp;<label for="kg-noMorePrompts">\u4e0d\u518d\u63d0\u793a</label></div> </div>',onOk:function(){this.find("#kg-noMorePrompts").is(":checked")&&localStorage.setItem("lastAlertDate",b)},onCancel:function(){}})},getRPW:function(a){if(this.ongetRPW)return this.ongetRPW(a)}});
$.extend(Signature.options,{certType:"client",sealType:"client",clientUrl:"http://127.0.0.1:9581",moveable:!0,signable:!0,fontTemplate:plus.fontTemplate,template:{showSealsBtl:plus.template.sealTpl,showSealsBtl_nopassword:plus.template.sealTpl_nopassword,signSignatureBtl:'<div id="kg-dialog-sign" class="kg-dialog kg-dialog-password kg-dialog-sign"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u5bc6\u7801\uff1a</label><div class="kg-sm kg-sm-7"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div> </div></div></div>',
revokeSignatureBtl:'<div id="kg-verifyPass" class="kg-dialog  kg-dialog-password"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u7b7e\u7ae0\uff1a</label><div class="kg-sm kg-sm-7"><p class="kg-form-static"><%this.signatureData.seal.signname%></p></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u5bc6\u7801\uff1a</label><div class="kg-sm kg-sm-7"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div> </div></div></div>',
protectedDataSetBtl:'<div id="kg-setProData" class="kg-dialog "><div id="kg-pro-data" class="kg-sm-13 kg-dialog-proData "><% var newProData = this.newProData; %><% var isAllChecked = this.proItemsCheckedAll; %><div id="kg-proData-items" class="kg-dialog-proData-items"><% for(var i=0;i<newProData.length;i++){%><div class="kg-dialog-proData-item"><% var proId = "proItem"+i; %><% var filedd = newProData[i].desc && newProData[i].desc != "" ? newProData[i].desc : newProData[i].field; %><% var content = "[" + filedd+"]" + arguments[0](newProData[i].value); %><% if(newProData[i].isChecked){ %><input type="checkbox" checked name="kg-proItem" id="<% proId%>" value="<% newProData[i].field%>" class="kg-dialog-checkbox">&nbsp;<label class="kg-dialog-label" custom="pro-value"><% content%></label>&nbsp;<% } %><% else{ isAllChecked = false; %><input type="checkbox" name="kg-proItem" id="<% proId%>" value="<% newProData[i].field%>" class="kg-dialog-checkbox">&nbsp;<label class="kg-dialog-label"  custom="pro-value"><% content%></label>&nbsp;<% } %></div><%}%></div><div class="kg-dialog-line"></div><div class="kg-dialog-proData-selProData"><label id="kg-selectedProData" class="kg-selProData"></label></div></div><div ><% if(isAllChecked){ %><input type="checkbox" checked  name="selectAll" id="kg-selectBox"  class="kg-dialog-checkbox">&nbsp;<label class="kg-dialog-label" for="kg-selectBox" custom="pro-value">\u5168\u90e8\u9009\u4e2d</label>&nbsp;<% } else{ %><input type="checkbox"  name="selectAll" id="kg-selectBox"  class="kg-dialog-checkbox">&nbsp;<label class="kg-dialog-label" for="kg-selectBox" custom="pro-value">\u5168\u90e8\u9009\u4e2d</label>&nbsp;<% } %></div></div>',
dateSetBtl:'<div id="kg-setDate" class="kg-dialog kg-dialog-Date"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u683c\u5f0f\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontFormat" id="kg-fontFormat" class="kg-select kg-fontFormat"><% var fontFormat = this.fontFormat; %><% for(var i=0;i<fontFormat.length;i++) {%><% if(fontFormat[i] == this.dFontFormat){%><option class="kg-option" value="<% fontFormat[i]%>" selected><% fontFormat[i]%></option><%}else{%><option class="kg-option" value="<% fontFormat[i]%>"><% fontFormat[i]%></option><%}%><%}%></select></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u5b57\u4f53\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u5c3a\u5bf8\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u989c\u8272\uff1a</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u4f4d\u7f6e\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontPosition" id="kg-fontPosition" class="kg-select kg-fontPosition"><% var fontPosition = this.fontPosition; %><% for(var i=0;i<fontPosition.length;i++) {%><% if(fontPosition[i] == this.dFontPosition){%><option class="kg-option" value="<% fontPosition[i]%>" selected><% fontPosition[i]%></option><%}else{%><option class="kg-option" value="<% fontPosition[i]%>"><% fontPosition[i]%></option><%}%><%}%></select></div> </div></div></div>'}});
Signature.list={};Signature.updateList=[];Signature.removeList=[];
function formartSignatureData(a,b,c){var d=[],e={};for(h in a){var f={},g=a[h];Utils.is("String",g)&&0!=g.indexOf("ey")?(f["b64_"+h]=a[h],d.push(f)):e[h]=g}var k=[];(function(a){for(var b in a)k.push((new Signature(b,a[b])).load(Signature.options))})(e);if(a=d.length){e=Signature.options.signSize||5;var h=Math.ceil(a/e);for(f=1;f<=h;f++){g=e*(f-1);var m=e*f>a?a:e*f;aisleKing=kinggrid.surry(Signature.options.serverUrl);aisleKing.request(Signature.options.b64Url,d.slice(g,m)).ret(function(a){if(a.result)for(var b in a){if(0==
b.indexOf("b64_")){var c=a[b];Utils.is("String",c)&&(c=JSON.parse(c));k.push((new Signature(b.substring(4),c)).load(Signature.options))}}else Signature.prototype.error.call(null,a)})}}aisleKing.fin(function(a,d,e){b&&b(1==k.length?k[0]:k);c&&c()})}
Signature.loadSignature=function(a,b,c,d){var e={};void 0==Signature.options.extra&&(Signature.options.extra={});e[a]=b;void 0!==e.extra&&null!==e.extra&&(Signature.options.extra[e.signatureid]=e.extra);formartSignatureData(e,c||function(a){Signature.verify()},d)};
Signature.loadSignatures=function(a,b,c){var d={};void 0==Signature.options.extra&&(Signature.options.extra={});if(Utils.is("Array",a))for(var e=0;e<a.length;e++){var f=a[e];d[f.signatureid]=f.signatureData;void 0!==f.extra&&null!==f.extra&&(Signature.options.extra[f.signatureid]=f.extra)}else for(e in a)d[e]=a[e];formartSignatureData(d,b||function(){Signature.verify()},c)};
Signature.resetSignaturePos=function(a){void 0==Signature.options.extra&&(Signature.options.extra={});if(Utils.is("Array",a))for(var b=0;b<a.length;b++){var c=a[b];void 0!==c.extra&&null!==c.extra&&(Signature.options.extra[c.signatureid]=c.extra)}else for(b in a)Signature.options.extra[b]=a[b]};Signature.clearRPW=function(){var a=Signature.create();if(a.onDeleteRPW)a.onDeleteRPW()};var globalLisenter=new Listener("Signature");Signature.addLiseter=function(a,b){globalLisenter.on(a,b)};
Signature.verify=function(){var a=Signature.list,b=[];globalLisenter.trigger("beforeVerify",d);for(var c in a){var d=a[c];d._verify(null,{batchVerify:!0})||b.push(d);globalLisenter.trigger("eachVerify",d)}globalLisenter.trigger("verify",d);return b};
Signature.verifySignByList=function(a){var b=[];globalLisenter.trigger("beforeVerify",d);for(var c in a){var d=a[c],e=d._verify(null,{batchVerify:!0}),f=d.signatureData,g={};g.appname=f.appname;g.documentid=f.documentid;g.documentname=f.documentname;g.keysn=f.keysn;g.orgname=f.orgname;g.timestamp=f.timestamp;g.usercode=f.usercode;g.username=f.username;g.signname=f.seal.signname;g.signsn=f.seal.signsn;e||(g.modifiedItems=d.modifiedItems);b.push(g);globalLisenter.trigger("eachVerify",d)}globalLisenter.trigger("verify",
d);return b};Signature.bind=function(a){Utils.extend(Signature.asyn,a)};Signature.show=function(){var a=Signature.list,b;for(b in a)a[b].show()};Signature.hide=function(){var a=Signature.list,b;for(b in a)a[b].hide()};
Signature.AXI=function(a,b,c){Signature.authcode=f;var d=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),e;for(e in b){var f=b[e];""!==e&&""!==f?d.invoke(a,e,f):null!==e&&""!==e?d.invoke(a,e):d.invoke(a)}d.ret(function(a){a.result&&(Signature.options.moveable_self?(Signature.options.fjrsIsphone&&d.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),d.invoke("KGGetKeyOtherInfo","0").ret(function(b){b.result&&
(b=b.Res.substring(1,b.Res.length-1),Signature.options.keysn=b);void 0!==c&&null!==c&&c(a)})):void 0!==c&&null!==c&&c(a))});return d};Signature.showAndHideBySignatureId=function(a,b){var c=Signature.list,d;for(d in c)0<=d.indexOf(a)&&(b?c[d].show():c[d].hide())};Signature.addIcon=function(a){var b=Signature.options.icons||[];b.push(a);Signature.options.icons=b};Signature.create=function(a){var b=$.extend({},Signature.options,a);void 0!==a&&void 0!==a.imgtag&&(Signature.options.imgtag=a.imgtag);return new Signature._create(b)};
$.extend(Signature.prototype,{saveSignatures:function(){},getSignatures:function(){}});var ClientSeal=function(a){var b=this;$.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})};Utils.inherit(ClientSeal,Signature.SealService);var ClientCert=function(a){var b=this;$.each(a,function(a,d){if("function"===typeof b[a])b[a](d);else b[a]=d})};Utils.inherit(ClientCert,Signature.CertService);
$.extend(ClientSeal.prototype,{saveLog:function(a){var b=[];Utils.is("Object",a)?b.push(a):b=a;a=stringify({MSG:b});Signature.options.savelogFlg&&kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("SetParamByName","SAVEMSG",a)},loadSeal:function(a){var b=this,c=a.successCall,d=a.errorCall,e=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);
b.appcode?e.invoke("SetParamByName","APPCODE",b.appcode):b.appcode="";Signature.options.fjrsIsphone&&e.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone);e.invoke("KGGetKeyInfo").ret(function(e){if(e.result){Signature.options.fjrsIsphone&&localStorage.setItem("fjrsToken",e.fjrs_token);Signature.options.phoneshield=!e.phoneshield||"1"!=e.phoneshield&&"3"!=e.phoneshield?!1:!0;Signature.options.phoneshield&&(kinggrid.options.timeout=1E3*(e.validatetime+10));if(""==e.seals)if(null!=
a.data)e.seals={},e.seals[0]={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"};else{d.call(b,{result:!1,errcode:"11"});return}else{if(void 0!==Signature.options.imgtag&&null!==Signature.options.imgtag&&0!==Signature.options.imgtag){var f=[],k;for(k in e.seals){var h=e.seals[k];void 0!==h&&parseInt(h.imgtag)==Signature.options.imgtag&&(void 0!=e.fjrs_sealname?e.fjrs_sealname==e.seals[k].signname&&(f[f.length]=e.seals[k]):f[f.length]=e.seals[k])}e.seals=f}if(null!=Signature.options.signname){f=
[];for(k in e.seals)h=e.seals[k],void 0!==h&&h.signname==Signature.options.signname&&(f[f.length]=e.seals[k]);0==f.length&&(e.result=!1,e.errcode="11101");e.seals=f}}c.call(b,e)}else d.call(b,e)})},verifyPwd:function(a){var b=this,c=a.pwd,d=a.phoneshield?"1":"0",e=a.successCall;null==c&&(c="");var f=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);f.invoke("SetParamByName","ISPHONE",d);f.invoke("SetParamByName",
"FJRSISPHONE",a.phoneshield?a.phoneshield:"0");d&&f.invoke("SetParamByName","FJRSDELKEYSN",a.keysn);f.invoke("KGVerifyPin",c,a.keysn).ret(function(a){e.call(b,a)})},getKeysn:function(a,b){var c=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),d=a&&a.key?a.key:"0";Signature.options.fjrsIsphone&&(c.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),c.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken")));
c.invoke("KGGetKeyOtherInfo",d).ret(function(a){a.result?"0"==d?(a=a.Res.substring(1,a.Res.length-1),b(a)):b(a):plus.alert(kinggrid.msg(a.errcode,"then"),function(){Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()})})},getPhoneShieldLic:function(a,b){a=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);
Signature.options.fjrsIsphone&&a.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone);a.invoke("KGPhoneShieldLic").ret(function(a){b(a)})}});
$.extend(ClientCert.prototype,{verifySign:function(a){var b=this,c=a.successCall,d=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);a.seal&&a.seal.sealtag&&"GB"==a.seal.sealtag&&d.invoke("SetParamByName","GBSIGNSN",a.seal.signsn);Signature.options.fjrsIsphone&&d.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone);d.invoke("KGVerifySignMessage","123456",a.signdata,a.signeddata).ret(function(e){var f=
e.result||"-8"!==e.errcode?e:{result:!1};f.result&&a.seal&&"GB"==a.seal.sealtag?d.invoke("KGVerifyGBStampAction",a.signeddata).ret(function(a){a.result||(f={result:!1});c.call(b,f)}):c.call(b,f)});a.seal&&a.seal.sealtag&&"GB"==a.seal.sealtag&&d.invoke("SetParamByName","GBSIGNSN","")},parseDate:function(a){var b=new Date;b.setFullYear(a.substring(0,4),+a.substring(4,6)-1,a.substring(6,8));b.setHours(a.substring(8,10),a.substring(10,12),a.substring(12,14),0);return b.getTime()},sign:function(a){var b=
this,c=a.successCall,d=a.signMeta,e=[],f=[],g=a.seal,k=a.phoneshield?"1":"0";a=a.password;null==a&&(a="");for(var h=0;h<d.length;h++){var m=d[h];e.push(m.signdata);f.push(""+m.signdata.length)}d=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode);d.invoke("SetParamByName","ISPHONE",k);g&&g.sealtag&&("GB"==g.sealtag&&(k=g.sesealinfo,d.invoke("SetParamByName","CLEARGBSESEALINFO",""),d.invoke("SetParamByName","GBSESEALINFO",
k),d.invoke("SetParamByName","GBSIGNSN",g.signsn)),"GM"==g.sealtag&&d.invoke("SetParamByName","ISGM","1"));Signature.options.fjrsIsphone&&(d.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),d.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken")));d.invoke("KGCrySignMessage",a,e.join(";"),+f[0]).ret(function(a){a=$.extend({},a);a.result&&(a.certinfo.notAfter=b.parseDate(a.certinfo.notAfter),a.certinfo.notBefore=b.parseDate(a.certinfo.notBefore));c.call(b,a)});g&&
g.sealtag&&"GB"==g.sealtag&&(d.invoke("SetParamByName","CLEARGBSESEALINFO",""),d.invoke("SetParamByName","GBSIGNSN",""))}});Signature.addProvider("cert","client",ClientCert);Signature.addProvider("seal","client",ClientSeal);var ServerSeal=function(a,b){var c=this;c.sData=b;$.each(a,function(a,b){if("function"===typeof c[a])c[a](b);else c[a]=b})};Utils.inherit(ServerSeal,Signature.SealService);
var ServerCert=function(a,b){var c=this;c.sData=b;$.each(a,function(a,b){if("function"===typeof c[a])c[a](b);else c[a]=b})};Utils.inherit(ServerCert,Signature.CertService);
$.extend(ServerSeal.prototype,{getSealsUrl:"_key_load",verifyPwdUrl:"_key_verify",saveLogUrl:"_signature_saveLog",saveLog:function(a){a=stringify(a);Signature.options.savelogFlg&&kinggrid.surry(this.serverUrl).request(this.saveLogUrl,{loginfo:a}).ret(function(a){a.result||Signature.prototype.error.call(null,a)})},getPwdSaveTime:function(a,b){kinggrid.surry(Signature.options.serverUrl).request("_signature_getPwdSaveTime").ret(function(c){a(c.result?c.pwdTime:b)})},loadSeal:function(a){var b=this,c=
a.successCall,d=a.errorCall,e={usercode:b.usercode,keysn:b.keysn,signname:b.signname,authcode:b.authcode,password:Signature.options.password,sealTag:Signature.options.sealTag,certContext:Signature.options.cert};kinggrid.surry(b.serverUrl).request(b.getSealsUrl,e).ret(function(e){if(e.result){if(""==e.seals)if(null!=a.data)e.seals={},e.seals[0]={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"};else{d.call(b,{result:!1,errcode:"11101"});return}else if(void 0!==Signature.options.imgtag&&
null!==Signature.options.imgtag&&0!==Signature.options.imgtag){var f=[],k;for(k in e.seals){var h=e.seals[k];void 0!==h&&parseInt(h.imgtag)==Signature.options.imgtag&&(f[f.length]=e.seals[k])}e.seals=f}c.call(b,e)}else d.call(b,e)})},verifyPwd:function(a){var b=this,c=a.successCall;a={usercode:void 0==b.sData?a.usercode:b.sData.usercode,keysn:void 0==b.sData?a.keysn:b.sData.keysn,password:a.pwd};kinggrid.surry(b.serverUrl).request(b.verifyPwdUrl,a).ret(function(a){c.call(b,a)})}});
$.extend(ServerCert.prototype,{signUrl:"_sign",verifySignUrl:"_sign_verify",verifySign:function(a){var b=this,c=b.sData,d=a.successCall;kinggrid.surry(b.serverUrl).request(b.verifySignUrl,{certType:c.certType,isUTF8:c.isUTF8,signsn:c.seal.signsn,html2sign:c.signMeta.html2sign,keysn:c.keysn,signdata:a.signdata,signeddata:c.signMeta.signeddata,crtdata:c.signMeta.certinfo.crtdata,sealTag:c.seal.sealTag}).ret(function(a){d.call(b,a)})},sign:function(a){for(var b=this,c=a.signMeta,d=a.successCall,e=[],
f=a.seal.sealTag,g=0;g<c.length;g++){var k=c[g];"GM"==f&&(k.hashAlg="SM3",k.encryptAlg="SM2");e.push("$"+(k.hashAlg||b.hashAlg)+"|"+(k.encryptAlg||b.encryptAlg)+"$"+k.signdata)}a={keysn:a.keysn,password:a.password,signdata:e.join(";"),signsn:a.signsn,sealTag:f};kinggrid.surry(b.serverUrl).request(b.signUrl,a).ret(function(a){a.result&&(a.certinfo.algName=a.certinfo.algName.replace("with",""));d.call(b,a)})}});Signature.addProvider("cert","server",ServerCert);
Signature.addProvider("seal","server",ServerSeal);Signature.alert=plus.alert;var version=Signature.version={name:"1.0.20",code:100};root.Signature=Signature;"use strict";isIE8=!1;root.JSON&&(isIE8='{"x":"\u4e2d"}'!==root.JSON.stringify({x:"\u4e2d"}));Utils=kinggrid.Utils;var options=Signature.options;
Utils.extend(Signature.options.template,{signInfoBtl:'<div class="kg-dialog kg-dialog-info kg-dialog-signedinfo" id="kg-signedinfo"><%var modified = this.signModified;%><%var timeVerify = this.timeVerify;%><div class="kg-title success <%modified?"kg-hide":""%>"><i class="kg-icon"></i><span>\u68c0\u6d4b\u7ed3\u679c\uff1a\u7b7e\u540d\u6570\u636e\u9a8c\u8bc1\u6b63\u5e38\uff01</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><%timeVerify==true?"(\u65f6\u95f4\u6233\u53ef\u4fe1\u4efb)":"(\u65f6\u95f4\u6233\u4e0d\u53ef\u4fe1\u4efb)"%></span><%}%></div><div class="kg-title danger  <%modified?"":"kg-hide"%> "><i class="kg-icon"></i><span>\u68c0\u6d4b\u7ed3\u679c\uff1a\u7b7e\u540d\u6570\u636e\u88ab\u7be1\u6539\uff01</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><%timeVerify==true?"(\u65f6\u95f4\u6233\u53ef\u4fe1\u4efb)":"(\u65f6\u95f4\u6233\u4e0d\u53ef\u4fe1\u4efb)"%></span><%}%></div><div class="kg-content"><div class="kg-tab"><ul class="kg-nav clearfix"><li class="active"><a href="#" kg-target="certinfo">\u8bc1\u4e66\u4fe1\u606f</a></li></ul><%var certinfo = this.signatureData.signMeta.certinfo; %><div class="kg-tab-content"><div class="kg-tab-pane active certinfo"><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label">\u7248\u672c\uff1a</label><span class="kg-value">V<%certinfo.version%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5e8f\u53f7\uff1a</label><span class="kg-value"><%certinfo.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u540d\u7b97\u6cd5\uff1a</label><span class="kg-value"><%certinfo.algName%></span></div><div class="clearfix kg-item "><label class="kg-label">\u9881\u53d1\u8005\uff1a</label><span class="kg-value"><%certinfo.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label">\u4f7f\u7528\u8005\uff1a</label><span class="kg-value"><%certinfo.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label">\u6709\u6548\u671f\u4ece\uff1a</label><span class="kg-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notBefore) , "yyyy-MM-dd hh:mm:ss")%></span></div><div class="clearfix kg-item "><label class="kg-label">\u81f3\uff1a</label><span class="kg-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notAfter) , "yyyy-MM-dd hh:mm:ss")%></span></div></div></div></div></div></div></div>',signatureInfoBtl:'<div class="kg-dialog kg-dialog-info" id="kg-sigantureinfo"><%var modified = this.modified;%><%var timeVerify = this.timeVerify;%><%var sealType = Signature.options.sealType;%><div class="kg-title success <%modified?"kg-hide":""%>"><i class="kg-icon"></i><span>\u68c0\u6d4b\u7ed3\u679c\uff1a\u4fdd\u62a4\u6570\u636e\u6b63\u5e38\uff01</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><%timeVerify==true?"(\u65f6\u95f4\u6233\u53ef\u4fe1\u4efb)":"(\u65f6\u95f4\u6233\u4e0d\u53ef\u4fe1\u4efb)"%></span><%}%></div><div class="kg-title danger  <%modified?"":"kg-hide"%> "><i class="kg-icon"></i><span>\u68c0\u6d4b\u7ed3\u679c\uff1a\u4fdd\u62a4\u6570\u636e\u88ab\u7be1\u6539\uff01</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><%timeVerify==true?"(\u65f6\u95f4\u6233\u53ef\u4fe1\u4efb)":"(\u65f6\u95f4\u6233\u4e0d\u53ef\u4fe1\u4efb)"%></span><%}%></div><div class="kg-content"><div class="kg-tab"><ul class="kg-nav clearfix"><li class=" <% modified?"":"active"%> "><a href="#" kg-target="signatureinfo">\u7b7e\u7ae0\u4fe1\u606f</a></li><%if(modified){%><li class=" <% modified?"active":""%> " ><a href="#" kg-target="modifieditems">\u7be1\u6539\u4fe1\u606f</a></li><%}%></ul><div class="kg-tab-content"><div class="kg-tab-pane <% modified?"":"active"%> signatureinfo"><% var SDATA = this.signatureData; %><% var modifiedItems = this.modifiedItems; %><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label">\u5e94\u7528\u7a0b\u5e8f\uff1a</label><span class="kg-value"><%timeVerify%><%SDATA.appname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u6388\u6743\u5355\u4f4d\uff1a</label><span class="kg-value"><%SDATA.orgname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7528\u6237\u540d\u79f0\uff1a</label><span class="kg-value"><%SDATA.username%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5bc6\u94a5\u5e8f\u5217\uff1a</label><span class="kg-value"><%SDATA.keysn%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u540d\u79f0\uff1a</label><span class="kg-value"><%SDATA.seal.signname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u5e8f\u5217\uff1a</label><span class="kg-value"><%SDATA.seal.signsn%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u65e5\u671f\uff1a</label><span class="kg-value"><%SDATA.timestamp.signtime%></span></div><%if(sealType == "client" && SDATA.seal.headinfoex){%><div class="clearfix kg-item "><label class="kg-label">\u5236\u7ae0\u4eba\u540d\uff1a</label><span class="kg-value"><%SDATA.seal.headinfoex.sealProducer%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5236\u7ae0\u65e5\u671f\uff1a</label><span class="kg-value"><%SDATA.seal.headinfoex.sealMakingTime%></span></div><%}%></div></div><%if(modified){%><%var modifiedItems = this.modifiedItems;%><% for(var i=0;i<modifiedItems.length;i++) {%><% var item = modifiedItems[i]; %><div class="kg-tab-pane modifieditems <% modified?"active":""%> "><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label" kg-field="<%item.field%>"><%item.desc%>\u7531\uff1a</label><span class="kg-value"><%this["_renderValue"](this["html2Escape"](item.orivalue)) %></span></div><div class="clearfix kg-item "><label class="kg-label">\u66f4\u6539\u4e3a\uff1a</label><span class="kg-value"><%this["_renderValue"](this["html2Escape"](item.newvalue))%></span></div></div></div><%}%><%}%></div></div></div></div>',
handwritedlg:'<div class="kg-dialog kg-dialog-info" style="width:<%this.canvasWidth%>px;" id="kg-handwrite" unselectable="on" onselectstart="return false;" style="-moz-user-select:none;"><div class="kg-hw-content"><div class="kg-hw-info kg-hw-model">\u6a21\u5f0f:<select id="hw_model"><option value="0">\u624b\u5199\u7b7e\u540d</option><option value="1">\u6587\u5b57\u7b7e\u6279</option></select></div><div class="kg-hw-info kg-hw-name">\u540d\u79f0:<input type="text" value="\u624b\u5199\u7b7e\u6279" id="nameid" style="width:100px;"/></div><div class="kg-hw-info kg-hw-color">\u989c\u8272:<select id="hw_color"><option value="black">\u9ed1</option><option value="red">\u7ea2</option><option value="blue">\u84dd</option><option value="green">\u7eff</option></select></div><div class="kg-hw-info kg-hw-linewidth kg-hw-handwrite">\u7b14\u5bbd:<select id="hw_width"><% for(var i=1;i<=8;i++) {%><option value="<%i%>"><%i%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontFamily kg-hw-written">\u5b57\u4f53:<select id="hw_fontFamily"><% for(var i=0;i<this.fontFamily.length;i++) {%><option value="<%this.fontFamily[i].ename%>"><%this.fontFamily[i].zname%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontSize kg-hw-written"><select id="hw_fontSize"><% for(var i=20;i<=80;i+=4) {%><option value="<%i%>"<%i==24?"selected":""%>><%i%></option><%}%></select></div></div><div class="kg-hw-canvas" style="width:<%this.canvasWidth%>px;height:<%this.canvasHeight%>px;"><div id="kg-hw-span" class="kg-hw-written kg-hw-text-span" style="width:<%this.canvasWidth%>px;height:<%this.canvasHeight%>px;" ></div><textarea class="kg-hw-written kg-hw-text-edit" spellcheck="false" style="width:<%this.canvasWidth%>px;height:<%this.canvasHeight%>px;"></textarea><canvas id="canvasId" style="postion:absolute;top:0px;" width="670" height="500"></canvas></div><div id="div-judge" style="display: block;height:38px;style="width:<%this.canvasWidth%>px;"" align="center"><button type="button" id="clearid" class="kg-button">\u6e05\u9664</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" id="okid" class="kg-button">\u7b7e\u540d</button></div></div>',
barcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><label class="kg-label">\u4e8c\u7ef4\u7801\u5185\u5bb9\uff1a</label><textarea id="bcId"></textarea><br /><div id="output"><br /></div><div id="div-judge" style="display: block"><button type="button" id="bc_clearid" class="kg-button">\u6e05\u9664</button><button type="button" id="bc_okid" class="kg-button">\u786e\u5b9a</button></div></div>',scanBCdlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><div id="support"></div> <div id="contentHolder"><video id="video" width="320" height="320" autoplay></video><canvas style="display:none; background-color:#F00;" id="canvas_scanBC" width="320" height="320"></canvas> <br/> </div></div>'});
plus=kingPlus();var _borken,_borkenReq;
Signature.addLiseter("init",function(){aisleKing=Signature.aisleKing;for(var a=Signature.options.icons,b=0;b<a.length;++b){var c=a[b];switch(c.iconClass){case "kg-icon-move-":null!=Signature.options.icon_move_donot&&0==Signature.options.icon_move_donot&&(c.enable=!1);break;case "kg-icon-move":null!=Signature.options.icon_move&&0==Signature.options.icon_move&&(c.enable=!1);break;case "kg-icon-remove":null!=Signature.options.icon_remove&&0==Signature.options.icon_remove&&(c.enable=!1);break;case "kg-icon-sign":null!=
Signature.options.icon_sign&&0==Signature.options.icon_sign&&(c.enable=!1);break;case "kg-icon-signverify":null!=Signature.options.icon_signverify&&0==Signature.options.icon_signverify&&(c.enable=!1);break;case "kg-icon-sealinfo":null!=Signature.options.icon_sealinfo&&0==Signature.options.icon_sealinfo&&(c.enable=!1)}}});Signature.addLiseter("beforeVerify",function(){_borken=[];_borkenReq={signsn:[],sealImg:[]}});
Signature.addLiseter("eachVerify",function(a){a.broken&&(_borken.push(a),_borkenReq.signsn.push(a.signatureData.seal.signsn),_borkenReq.sealImg.push(a.signatureData.seal.imgdata))});
Signature.addLiseter("startMove",function(a,b,c){"client"==Signature.options.sealType&&Signature.options.moveable_self&&(b=kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode),Signature.options.fjrsIsphone&&(b.invoke("SetParamByName","FJRSISPHONE",Signature.options.fjrsIsphone),b.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken"))),b.invoke("KGGetKeyOtherInfo","0").ret(function(b){b.result?(b=
b.Res.substring(1,b.Res.length-1),a.keysn=b,a.keysn!=a.signatureData.keysn&&Signature.alert(kinggrid.msg("cannot_move","KG_MSG"))):Signature.alert(kinggrid.msg(b.errcode,"then"))}))});Signature.addLiseter("verify",function(){});var resizeSeal={},resizeTime;$(window).resize(function(){resizeTime&&clearTimeout(resizeTime);resizeTime=setTimeout(function(){for(var a in resizeSeal){var b=$(resizeSeal[a]),c=$(Utils.$(b.attr("elemid")));Signature.prototype.calSealPos.call(null,c,b)}},200)});
Utils.extend(Signature.prototype,{_init:function(){var a=this;a.on("showAt",function(a){Utils.$(a.getAttribute("elemid")).getAttribute("display")||(resizeSeal[a.id]=a)});a.on("removeAt",function(a){delete resizeSeal[a.id]});a.on("beforeShowAt",function(a){3960<this.signatureData.seal.imgdata.length&&isIE8&&(this.brokenImgDiv=a)});a.on("showAt",function(b){if(a.brokenImgDiv){var c=a.signatureData.seal,d=c.signsn;aisleKing&&(aisleKing=kinggrid.surry(Signature.options.serverUrl),aisleKing.request(a.imageUrl,
{signsn:d,sealImg:c.imgdata,sid:a.signatureid}).ret(function(c){c.result&&(c=c.imageUrl||a.imageUrl+"_",$(b).find(".kg-img").attr({src:Signature.options.serverUrl+c+"&a0=0&sid="+a.signatureid}),delete a.brokenImgDiv)}))}});a.on("showAt",function(b){b=$(b);if(void 0==Signature.options.image_sealinfo||1==Signature.options.image_sealinfo)if(0<=$().jquery.indexOf("1.4"))b.live("click",function(){var b=a._verify(null,{sucCall:function(){a.signatureInfo()}});void 0!==Signature.options.verifySignatureInfo&&
Signature.options.verifySignatureInfo&&Signature.options.verifySignatureInfo(a.modified,a.modifiedItems,a.signatureData)||null!=b&&a.signatureInfo()});else b.on("click",function(){var b=a._verify(null,{sucCall:function(){a.signatureInfo()}});void 0!==Signature.options.verifySignatureInfo&&Signature.options.verifySignatureInfo&&Signature.options.verifySignatureInfo(a.modified,a.modifiedItems,a.signatureData)||null!=b&&a.signatureInfo()});b.append('<div class="kgImgIcons kg-img-icons" ></div>')});a.on("handleImg",
function(b){var c=$(b);c.find(".kg-img-icon").remove();if(options.icons){c=c.children(".kg-img-icons");for(var d=options.icons.length-1;0<=d;d--){var e=options.icons[d];if(Utils.val(e.enable,a,b)){"doornotmove"==e.id&&(a.signatureData.moveable?(e.iconClass=e.iconClass.substring(0,13)+"not",e.title=kinggrid.msg("SignatureMoveNot","KG_TITLE"),e.value="0"):(e.iconClass=e.iconClass.substring(0,13)+"do",e.title=kinggrid.msg("SignatureMoveDo","KG_TITLE"),e.value="1"));if("moveSignature"==e.id&&!a.signatureData.moveable)break;
var f=$('<a href="#" title="'+e.title+'" class="kg-img-icon" id="kg-img-icon-'+e.id+"-"+this.signatureid+'"><i class="'+e.iconClass+'"></i></a>');e.value&&(f=$('<a href="#" title="'+e.title+'" class="kg-img-icon" id="kg-img-icon-'+e.id+"-"+this.signatureid+'" extval="'+e.value+'"><i class="'+e.iconClass+'"></i></a>'));c.append(f);e.exec&&e.exec.call(a,b);(function(b,c,d){f.click(function(c){c.imgDiv=b;d.call(a,c,b)})})(b,f,e.click||function(a){a.preventDefault();a.stopPropagation()})}}}})},signatureInfo:function(){this.html2Escape=
Utils.html2Escape;return this.showDialog("signatureInfoBtl",{target:this,onCancel:!1,onShow:function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call();var a=this.find(".kg-tab");this.tab=Utils.tab(a)}})},signInfo:function(){var a={title:kinggrid.msg("SignVerify","KG_TITLE"),target:this,onCancel:!1,onShow:function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()}};return this.showDialog("signInfoBtl",a)},handWriteDlg:function(a,b){a.canvas_height=
a.canvas_height||500;a.canvas_width=a.canvas_width||670;this.canvasWidth=a.canvas_width;this.canvasHeight=a.canvas_height;this.fontFamily=plus.fontFamily;var c={title:kinggrid.msg("HWSignature","KG_TITLE"),target:this,onCancel:!1},d=this.showDialog("handwritedlg",c);c=d.find("#canvasId")[0];if(c.getContext){var e=d.find(".kg-hw-text-span"),f=d.find(".kg-hw-text-edit"),g,k=new SignaturePad(c,a);d.find("#hw_width").val(a.lineSize||5);d.find("#hw_color").click(function(){var a=d.find("#hw_color").val();
k.setColor(a);e.css({color:a});f.css({color:a})});d.find("#hw_model").change(function(a){"0"==a.target.value?(d.find(".kg-hw-written").css({display:"none"}),d.find(".kg-hw-handwrite").css({display:"block"}),k.setWebHandWrite(g,{fontStyle:"normal",fontSize:e.css("font-size"),fontFamily:e.css("font-family"),fontColor:e.css("color")}),g=[],e.html(""),f.val("")):"1"==a.target.value&&(d.find(".kg-hw-handwrite").css({display:"none"}),d.find(".kg-hw-written").css({display:"block"}))});f.keyup(function(a){a=
Utils.convertText(this.value);e.html(a);parseFloat(f.css("line-height"))*a.split("<br>").length>parseFloat(f.css("height"))&&console.warn("\u6587\u5b57\u8d85\u8fc7\u9650\u5236");g=Utils.handleEdittable(e,a)});d.find("#hw_width").click(function(){var a=d.find("#hw_width").val();k.setSize(a)});d.find("#hw_fontFamily").change(function(a){e.css({"font-family":this.value});f.css({"font-family":this.value})});d.find("#hw_fontSize").change(function(a){e.css({"font-size":this.value+"px","line-height":6+1.2*
this.value+"px"});f.css({"font-size":this.value+"px","line-height":6+1.2*this.value+"px"});g=Utils.handleEdittable(e,e.html())});c=d.find("#clearid");var h=d.find("#okid");c.click(function(){k.clear()});h.click(function(){d.close();k.setWebHandWrite(g,{fontStyle:"normal",fontSize:e.css("font-size"),fontFamily:e.css("font-family"),fontColor:e.css("color")});k.toDataURL(function(c){if(c=c.replace(/^data:image\/\w+;base64,/,""))c={height:a.image_height||"5.00",width:a.image_width||"6.70",imageData:c,
name:d.find("#nameid").val()},b(c),d.remove()})});d.find(".ui-dialog-close").click(function(){d.close();a.onCancel&&a.onCancel.call()})}else d.close(),a.onError?a.onError.call():this.error({errcode:"11113"},"then")},fingerPrintsDevice:function(a,b){var c=this;kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("KGRunFingerPrints",a.device_type||"0",a.image_type||"gif","JSComServer","","").ret(function(d){if(d.result){var e=
d.FingerPrintsMap,f=parseFloat(254*d.ImageWidth/9600).toFixed(2);d=parseFloat(254*d.ImageHeight/9600).toFixed(2);b({width:a.image_height||f,height:a.image_width||d,imageData:e,name:"\u6307\u7eb9\u7b7e\u540d"})}else c.errorCallback(d,a.errorCall,"KGRunFingerPrints")})},handWriteDevice:function(a,b){var c=this;void 0!=a.copy_right&&null!=a.copy_right&&kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("KGRunHandWritten",
a.device_type||"0",a.copy_right,"JSComServer","","").ret(function(d){if(d.result){var e=d.HandWrittenValue,f=parseFloat(254*d.ImageWidth/9600).toFixed(2);d=parseFloat(254*d.ImageHeight/9600).toFixed(2);b({width:a.image_height||f,height:a.image_width||d,imageData:e,name:"\u624b\u5199\u7b7e\u540d"})}else c.errorCallback(d,a.errorCall,"KGRunHandWritten")})},eqpHandWriter:function(a,b){var c=this;void 0!=a.Value&&null!=a.Value&&kinggrid.surry(Signature.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1",
"4240FB41-A213-42B6-8CB5E6705C99B319",Signature.options.clientCode).invoke("KGEQPHandWriter",a.Value,a.DllName,"JSComServer").ret(function(d){if(d.result){var e=d.imagedata,f=parseFloat(254*d.imagewidth/9600).toFixed(2);d=parseFloat(254*d.imageheight/9600).toFixed(2);b({width:a.image_height||f,height:a.image_width||d,imageData:e,name:"\u624b\u5199\u5c4f\u7b7e\u540d"})}else c.errorCallback(d,a.errorCall,"KGEQPHandWriter")})},barCodeDlg:function(a,b){if(void 0!=a.content&&null!=a.content){var c=$("#output").qrcode(a.content);
b({height:a.image_height||"5",width:a.image_width||"5",imageData:c,name:"\u4e8c\u7ef4\u7801"})}},scanBCDlg:function(a,b){var c={title:kinggrid.msg("scanBCSignature","KG_TITLE"),target:this,onCancel:!1},d=this.showDialog("scanBCdlg",c);try{var e=document.getElementById("canvas_scanBC").getContext("2d"),f=document.getElementById("video");c={video:!0,audio:!1};var g=!0,k=function(a){g=!1;a.PERMISSION_DENIED?alert("\u7528\u6237\u62d2\u7edd\u4e86\u6d4f\u89c8\u5668\u8bf7\u6c42\u5a92\u4f53\u7684\u6743\u9650",
"\u63d0\u793a"):a.NOT_SUPPORTED_ERROR?alert("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u62cd\u7167\u529f\u80fd\uff0c\u8bf7\u4f7f\u7528\u5176\u4ed6\u6d4f\u89c8\u5668","\u63d0\u793a"):a.MANDATORY_UNSATISFIED_ERROR?alert("\u6307\u5b9a\u7684\u5a92\u4f53\u7c7b\u578b\u672a\u63a5\u6536\u5230\u5a92\u4f53\u6d41","\u63d0\u793a"):alert("\u7cfb\u7edf\u672a\u80fd\u83b7\u53d6\u5230\u6444\u50cf\u5934\uff0c\u8bf7\u786e\u4fdd\u6444\u50cf\u5934\u5df2\u6b63\u786e\u5b89\u88c5\u3002\u6216\u5c1d\u8bd5\u5237\u65b0\u9875\u9762\uff0c\u91cd\u8bd5",
"\u63d0\u793a")};if(navigator.getUserMedia){if(-1<navigator.userAgent.indexOf("MQQBrowser"))return alert("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u62cd\u7167\u529f\u80fd\uff0c\u8bf7\u4f7f\u7528\u5176\u4ed6\u6d4f\u89c8\u5668","\u63d0\u793a"),!1;navigator.getUserMedia(c,function(a){f.src=a;f.play()},k)}else if(navigator.webkitGetUserMedia)navigator.webkitGetUserMedia(c,function(a){f.src=window.webkitURL.createObjectURL(a);f.play()},k);else if(navigator.mozGetUserMedia)navigator.mozGetUserMedia(c,
function(a){f.src=window.URL.createObjectURL(a);f.play()},k);else if(navigator.msGetUserMedia)navigator.msGetUserMedia(c,function(a){$(document).scrollTop($(window).height());f.src=window.URL.createObjectURL(a);f.play()},k);else return alert("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u62cd\u7167\u529f\u80fd\uff0c\u8bf7\u4f7f\u7528\u5176\u4ed6\u6d4f\u89c8\u5668"),!1;g&&alert("\u4e3a\u4e86\u83b7\u5f97\u66f4\u51c6\u786e\u7684\u6d4b\u8bd5\u7ed3\u679c\uff0c\u8bf7\u5c3d\u91cf\u5c06\u4e8c\u7ef4\u7801\u7f6e\u4e8e\u6846\u4e2d\uff0c\u7136\u540e\u8fdb\u884c\u62cd\u6444\u3001\u626b\u63cf\u3002 \u8bf7\u786e\u4fdd\u6d4f\u89c8\u5668\u6709\u6743\u9650\u4f7f\u7528\u6444\u50cf\u529f\u80fd");
var h=setTimeout(function(){e&&(e.drawImage(f,0,0,320,320),$("#contentHolder").html5_qrcode(function(c){$("#read").html(c);d.close();alert(c);a.content=c;barCodeDlg(a,b);window.clearInterval(h)},function(a){$("#read_error").html(a);d.close();window.clearInterval(h)},function(a){$("#vid_error").html(a);d.close();window.clearInterval(h)}))},200)}catch(m){printHtml("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301HTML5 CANVAS")}}});
Signature.addIcon({iconClass:"kg-icon-move",title:kinggrid.msg("moveSignature","KG_TITLE"),id:"moveSignature",enable:function(a){return this.canMove(a)},exec:function(a){var b=this;(function(a,d){0<=$().jquery.indexOf("1.4")?($(d).live("touchstart mousedown",".kg-icon-move",function(c){a&&b.runMove(c,d)}),$(d).live("touchstart mouseover",".kg-icon-move",function(b){void 0!==Signature.options.extra&&(b=d.attributes.signatureid.nodeValue)&&void 0!==Signature.options.extra[b]&&Signature.options.extra[b].icon_move&&
(a=Signature.options.extra[b].icon_move())})):($(d).on("touchstart mousedown",".kg-icon-move",function(c){a&&b.runMove(c,d)}),$(d).on("touchstart mouseover",".kg-icon-move",function(b){void 0!==Signature.options.extra&&(b=d.attributes.signatureid.nodeValue)&&void 0!==Signature.options.extra[b]&&Signature.options.extra[b].icon_move&&(a=Signature.options.extra[b].icon_move())}))})(!0,a)}});
Signature.addIcon({iconClass:"kg-icon-move-",title:kinggrid.msg("SignatureMoveNot","KG_TITLE"),id:"doornotmove",enable:!0,click:function(a){var b=this;a.preventDefault();a.stopPropagation();var c=a.target.parentElement,d=function(a){$(a).attr("extval")&&"0"==$(a).attr("extval")?b.changeMoveAble(!1):b.changeMoveAble(!0)};b.signatureData.html2?b.error({errcode:"11112"},"then"):"server"==Signature.options.sealType?Signature.options.keysn==b.signatureData.keysn?d(c):b.error({errcode:"11111"},"then"):
"client"==Signature.options.sealType&&b.sealService.getKeysn({},function(a){a==b.signatureData.keysn?d(c):b.error({errcode:"11111"},"then")})}});Signature.addIcon({iconClass:"kg-icon-remove",title:kinggrid.msg("RevokeSignature","KG_TITLE"),id:"revokeSignature",enable:function(){return this.canDelete()},click:function(a){a.preventDefault();a.stopPropagation();this.revokeSignature()}});
Signature.addIcon({iconClass:"kg-icon-sign",title:kinggrid.msg("SignSignature","KG_TITLE"),id:"sign",enable:function(){return this.canSign()},click:function(a){a.preventDefault();a.stopPropagation();a=this._verify(null,{sucCall:function(){this.signSignature()}});null!=a&&(a?this.signSignature():Signature.alert(kinggrid.msg("invalid_signdata","KG_MSG"),function(){Signature.options.beginDlgOkCall&&Signature.options.beginDlgOkCall.call()},function(){Signature.options.beginDlgShowCall&&Signature.options.beginDlgShowCall.call()}))}});
Signature.addIcon({iconClass:"kg-icon-signverify",title:kinggrid.msg("SignVerify","KG_TITLE"),id:"verifysign",enable:function(){return this.signatureData.signMeta},click:function(a){a.preventDefault();a.stopPropagation();var b=this;b.verifySignData(function(a){a.errcode?b.error(a):b.signInfo()})}});
Signature.addIcon({iconClass:"kg-icon-sealinfo",title:kinggrid.msg("SignatureVerify","KG_TITLE"),id:"signatureInfo",enable:!0,click:function(a){a.preventDefault();a.stopPropagation();a=this._verify(null,{sucCall:function(){this.signatureInfo()}});void 0!==Signature.options.verifySignatureInfo&&Signature.options.verifySignatureInfo&&Signature.options.verifySignatureInfo(this.modified,this.modifiedItems,this.signatureData)||null!=a&&this.signatureInfo()}});
var getsec=function(a){var b=1*a.substring(1,a.length);a=a.substring(0,1);if("s"==a)return 1E3*b;if("h"==a)return 36E5*b;if("d"==a)return 864E5*b},setCookie=function(a,b,c){c=getsec(c);var d=new Date;d.setTime(d.getTime()+1*c);document.cookie=a+"="+escape(b)+";expires="+d.toGMTString()},getCookie=function(a){var b;return(b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(b[2]):null},delCookie=function(a){var b=new Date;b.setTime(b.getTime()-1);var c=getCookie(a);null!=c&&(document.cookie=
a+"="+c+";expires="+b.toGMTString())};Signature.prototype.onshowSealsDialog_PW=function(a){var b=this.keysn||this.keyData.keysn;"true"==getCookie("ck")&&a.find("#kg-remenberPwd").attr("checked","checked");if(a.find("#kg-remenberPwd").is(":checked")){var c=getCookie("ksn");b==c&&(a=a.find("#kg-password"),b=getCookie("pwd"),Signature.options.pw_enc_save&&(b=Utils.Base64.of().decode(b)),null!=b?a.val(b):a.val("123"))}};
Signature.prototype.onexecSuccess=function(a,b,c){var d=this.keysn||this.keyData.keysn;if(c){var e=getCookie("ksn");a=Signature.options.pw_timeout;c=function(a){if(d!=e){if("undefined"==typeof a||0>a.indexOf("s")&&0>a.indexOf("h")&&0>a.indexOf("d"))a="s1800";Signature.options.pw_enc_save&&(b=Utils.Base64.of().encode(b));setCookie("ksn",d,a);setCookie("pwd",b,a);setCookie("ck","true",a)}};Signature.options.pw_server_timeout?this.sealService.getPwdSaveTime(c,a):c(a)}else Signature.options.pwd_clear_flag||
(delCookie("ksn"),delCookie("pwd"),delCookie("ck"))};Signature.prototype.ongetRPW=function(a){if(getCookie("ksn")==a)return a=getCookie("pwd"),Signature.options.pw_enc_save&&(a=Utils.Base64.of().decode(a)),a};Signature.prototype.onDeleteRPW=function(){delCookie("ksn");delCookie("pwd");delCookie("ck")};
var SignaturePad=function(a){function b(b,c){function d(a){0>a.type.indexOf("mouse")&&(t=!0);return a}function e(a){a=d(a||window.event);if((a.stopPropagation(),"mousedown"!=a.type&&"touchstart"!=a.type)||$(a.srcElement)[0].id!=l.canvasName||t&&1<a.touches.length)return 0;if(1===a.which||t&&1==a.touches.length)y=!0,"svg"!=l.writeType&&(r.fillStyle=F,r.globalAlpha=O),v=a=D(t?a.touches[0]:a),B.unshift({time:(new Date).getTime(),dis:0,x:a.x,y:a.y}),u&&(x={top:a.y,right:a.x,bottom:a.y,left:a.x},u=!1),
a=B,h(a),k(a);"function"==typeof l.touchstartCallback&&l.touchstartCallback()}function k(a){if(!(1>=a.length)){var b,c,d,e,f,g,n,k,m;2>=a.length?(b=a[1].x,e=a[1].y,d=a[1].x+.5*(a[0].x-a[1].x),g=a[1].y+.5*(a[0].y-a[1].y),c=b+.5*(d-b),f=e+.5*(g-e),n=a[1].r,m=a[1].r+.5*(a[0].r-a[1].r)):(b=a[2].x+.5*(a[1].x-a[2].x),e=a[2].y+.5*(a[1].y-a[2].y),c=a[1].x,f=a[1].y,d=c+.5*(a[0].x-c),g=f+.5*(a[0].y-f),n=a[2].r+.5*(a[1].r-a[2].r),k=a[1].r,m=k+.5*(a[0].r-k));var h=[];for(a=0;5>a;a++){var q=a/4;k=(1-q)*(1-q)*
b+2*q*(1-q)*c+q*q*d;q=(1-q)*(1-q)*e+2*q*(1-q)*f+q*q*g;var x=n+(m-n)/5*a;if(h.push({x:k,y:q,r:x}),3==h.length){var p=h[0].x;var A=h[0].y;var I=h[0].r;var E=h[1].x,N=h[1].y,t=h[2].x,y=h[2].y;var u=h[2].r;h=[];var w=E-p;var z=N-A;var v=2*Math.sqrt(w*w+z*z+1E-4);w=w/v*I;var B=z=z/v*I;var C=-w;var D=E-t;I=N-y;v=2*Math.sqrt(D*D+I*I+1E-4);D=D/v*u;I=I/v*u;u=-I;v=D;h.push({mx:p+B,my:A+C,color:"#1A1A1A"});h.push({c1x:E+B,c1y:N+C,c2x:E+u,c2y:N+v,ex:t+u,ey:y+v});h.push({c1x:t+u-D,c1y:y+v-I,c2x:t-u-D,c2y:y-v-
I,ex:t-u,ey:y-v});h.push({c1x:E-u,c1y:N-v,c2x:E-B,c2y:N-C,ex:p-B,ey:A-C});h.push({c1x:p-B-w,c1y:A-C-z,c2x:p+B-w,c2y:A+C-z,ex:p+B,ey:A+C});h[0].mx=h[0].mx.toFixed(1);h[0].mx=parseFloat(h[0].mx);h[0].my=h[0].my.toFixed(1);h[0].my=parseFloat(h[0].my);for(p=1;p<h.length;p++)h[p].c1x=h[p].c1x.toFixed(1),h[p].c1x=parseFloat(h[p].c1x),h[p].c1y=h[p].c1y.toFixed(1),h[p].c1y=parseFloat(h[p].c1y),h[p].c2x=h[p].c2x.toFixed(1),h[p].c2x=parseFloat(h[p].c2x),h[p].c2y=h[p].c2y.toFixed(1),h[p].c2y=parseFloat(h[p].c2y),
h[p].ex=h[p].ex.toFixed(1),h[p].ex=parseFloat(h[p].ex),h[p].ey=h[p].ey.toFixed(1),h[p].ey=parseFloat(h[p].ey);p=h;p[0].color=F;l.bethelPoint.push(p);A=void 0;if("svg"==l.writeType){void 0===A&&(A=p[0].color);E="M "+p[0].mx+" "+p[0].my+" C";for(N=1;N<p.length;N++)E+=" "+p[N].c1x+" "+p[N].c1y,E+=" "+p[N].c2x+" "+p[N].c2y,E+=" "+p[N].ex+" "+p[N].ey;G.path(E).attr("stroke",A).attr("stroke-width",1).attr("fill",A)}else{r.beginPath();r.moveTo(p[0].mx,p[0].my);void 0!=A?(r.fillStyle=A,r.strokeStyle=A):(r.fillStyle=
p[0].color,r.strokeStyle=p[0].color);for(A=1;A<p.length;A++)r.bezierCurveTo(p[A].c1x,p[A].c1y,p[A].c2x,p[A].c2y,p[A].ex,p[A].ey);r.stroke();r.fill()}h=[{x:k,y:q,r:x}]}}}}function h(a){if(1>=a.length)return void(a[0].r=1);for(var b=(l.distance({x:a[0].x,y:a[0].y},{x:a[1].x,y:a[1].y}),0),c=0,d=0;d<a.length-1&&(b+=a[d].dis,c+=a[d].time-a[d+1].time,!(b>L));d++);a[0].r=Math.min(c/(1*b)*l.pressure+l.lineMin,l.lineMax)*K}function m(a){return a=a.toFixed(4),parseFloat(a)}function q(a){if(/^(rgb|RGB)/.test(a)){for(var b=
a.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),c="#",d=0;d<b.length;d++){var e=Number(b[d]).toString(16);2>e.length&&(e="0"+e);c+=e}return 7!==c.length&&(c=a),c}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(a)){b=a.replace(/#/,"").split("");if(6===b.length)return a;if(3===b.length)for(a="#",d=0;d<b.length;d+=1)a+=b[d]+b[d]}return a}var y=!1,t;this.writeType="canvas";this.canvasName=b;this.lineMin=.5;this.lineMax=2;this.pressure=1;this.linePrack=[];this.chirography=[];this.currentChirography={};this.transformpdfData=
[];this.canvasHeight=this.canvasWidth=0;this.currentBethelLinePoint=[];this.bethelPoint=[];var w=null,J=null,r=null,G=null,O=1,F="#1A1A1A",K=1.5,L=100,C=0,v={},B=[],z=2,H=2,u=!0,x={top:0,right:0,bottom:0,left:0},l=this;this.clearCanvasCallback=this.touchendCallback=this.touchmoveCallback=this.touchstartCallback="";this.init=function(b,c,d,f){l.writeType="canvas";l.canvas=a.getElementById(l.canvasName);r=l.canvas.getContext("2d");r.rotate(45*Math.PI/180);r.fillStyle="rgba(0,0,0,1)";var g=l.canvas;
void 0==b&&(b=720);void 0==c&&(c=1280);void 0==d&&(d=720);void 0==f&&(f=1280);z=d/b;H=f/c;$(g).width(b);$(g).attr("width",d);$(g).height(c);$(g).attr("height",f);l.canvasWidth=d;l.canvasHeight=f;a.getElementById(l.canvasName).addEventListener("mousedown",e,!1);a.getElementById(l.canvasName).addEventListener("mousemove",P,!1);a.getElementById(l.canvasName).addEventListener("mouseup",R,!1);a.getElementById(l.canvasName).addEventListener("touchstart",e,!1);a.getElementById(l.canvasName).addEventListener("touchmove",
P,!1);a.getElementById(l.canvasName).addEventListener("touchend",R,!1);a.getElementById(l.canvasName).addEventListener("touchcancel",U,!1)};this.initSVG=function(b,c,d,f){l.writeType="svg";void 0==b&&(b=720);void 0==c&&(c=1280);void 0==d&&(d=720);void 0==f&&(f=1280);z=d/b;H=f/c;l.canvas=a.getElementById(l.canvasName);G=new Snap(l.canvas);G.attr({width:b,height:c,viewBox:"0, 0, "+d+", "+f});a.getElementById(l.canvasName).addEventListener("mousedown",e,!1);a.getElementById(l.canvasName).addEventListener("mousemove",
P,!1);a.getElementById(l.canvasName).addEventListener("mouseup",R,!1);a.getElementById(l.canvasName).addEventListener("touchstart",e,!1);a.getElementById(l.canvasName).addEventListener("touchmove",P,!1);a.getElementById(l.canvasName).addEventListener("touchend",R,!1);a.getElementById(l.canvasName).addEventListener("touchcancel",U,!1)};this.newCanvas=function(b,c,d,e,f){var g=this.canvas,n=$(g)[0].id;n=a.getElementById(n).getContext("2d");var k=n.getImageData(0,0,g.width,g.height);void 0==b&&(b=720);
void 0==c&&(c=1280);void 0==d&&(d=720);void 0==e&&(e=1280);z=d/b;H=e/c;$(g).width(b);$(g).attr("width",d);$(g).height(c);$(g).attr("height",e);l.canvasWidth=d;l.canvasHeight=e;b=parseInt(g.width*(1-1/f));g.height;console.log(b);n.putImageData(k,parseInt(b),0)};this.setCanvasSize=function(a,b,c,d,e,f){void 0==a&&(a=this.width);void 0==b&&(b=this.height);void 0==innerWidth&&(innerWidth=this.innverWidth);void 0==innerHeight&&(innerHeight=this.innerheight);c=r.getImageData(0,0,this.innerWidth,this.innerHeight);
z=innerWidth/a;H=innerHeight/b;$(this.canvas).width(a);$(this.canvas).attr("width",innerWidth);$(this.canvas).height(b);$(this.canvas).attr("height",innerHeight);this.canvasWidth=innerWidth;this.canvasHeight=innerHeight;r.putImageData(c,0,0)};this.setLineColor=function(a){F=a};this.setLineSize=function(a){K=a};this.setSmoothness=function(a){L=a};this.setLineMin=function(a){this.lineMin=a};this.setLineMax=function(a){this.lineMax=a};this.showAllSign=function(b){var c=$(this.canvas)[0].id;c=a.getElementById(c);
var d=c.getContext("2d");b=parseFloat(1/b);d.scale(b,b);b=new Image;return b.src=c.toDataURL("image/png"),b};var P=function(a){a=a||window.event;if((l.touchmoveCallback&&l.touchmoveCallback(),"mousemove"!=a.type&&"touchmove"!=a.type)||$(a.srcElement)[0].id!=l.canvasName)return 0;if(t&&1<a.touches.length)return a.stopPropagation(),a.preventDefault(),a.cancelable&&(a.defaultPrevented||a.preventDefault()),0;if(y||t&&1==a.touches.length)a.cancelable&&(a.defaultPrevented||a.preventDefault()),a=D(t?a.touches[0]:
a),a.y<x.top&&(x.top=a.y),0>a.y&&(x.top=0),a.x>x.right&&(x.right=a.x),0>=l.canvasWidth-a.x&&(x.right=l.canvasWidth),a.y>x.bottom&&(x.bottom=a.y),0>=l.canvasHeight-a.y&&(x.bottom=l.canvasHeight),a.x<x.left&&(x.left=a.x),0>a.x&&(x.left=0),C=v,v=a,B.unshift({time:(new Date).getTime(),dis:l.distance(v,C),x:a.x,y:a.y}),a=B,h(a),k(a);"function"==typeof l.touchmoveCallback&&l.touchmoveCallback()},R=function(a){a=d(a||window.event);if((a.stopPropagation(),"mouseup"!=a.type&&"touchend"!=a.type)||$(a.srcElement)[0].id!=
l.canvasName)return 0;if(1===a.which&&y||t&&!(1<a.touches.length)){y=!1;a=D(t?a.changedTouches[0]:a);if(C=v,v=a,B.unshift({time:(new Date).getTime(),dis:l.distance(v,C),x:a.x,y:a.y}),2<B.length)B[0].time,B[B.length-1].time,B.length;"canvas"==l.writeType?(a=B,h(a),k(a),l.chirography.unshift({lineSize:K,lineColor:F}),l.linePrack.unshift(B)):l.overlapInCanvas(B);B=[];"function"==typeof l.touchendCallback&&l.touchendCallback()}},U=function(a){a=d(a||window.event);a.type},D=function(a){if(null==w||null==
l.offsetTop)if("svg"==l.writeType)w=$(l.canvas).offset().left,J=$(l.canvas).offset().top;else{var b=0;w=l.canvas.offsetLeft;J=l.canvas.offsetTop;for(var c=l.canvas.parentNode;100>b&&c.tagName&&"BODY"!=c.tagName;)w+=c.offsetLeft,J+=c.offsetTop,c=c.parentNode,b++}b=a.clientX-w;a=a.clientY-J+140;b*=z;a*=H;return{x:b,y:a}};this.distance=function(a,b){var c=b.x-a.x;a=b.y-a.y;return Math.sqrt(c*c+a*a)};this.reWriteCanvas=function(){r.restore()};this.writeCanvas=function(){l.clearCanvas();for(var a=0;a<
l.linePrack.length;a++){var b=l.linePrack[l.linePrack.length-a-1],c=[];r.fillStyle=l.chirography[l.chirography.length-a-1].lineColor;K=l.chirography[l.chirography.length-a-1].lineSize;F=l.chirography[l.chirography.length-a-1].lineColor;for(var d=0;d<b.length;d++){c.unshift(b[b.length-d-1]);var e=c;h(e);k(e)}}return!0};this.clearCanvas=function(){"function"==typeof l.clearCanvasCallback&&l.clearCanvasCallback();r&&r.clearRect(0,0,l.canvas.width,l.canvas.height);G&&G.clear()};this.clearCanvasAndData=
function(){l.clearCanvas();l.linePrack=[];l.chirography=[];l.bethelPoint=[];u=!0};this.overlapInCanvas=function(a){a=a[0];for(var b=0;b<l.linePrack.length;b++)for(var c=l.linePrack[b],d=0;d<c.length;d++)if(400>(a.x-c[d].x)*(a.x-c[d].x)+(a.y-c[d].y)*(a.y-c[d].y)){l.linePrack.splice(b,1);l.chirography.splice(b,1);l.writeCanvas();break}};this.overlapLine=function(a,b,c,d){r.isPointInPath(20,50)};this.saveImage=function(){return this.canvas.toDataURL.apply(this.canvas,arguments)};this.coordinateSystem=
function(a,b){return{x:a,y:b}};this.transformpdf=function(){for(var a=this.linePrack,b=0;b<a.length;b++){var c=a[b];if(!(2>c.length)){var d,e=c.length;var f=1*c[e-1].x+.1;var g=1*c[e-1].y;var k=c[e-1].r;var h=1*c[e-2].x+.1;var m=1*c[e-2].y;var q=c[e-2].r;var r=h-f;var t=m-g;var p=2*Math.sqrt(r*r+t*t+1E-4);r=r/p*k;var A=t=t/p*k;var I=-r;var E=[];for(d=3;d<=c.length;d++){var N=1*c[e-d].x;var x=1*c[e-d].y;var y=c[e-d].r;k=(h+N)/2;var v=(m+x)/2;q=(q+y)/2;var u=h-k;var w=m-v;p=2*Math.sqrt(u*u+w*w+1E-4);
u=u/p*q;w=w/p*q;p=-w;var z=u;E[0]=l.coordinateSystem(f+A,g+I);E[1]=l.coordinateSystem(h+A,m+I);E[2]=l.coordinateSystem(h+p,m+z);E[3]=l.coordinateSystem(k+p,v+z);E[4]=l.coordinateSystem(k+p-u,v+z-w);E[5]=l.coordinateSystem(k-p-u,v-z-w);E[6]=l.coordinateSystem(k-p,v-z);E[7]=l.coordinateSystem(h-p,m-z);E[8]=l.coordinateSystem(h-A,m-I);E[9]=l.coordinateSystem(f-A,g-I);E[10]=l.coordinateSystem(f-A-r,g-I-t);E[11]=l.coordinateSystem(f+A-r,g+I-t);E[12]=l.coordinateSystem(f+A,g+I);f=k;g=v;h=N;m=x;q=y;r=-u;
t=-w;A=p;I=z;l.transformpdfData.push(E)}E[0]=l.coordinateSystem(f+A,g+I);E[0]=l.coordinateSystem(f+A,g+I)}}};this.getExtrema=function(){x={top:this.canvasHeight*H,right:0,bottom:0,left:this.canvasWidth*z};for(var a=0;a<this.linePrack.length;a++)for(var b=0;b<this.linePrack[a].length;b++)this.linePrack[a][b].y<x.top&&(x.top=this.linePrack[a][b].y),this.linePrack[a][b].y>x.bottom&&(x.bottom=this.linePrack[a][b].y),this.linePrack[a][b].x>x.right&&(x.right=this.linePrack[a][b].x),this.linePrack[a][b].x<
x.left&&(x.left=this.linePrack[a][b].x)};var S=function(a,b,c,d,e){return{x:a*Math.cos(c)-b*Math.sin(c)+d,y:a*Math.sin(c)+b*Math.cos(c)+e}};this.calcRotateCanvasInfo=function(){for(var a,b,c,d,e=[],f=[],g=x.bottom-x.top+60,k=x.right-x.left+60,h=0;h<this.linePrack.length;h++){e[h]=[];f[h]={lineSize:this.chirography[h].lineSize,lineColor:this.chirography[h].lineColor};for(var l=0;l<this.linePrack[h].length;l++)a=this.linePrack[h][l].x-x.left+30,b=this.linePrack[h][l].y-x.top+30,c=-Math.PI/2,d=x.right-
x.left+60,a=S(a,b,c,0,d),e[h][l]={x:m(a.x),y:m(a.y),dis:this.linePrack[h][l].dis,time:this.linePrack[h][l].time,r:this.linePrack[h][l].r}}return{canvasWidth:g/z,canvasHeight:k/H,canvasInnerWidth:g,canvasInnerHeight:k,linePrack:e,chirography:f,bethelPoint:this.bethelPoint}};this.destory=function(){};this.centreRotate=function(a){for(var b,c=-(Math.min(l.canvasWidth*Math.cos(a),0)+Math.min(l.canvasHeight*Math.cos(a+Math.PI/2),0)),d=-(Math.min(l.canvasWidth*Math.sin(a),0)+Math.min(l.canvasHeight*Math.sin(a+
Math.PI/2),0)),e=0;e<l.bethelPoint.length;e++){b=S(l.bethelPoint[e][0].mx,l.bethelPoint[e][0].my,a,c,d);l.bethelPoint[e][0].mx=b.x;l.bethelPoint[e][0].my=b.y;for(var f=1;f<l.bethelPoint[e].length;f++)b=S(l.bethelPoint[e][f].c1x,l.bethelPoint[e][f].c1y,a,c,d),l.bethelPoint[e][f].c1x=b.x,l.bethelPoint[e][f].c1y=b.y,b=S(l.bethelPoint[e][f].c2x,l.bethelPoint[e][f].c2y,a,c,d),l.bethelPoint[e][f].c2x=b.x,l.bethelPoint[e][f].c2y=b.y,b=S(l.bethelPoint[e][f].ex,l.bethelPoint[e][f].ey,a,c,d),l.bethelPoint[e][f].ex=
b.x,l.bethelPoint[e][f].ey=b.y}b=Math.abs(l.canvasWidth*Math.sin(a))+Math.abs(l.canvasHeight*Math.sin(a+Math.PI/2));l.canvasWidth=Math.abs(l.canvasWidth*Math.cos(a))+Math.abs(l.canvasHeight*Math.cos(a+Math.PI/2));l.canvasHeight=b};this.toSVG=function(a){a=a?new Snap(a):new Snap;for(var b=0;b<this.bethelPoint.length;b++){for(var c="M "+m(this.bethelPoint[b][0].mx/this.canvasHeight)+" "+m(this.bethelPoint[b][0].my/this.canvasHeight)+" C",d=1;d<this.bethelPoint[b].length;d++)c+=" "+m(this.bethelPoint[b][d].c1x/
this.canvasHeight)+" "+m(this.bethelPoint[b][d].c1y/this.canvasHeight),c+=" "+m(this.bethelPoint[b][d].c2x/this.canvasHeight)+" "+m(this.bethelPoint[b][d].c2y/this.canvasHeight),c+=" "+m(this.bethelPoint[b][d].ex/this.canvasHeight)+" "+m(this.bethelPoint[b][d].ey/this.canvasHeight);a.path(c).attr("stroke",this.bethelPoint[b][0].color).attr("stroke-width",1/this.canvasHeight).attr("fill",this.bethelPoint[b][0].color)}b="0 0 "+m(this.canvasWidth/this.canvasHeight)+" 1";return a.attr("viewBox",b),a.attr("width",
m(this.canvasWidth/this.canvasHeight)+"px"),a.attr("height","1px"),a.outerSVG()};this.toCommonSVG=function(a){a=a?new Snap(a):new Snap;for(var b=0;b<l.bethelPoint.length;b++){for(var c="M "+m(l.bethelPoint[b][0].mx)+" "+m(l.bethelPoint[b][0].my)+" C",d=1;d<l.bethelPoint[b].length;d++)c+=" "+m(l.bethelPoint[b][d].c1x)+" "+m(l.bethelPoint[b][d].c1y),c+=" "+m(l.bethelPoint[b][d].c2x)+" "+m(l.bethelPoint[b][d].c2y),c+=" "+m(l.bethelPoint[b][d].ex)+" "+m(l.bethelPoint[b][d].ey);a.path(c).attr("stroke",
l.bethelPoint[b][0].color).attr("stroke-width",1).attr("fill",l.bethelPoint[b][0].color)}return a.attr("viewBox","0 0 "+l.canvasWidth+" "+l.canvasHeight),a.attr("width",l.canvasWidth+"px"),a.attr("height",l.canvasHeight+"px"),a.outerSVG()};this.pathToSVG=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=$("body").width(),d=$("body").height();if(1==b){b="svg"+Math.floor(1E4*Math.random());var e=$("<svg id="+b+"></svg>");e.css("position","fixed");$("body").prepend(e);b=new Snap("#"+
b);b.attr("width",c+"px");b.attr("height",d+"px");for(e=0;e<a.length;e++){for(var f="M "+m(a[e][0].mx*c)+" "+m((1-a[e][0].my)*d)+" C",g=1;g<a[e].length;g++)f+=" "+m(a[e][g].c1x*c)+" "+m((1-a[e][g].c1y)*d),f+=" "+m(a[e][g].c2x*c)+" "+m((1-a[e][g].c2y)*d),f+=" "+m(a[e][g].ex*c)+" "+m((1-a[e][g].ey)*d);b.path(f).attr("stroke",a[e][0].color).attr("stroke-width",1).attr("fill","none")}}else Object.keys(a).forEach(function(b){b=a[b];for(var e=0;e<b.length;e++){var f="svg"+e+Math.floor(1E4*Math.random()),
g=$("<svg id="+f+"></svg>");g.css("position","fixed");$("body").prepend(g);f="#"+f;f=new Snap(f);f.attr("width",c+"px");f.attr("height",d+"px");for(g=0;g<b[e].length;g++){for(var k="M "+b[e][g][0].mx*c+" "+(1-b[e][g][0].my)*d+" C",h=1;h<b[e][g].length;h++)k+=" "+b[e][g][h].c1x*c+" "+(1-b[e][g][h].c1y)*d,k+=" "+b[e][g][h].c2x*c+" "+(1-b[e][g][h].c2y)*d,k+=" "+b[e][g][h].ex*c+" "+(1-b[e][g][h].ey)*d;f.path(k).attr("stroke",b[e][g][0].color).attr("stroke-width",1).attr("fill",b[e][g][0].color)}}})};
this.SVGToPath=function(a,b,c,d,e,f,g,k,h,l){if(void 0===a||void 0===b||void 0===c||void 0===d||void 0===e||void 0===f||void 0===g)return void console.log("\u53c2\u6570\u7f3a\u5931");b=new Snap(b);var n=[];if(void 0===k||void 0===h||void 0===l){var r=parseFloat(b.attr("height"));k=parseFloat(b.getBBox().width);h=parseFloat(b.getBBox().height);l=r/h}var t="";return b.selectAll("path").forEach(function(a){for(var b,c=a.attr("d").split(" "),k=[],h=0;h<c.length;h++)b=c[h].split(","),2==b.length?(k.push(b[0]),
k.push(b[1])):k.push(b[0]);b=[];for(h=0;h<k.length;h++){c=k[h];if(isNaN(parseInt(c.slice(0,1)))){if(t=c.slice(0,1),1==k[h].length&&"Z"!=t)continue;c=c.slice(1)}switch(t){case "M":var p=k[h+1];h++;var r=a.attr("stroke");r="none"==r?"#000000":q(r);console.log(m(1-(parseFloat(p)*l+g)/e));b.push({mx:m(parseFloat(c)*l/d+f/d),my:m(1-(parseFloat(p)*l+g)/e),color:r});break;case "Q":b.push({c1x:m(parseFloat(c)*l/d+f/d),c1y:m(1-(parseFloat(k[h+1])*l+g)/e),c2x:m(parseFloat(c)*l/d+f/d),c2y:m(1-(parseFloat(k[h+
1])*l+g)/e),ex:m(parseFloat(k[h+2])*l/d+f/d),ey:m(1-(parseFloat(k[h+3])*l+g/e))});h+=3;break;case "C":b.push({c1x:m(parseFloat(c)*l/d+f/d),c1y:m(1-(parseFloat(k[h+1])*l+g)/e),c2x:m(parseFloat(k[h+2])*l/d+f/d),c2y:m(1-(parseFloat(k[h+3])*l+g)/e),ex:m(parseFloat(k[h+4])*l/d+f/d),ey:m(1-(parseFloat(k[h+5])*l+g)/e)});h+=5;break;case "L":b.push({c1x:m(parseFloat(c)*l/d+f/d),c1y:m(1-(parseFloat(k[h+1])*l+g)/e),c2x:m(parseFloat(c)*l/d+f/d),c2y:m(1-(parseFloat(k[h+1])*l+g)/e),ex:m(parseFloat(c)*l/d+f/d),
ey:m(1-(parseFloat(k[h+1])*l+g)/e)});h++;break;case "Z":n.push(b),b=[]}}b.length&&n.push(b)}),void 0===a[c]&&(a[c]=[]),a[c].push(n),a};this.SVGToPathNoPage=function(a,b,c,d,e,f,g,h){if(void 0===a||void 0===b||void 0===c||void 0===d||void 0===e)return void console.log("\u53c2\u6570\u7f3a\u5931");a=new Snap(a);var k=[];if(void 0===f||void 0===g||void 0===h){var l=parseFloat(a.attr("height"));f=parseFloat(a.getBBox().width);g=parseFloat(a.getBBox().height);h=g/l}var r="";return a.selectAll("path").forEach(function(a){for(var f,
g=a.attr("d").split(" "),l=[],n=0;n<g.length;n++)f=g[n].split(","),2==f.length?(l.push(f[0]),l.push(f[1])):l.push(f[0]);f=[];for(n=0;n<l.length;n++){g=l[n];if(isNaN(parseInt(g.slice(0,1)))){if(r=g.slice(0,1),1==l[n].length&&"Z"!=r)continue;g=g.slice(1)}switch(r){case "M":var t=l[n+1];n++;var u=a.attr("stroke");u="none"==u?"#000000":q(u);f.push({mx:m(parseFloat(g)*h/b+d/b),my:m(1-(parseFloat(t)*h+e)/c),color:u});break;case "Q":f.push({c1x:m(parseFloat(g)*h/b+d/b),c1y:m(1-(parseFloat(l[n+1])*h+e)/c),
c2x:m(parseFloat(g)*h/b+d/b),c2y:m(1-(parseFloat(l[n+1])*h+e)/c),ex:m(parseFloat(l[n+2])*h/b+d/b),ey:m(1-(parseFloat(l[n+3])*h+e/c))});n+=3;break;case "C":f.push({c1x:m(parseFloat(g)*h/b+d/b),c1y:m(1-(parseFloat(l[n+1])*h+e)/c),c2x:m(parseFloat(l[n+2])*h/b+d/b),c2y:m(1-(parseFloat(l[n+3])*h+e)/c),ex:m(parseFloat(l[n+4])*h/b+d/b),ey:m(1-(parseFloat(l[n+5])*h+e)/c)});n+=5;break;case "L":f.push({c1x:m(parseFloat(g)*h/b+d/b),c1y:m(1-(parseFloat(l[n+1])*h+e)/c),c2x:m(parseFloat(g)*h/b+d/b),c2y:m(1-(parseFloat(l[n+
1])*h+e)/c),ex:m(parseFloat(g)*h/b+d/b),ey:m(1-(parseFloat(l[n+1])*h+e)/c)});n++;break;case "Z":k.push(f),f=[]}}f.length&&k.push(f)}),k}}var c=function(a,c){this.times=2;this.canvas=a;this.isSign=!1;this.painting=new b("canvasId");this.initCanvas(c);this.painting.touchstartCallback=c.onBegin;this.painting.touchendCallback=c.onEnd;this.lineSize=c.lineSize||5;this.setSize(this.lineSize);this.lineMax=c.lineMax||4;this.painting.setLineMax(this.lineMax);this.lineMin=c.lineMin||.5;this.painting.setLineMin(this.lineMin);
this.smoothness=c.smoothness||100;this.painting.setSmoothness(this.smoothness)};c.prototype.initCanvas=function(a){var b=a.canvas_width;a=a.canvas_height;this.painting.init(b,a,b*this.times,a*this.times);this.canvas.getContext("2d").fillStyle="rgba(0,0,0,0)"};c.prototype.setSize=function(a){this.painting.setLineSize(a)};c.prototype.setColor=function(a){this.painting.setLineColor(a)};c.prototype.clear=function(){this.isSign=!1;this.painting.clearCanvasAndData()};c.prototype.setWebHandWrite=function(a,
b){var c=this.canvas.getContext("2d");c.textAlign="left";c.textBaseline="bottom";c.shadowBlur=0;c.font=b.fontStyle+" "+parseFloat(b.fontSize)*this.times+"px "+b.fontFamily;c.fillStyle=b.fontColor;for(b=0;a&&b<a.length;b++){var d=a[b];c.fillText(d.txt,d.left,d.top)}};c.prototype.toDataURL=function(a){for(var b=this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height),c=1;c<b.width;c++)for(var d=1;d<b.height;d++);b=this.painting.saveImage();a(b)};"use strict";return c}(document);
export default Signature;
// V2.0.0.400    
